{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:15:12Z","event_type":"created","id":1,"issue_id":"thrum-1xz","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:15:16Z","event_type":"created","id":2,"issue_id":"thrum-n0u","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:15:17Z","event_type":"created","id":3,"issue_id":"thrum-ynl","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:04Z","event_type":"created","id":4,"issue_id":"thrum-lk1","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:07Z","event_type":"created","id":5,"issue_id":"thrum-z41","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:09Z","event_type":"created","id":6,"issue_id":"thrum-16m","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:22Z","event_type":"created","id":7,"issue_id":"thrum-4zr","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:26Z","event_type":"created","id":8,"issue_id":"thrum-0ga","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:26Z","event_type":"created","id":9,"issue_id":"thrum-1mk","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:41Z","event_type":"created","id":10,"issue_id":"thrum-chr","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:44Z","event_type":"created","id":11,"issue_id":"thrum-4av","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:17:47Z","event_type":"created","id":12,"issue_id":"thrum-lru","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:18:00Z","event_type":"created","id":13,"issue_id":"thrum-qd9","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:18:05Z","event_type":"created","id":14,"issue_id":"thrum-85u","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:18:21Z","event_type":"created","id":15,"issue_id":"thrum-gln","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:24:39Z","event_type":"updated","id":16,"issue_id":"thrum-chr","new_value":"{\"description\":\"## Files\\n\\n- Modify: `internal/backup/backup.go` (add post_backup command execution after all backups)\\n- Modify: `internal/config/daemon.go` (add PostBackup string field to BackupConfig)\\n- Create: `internal/backup/post_hook.go` (post-backup command runner)\\n- Create: `internal/backup/post_hook_test.go`\\n\\n## Steps\\n\\n### Step 1: Add PostBackup to config\\nAdd `PostBackup string` field to BackupConfig in daemon.go.\\n\\n### Step 2: Implement post-backup hook runner\\n```go\\nfunc RunPostBackup(command, repoPath, backupDir, repoName, currentDir string) error\\n```\\n- Run command via `sh -c` with CWD=repoPath\\n- Set environment variables:\\n  - THRUM_BACKUP_DIR = backupDir\\n  - THRUM_BACKUP_REPO = repoName\\n  - THRUM_BACKUP_CURRENT = currentDir path\\n- 60s timeout\\n- Non-fatal: warn on failure, don't fail the backup\\n\\n### Step 3: Wire into RunBackup orchestrator\\nCall RunPostBackup as the final step after rotation completes.\\n\\n### Step 4: Add CLI support\\n`thrum backup config set post-backup 'bash dev-docs/dev-scripts/sync-dev-docs.sh'`\\n\\n### Step 5: Verify\\n```bash\\ngo test ./internal/backup/... -run TestPostBackup -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] post_backup command runs after all backups complete\\n- [ ] Environment variables set correctly\\n- [ ] Failure is non-fatal (warns, backup still succeeds)\\n- [ ] 60s timeout enforced\\n- [ ] Tests pass with race detector\",\"title\":\"Implement post-backup hook execution\"}","old_value":"{\"id\":\"thrum-chr\",\"title\":\"Update sync-dev-docs.sh for thrum backup\",\"description\":\"## Files\\n\\n- Modify: `dev-docs/dev-scripts/sync-dev-docs.sh` (replace manual beads backup with thrum backup)\\n\\n## Steps\\n\\n### Step 1: Configure thrum backup with beads plugin\\n```bash\\nthrum backup plugin add --preset beads\\n```\\n\\n### Step 2: Update sync script\\nReplace the manual beads backup section with a single thrum backup call:\\n```bash\\n# Refresh thrum + beads backup before syncing\\necho 'Running thrum backup...'\\n(cd \\\"$THRUM\\\" \\u0026\\u0026 thrum backup --dir \\\"$THRUM/dev-docs/backup\\\" 2\\u003e\\u00261) || echo 'Backup warning (non-fatal)'\\necho 'Backup complete.'\\n```\\n\\nThis produces:\\n- dev-docs/backup/thrum/current/ (thrum data + beads plugin data)\\n- dev-docs/backup/thrum/archives/ (rotated zips)\\n\\n### Step 3: Test the full flow\\n```bash\\nbash dev-docs/dev-scripts/sync-dev-docs.sh\\nls dev-docs/backup/thrum/current/\\n```\\n\\n## Acceptance Criteria\\n- [ ] sync-dev-docs.sh uses thrum backup instead of manual bd backup\\n- [ ] Beads data included via plugin system\\n- [ ] Backup dir uses repo name subfolder (thrum/)\\n- [ ] Script still syncs to thrumdev repo correctly\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:17:42Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:17:42Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:48:55Z","event_type":"created","id":17,"issue_id":"thrum-7iv","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:49:27Z","event_type":"created","id":18,"issue_id":"thrum-7iv.1","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:49:28Z","event_type":"created","id":19,"issue_id":"thrum-7iv.2","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T13:49:28Z","event_type":"created","id":20,"issue_id":"thrum-7iv.3","new_value":"","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T14:14:50Z","event_type":"status_changed","id":21,"issue_id":"thrum-7iv.1","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-7iv.1\",\"title\":\"Allow hyphens in agent name regex\",\"description\":\"## Files\\n\\n- Modify: `internal/identity/identity.go` (regex, ValidateAgentName, doc comment)\\n- Test: `internal/identity/identity_test.go`\\n\\n## Steps\\n\\n### Step 1: Write failing tests\\n\\nAdd test cases to identity_test.go for ValidateAgentName:\\n- `\\\"alice-agent\\\"` → should pass (currently fails)\\n- `\\\"impl-backup-restore\\\"` → should pass\\n- `\\\"a-b-c\\\"` → should pass\\n- `\\\"-leading\\\"` → should still fail (starts with hyphen)\\n- `\\\"trailing-\\\"` → should still fail (ends with hyphen)\\n\\n### Step 2: Update regex and error message\\n\\nIn `internal/identity/identity.go`:\\n- Line 24: Change `agentNameRegex` from `^[a-z0-9_]+$` to `^[a-z0-9][a-z0-9_-]*[a-z0-9]$|^[a-z0-9]$`\\n  (allows hyphens in middle, requires alphanumeric start/end, single char OK)\\n- Line 224: Update error message to mention hyphens\\n- Lines 202-208: Update doc comment to list hyphens as allowed\\n\\n### Step 3: Verify\\n\\n```bash\\ngo test ./internal/identity/... -run TestValidateAgentName -v -race\\n```\\n\\n## Acceptance Criteria\\n\\n- [ ] Names with hyphens like `alice-agent` pass validation\\n- [ ] Leading/trailing hyphens rejected\\n- [ ] Existing valid names still pass\\n- [ ] Existing invalid names still fail (uppercase, dots, spaces)\\n- [ ] `isBase32Hash` unaffected (hyphens not in Crockford alphabet)\\n- [ ] Consistent with `safeIdentifierRE` in `internal/cli/runtime_init.go`\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:49:28Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:49:28Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T14:20:02Z","event_type":"closed","id":22,"issue_id":"thrum-7iv.1","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T14:20:02Z","event_type":"closed","id":23,"issue_id":"thrum-7iv.2","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T14:20:02Z","event_type":"closed","id":24,"issue_id":"thrum-7iv.3","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-27T14:20:02Z","event_type":"closed","id":25,"issue_id":"thrum-7iv","new_value":"All tasks implemented and verified","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:27:25Z","event_type":"status_changed","id":26,"issue_id":"thrum-z41","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-z41\",\"title\":\"Add BackupConfig to ThrumConfig\",\"description\":\"## Files\\n\\n- Modify: `internal/config/daemon.go` (add BackupConfig struct and fields to ThrumConfig)\\n- Test: `internal/config/daemon_test.go` (add tests for backup config load/save)\\n\\n## Steps\\n\\n### Step 1: Write failing test\\nTest that BackupConfig loads from config.json with dir, retention, and plugins fields. Test defaults (empty dir = .thrum/backup, daily=5, weekly=4, monthly=-1).\\n\\n### Step 2: Add BackupConfig struct\\n```go\\ntype BackupConfig struct {\\n    Dir       string          `json:\\\"dir,omitempty\\\"`\\n    Retention RetentionConfig `json:\\\"retention,omitempty\\\"`\\n    Plugins   []PluginConfig  `json:\\\"plugins,omitempty\\\"`\\n}\\n\\ntype RetentionConfig struct {\\n    Daily   int `json:\\\"daily\\\"`   // default 5\\n    Weekly  int `json:\\\"weekly\\\"`  // default 4\\n    Monthly int `json:\\\"monthly\\\"` // default -1 (forever)\\n}\\n\\ntype PluginConfig struct {\\n    Name    string   `json:\\\"name\\\"`\\n    Command string   `json:\\\"command\\\"`\\n    Include []string `json:\\\"include\\\"`\\n}\\n```\\n\\nAdd `Backup BackupConfig` field to ThrumConfig. Update applyDefaults() with backup defaults. Update SaveThrumConfig to preserve backup section.\\n\\n### Step 3: Verify\\n```bash\\ngo test ./internal/config/... -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] BackupConfig loads from config.json\\n- [ ] Defaults applied when fields missing\\n- [ ] SaveThrumConfig preserves unknown keys AND backup section\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:17:08Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:17:08Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:29:04Z","event_type":"closed","id":27,"issue_id":"thrum-z41","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:29:16Z","event_type":"status_changed","id":28,"issue_id":"thrum-1mk","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-1mk\",\"title\":\"Implement JSONL export from sync worktree\",\"description\":\"## Files\\n\\n- Create: `internal/backup/export.go` (core export logic)\\n- Create: `internal/backup/export_test.go`\\n\\n## Steps\\n\\n### Step 1: Write failing test\\nCreate a temp dir with mock JSONL files mimicking the a-sync worktree layout (events.jsonl + messages/*.jsonl). Test that ExportSyncData copies them to the backup dir preserving structure.\\n\\n### Step 2: Implement ExportSyncData\\n```go\\npackage backup\\n\\nfunc ExportSyncData(syncDir, backupDir string) (SyncExportResult, error)\\n```\\n- Use paths.SyncWorktreePath to find sync dir\\n- Copy events.jsonl to backupDir/events.jsonl\\n- Copy messages/*.jsonl to backupDir/messages/\\n- Use atomic copy (write to .tmp, rename)\\n- Return counts of files and events copied\\n\\n### Step 3: Verify\\n```bash\\ngo test ./internal/backup/... -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] Copies JSONL files from sync worktree preserving layout\\n- [ ] Handles missing sync dir gracefully (error with clear message)\\n- [ ] Handles empty messages/ dir\\n- [ ] Uses atomic writes\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:17:27Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:17:27Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:29:16Z","event_type":"status_changed","id":29,"issue_id":"thrum-4av","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-4av\",\"title\":\"Implement SQLite local-only table export\",\"description\":\"## Files\\n\\n- Create: `internal/backup/local_export.go` (SQLite to JSONL for local tables)\\n- Create: `internal/backup/local_export_test.go`\\n\\n## Steps\\n\\n### Step 1: Write failing test\\nCreate in-memory SQLite DB, populate message_reads, subscriptions, sync_checkpoints tables. Test that ExportLocalTables writes correct JSONL files.\\n\\n### Step 2: Implement ExportLocalTables\\n```go\\nfunc ExportLocalTables(db *sql.DB, backupDir string) (LocalExportResult, error)\\n```\\n- Export message_reads, subscriptions, sync_checkpoints as JSONL\\n- Write to backupDir/local/message_reads.jsonl etc.\\n- Use generic exportTable helper: SELECT * → json.Marshal each row → write line\\n- Dynamic column scanning (like beads backup_export.go pattern)\\n\\n### Step 3: Verify\\n```bash\\ngo test ./internal/backup/... -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] Exports 3 local-only tables as JSONL\\n- [ ] Each line is valid JSON\\n- [ ] Round-trip: export then parse produces same data\\n- [ ] Handles empty tables (writes empty file)\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:17:45Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:17:45Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:29:16Z","event_type":"status_changed","id":30,"issue_id":"thrum-qd9","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-qd9\",\"title\":\"Implement config and identity file backup\",\"description\":\"## Files\\n\\n- Create: `internal/backup/config_export.go` (copy config/identity/context files)\\n- Create: `internal/backup/config_export_test.go`\\n\\n## Steps\\n\\n### Step 1: Write failing test\\nCreate temp .thrum dir with config.json, identities/*.json, context/*.md. Test ExportConfigFiles copies them to backupDir/config/ preserving structure.\\n\\n### Step 2: Implement ExportConfigFiles\\n```go\\nfunc ExportConfigFiles(thrumDir, backupDir string) error\\n```\\n- Copy .thrum/config.json → backupDir/config/config.json\\n- Copy .thrum/identities/*.json → backupDir/config/identities/\\n- Copy .thrum/context/*.md → backupDir/config/context/\\n- Skip runtime files (var/, *.sock, *.pid, *.lock, *.port)\\n\\n### Step 3: Verify\\n```bash\\ngo test ./internal/backup/... -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] Copies config, identity, and context files\\n- [ ] Preserves directory structure\\n- [ ] Skips runtime/ephemeral files\\n- [ ] Handles missing optional dirs (identities/, context/)\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:18:01Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:18:01Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:32:07Z","event_type":"closed","id":31,"issue_id":"thrum-1mk","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:32:07Z","event_type":"closed","id":32,"issue_id":"thrum-4av","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:32:07Z","event_type":"closed","id":33,"issue_id":"thrum-qd9","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:32:16Z","event_type":"status_changed","id":34,"issue_id":"thrum-gln","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-gln\",\"title\":\"Wire up thrum backup CLI commands\",\"description\":\"## Files\\n\\n- Modify: `cmd/thrum/main.go` (add backupCmd group with create/status/config subcommands)\\n- Create: `internal/backup/manifest.go` (manifest generation)\\n- Create: `internal/backup/backup.go` (orchestrator: calls export functions, writes manifest)\\n- Test: `internal/backup/backup_test.go`\\n\\n## Steps\\n\\n### Step 1: Implement manifest\\n```go\\ntype Manifest struct {\\n    Version      int            `json:\\\"version\\\"`\\n    Timestamp    time.Time      `json:\\\"timestamp\\\"`\\n    ThrumVersion string         `json:\\\"thrum_version\\\"`\\n    RepoName     string         `json:\\\"repo_name\\\"`\\n    Counts       ManifestCounts `json:\\\"counts\\\"`\\n}\\n```\\n\\n### Step 2: Implement RunBackup orchestrator\\n```go\\nfunc RunBackup(opts BackupOptions) (*BackupResult, error)\\n```\\n- Resolve backup dir (CLI flag \\u003e config \\u003e default .thrum/backup)\\n- Derive repo name from git remote or dir name (use cli.GetRepoName)\\n- Create \\u003cbackupDir\\u003e/\\u003crepoName\\u003e/current/\\n- Call ExportSyncData, ExportLocalTables, ExportConfigFiles\\n- Write manifest.json\\n- Return BackupResult with counts and paths\\n\\n### Step 3: Wire CLI\\nAdd backupCmd() to main.go following daemonCmd() pattern:\\n- `thrum backup` (default: run backup)\\n- `thrum backup status` (show last backup from manifest)\\n- `thrum backup config` (show effective backup config)\\n- `--dir` flag overrides config backup dir\\n\\n### Step 4: Verify\\n```bash\\ngo test ./internal/backup/... -v -race\\ngo build ./cmd/thrum/\\n./thrum backup --help\\n```\\n\\n## Acceptance Criteria\\n- [ ] thrum backup creates backup with all data\\n- [ ] thrum backup --dir /tmp/test works\\n- [ ] thrum backup status shows last backup info\\n- [ ] thrum backup config shows effective config\\n- [ ] Manifest written with accurate counts\\n- [ ] Repo name used as subfolder\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:18:22Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:18:22Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:35:19Z","event_type":"closed","id":35,"issue_id":"thrum-gln","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:35:19Z","event_type":"closed","id":36,"issue_id":"thrum-1xz","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:35:28Z","event_type":"status_changed","id":37,"issue_id":"thrum-16m","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-16m\",\"title\":\"Implement GFS archive rotation\",\"description\":\"## Files\\n\\n- Create: `internal/backup/rotation.go` (GFS retention logic + zip compression)\\n- Create: `internal/backup/rotation_test.go`\\n\\n## Steps\\n\\n### Step 1: Write failing tests\\nTest cases for GFS rotation:\\n- 5 daily backups kept, 6th oldest deleted\\n- Weekly: oldest surviving daily per week promoted\\n- Monthly: oldest surviving weekly per month kept forever\\n- Pre-restore safety backups exempt from rotation\\n- Edge cases: empty archives dir, single backup, backups spanning month boundaries\\n\\n### Step 2: Implement rotation\\n```go\\nfunc CompressCurrentToArchive(currentDir, archivesDir string) (string, error)\\n// Compresses currentDir into archives/YYYY-MM-DDTHHMMSS.zip using archive/zip\\n// Returns path to created zip\\n\\nfunc ApplyRetention(archivesDir string, retention config.RetentionConfig) error\\n// Parse archive filenames for timestamps\\n// Classify into daily/weekly/monthly buckets\\n// Delete archives that exceed retention limits\\n// Skip files matching pre-restore-*.zip pattern\\n```\\n\\n### Step 3: Integrate into RunBackup\\nBefore writing new backup, compress existing current/ to archive, then apply retention.\\n\\n### Step 4: Verify\\n```bash\\ngo test ./internal/backup/... -run TestRotation -v -race\\ngo test ./internal/backup/... -run TestRetention -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] Pure Go using archive/zip (no external deps)\\n- [ ] GFS: 5 daily, 4 weekly, monthly forever (configurable)\\n- [ ] Pre-restore-*.zip exempt from rotation\\n- [ ] Archive filenames are ISO8601 timestamps\\n- [ ] Handles edge cases (empty dir, single file, month boundaries)\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:17:09Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:17:09Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:37:27Z","event_type":"closed","id":38,"issue_id":"thrum-16m","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:37:33Z","event_type":"status_changed","id":39,"issue_id":"thrum-0ga","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-0ga\",\"title\":\"Implement safety backup before restore\",\"description\":\"## Files\\n\\n- Create: `internal/backup/safety.go` (pre-restore safety backup)\\n- Create: `internal/backup/safety_test.go`\\n\\n## Steps\\n\\n### Step 1: Write failing test\\nTest that CreateSafetyBackup creates a pre-restore-TIMESTAMP.zip in archives/ containing the current thrum data. Test it skips if no existing data.\\n\\n### Step 2: Implement\\n```go\\nfunc CreateSafetyBackup(backupDir, repoName string) (string, error)\\n// If \\u003cbackupDir\\u003e/\\u003crepoName\\u003e/current/ exists OR sync worktree has data:\\n//   1. Run a quick backup to temp dir\\n//   2. Compress to \\u003cbackupDir\\u003e/\\u003crepoName\\u003e/archives/pre-restore-TIMESTAMP.zip\\n//   3. Return path to safety backup\\n// If no existing data, return empty string (nothing to protect)\\n```\\n\\n### Step 3: Verify\\n```bash\\ngo test ./internal/backup/... -run TestSafety -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] Creates pre-restore zip before any restore operation\\n- [ ] Skips if no existing data to protect\\n- [ ] Pre-restore zips are exempt from GFS rotation\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:17:26Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:17:26Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:39:14Z","event_type":"closed","id":40,"issue_id":"thrum-0ga","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:39:14Z","event_type":"closed","id":41,"issue_id":"thrum-lru","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:39:19Z","event_type":"status_changed","id":42,"issue_id":"thrum-85u","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-85u\",\"title\":\"Wire up thrum backup restore CLI\",\"description\":\"## Files\\n\\n- Modify: `cmd/thrum/main.go` (add restore subcommand to backup group)\\n\\n## Steps\\n\\n### Step 1: Add restore subcommand\\nAdd to the backupCmd() group:\\n```\\nthrum backup restore [archive.zip]\\n```\\n- Optional positional arg: path to zip archive\\n- If omitted, restore from current/ in backup dir\\n- --dir flag to override backup dir (same as thrum backup)\\n- Confirmation prompt before proceeding (unless --yes flag)\\n\\n### Step 2: Integration test\\nTest full round-trip: backup -\\u003e corrupt/delete data -\\u003e restore -\\u003e verify data matches.\\n\\n### Step 3: Verify\\n```bash\\ngo build ./cmd/thrum/\\n./thrum backup restore --help\\ngo test ./internal/backup/... -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] thrum backup restore works from current/\\n- [ ] thrum backup restore ./archive.zip works from zip\\n- [ ] Confirmation prompt shown (--yes to skip)\\n- [ ] Error message if no backup found\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":1,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:18:05Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:18:05Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:40:28Z","event_type":"closed","id":43,"issue_id":"thrum-85u","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:40:28Z","event_type":"closed","id":44,"issue_id":"thrum-n0u","new_value":"Closed","old_value":""}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:40:38Z","event_type":"status_changed","id":45,"issue_id":"thrum-lk1","new_value":"{\"status\":\"in_progress\"}","old_value":"{\"id\":\"thrum-lk1\",\"title\":\"Implement third-party plugin execution\",\"description\":\"## Files\\n\\n- Create: `internal/backup/plugins.go` (plugin command runner and file collector)\\n- Create: `internal/backup/plugins_test.go`\\n\\n## Steps\\n\\n### Step 1: Write failing test\\nTest RunPlugins with a mock plugin config that runs a simple command (echo) and includes files matching a glob pattern. Test timeout handling (60s). Test command failure is non-fatal (warn, continue).\\n\\n### Step 2: Implement\\n```go\\nfunc RunPlugins(plugins []config.PluginConfig, repoPath, backupDir string) ([]PluginResult, error)\\n// For each plugin:\\n//   1. Run plugin.Command with CWD=repoPath, 60s timeout\\n//   2. If command fails: log warning, skip file collection, continue\\n//   3. Glob plugin.Include patterns relative to repoPath\\n//   4. Copy matched files to backupDir/plugins/\\u003cplugin.Name\\u003e/\\n//   5. Preserve relative paths within the plugin dir\\n```\\n\\n### Step 3: Integrate into RunBackup\\nAfter core export, run plugins if configured. Include plugin names in manifest.\\n\\n### Step 4: Verify\\n```bash\\ngo test ./internal/backup/... -run TestPlugin -v -race\\n```\\n\\n## Acceptance Criteria\\n- [ ] Runs plugin commands with 60s timeout\\n- [ ] Collects files matching glob patterns\\n- [ ] Plugin failure is non-fatal (warns, continues)\\n- [ ] Files placed in plugins/\\u003cname\\u003e/ preserving relative paths\\n- [ ] Plugin names listed in manifest\\n- [ ] Tests pass with race detector\",\"status\":\"open\",\"priority\":2,\"issue_type\":\"task\",\"owner\":\"leon.letto@gmail.com\",\"created_at\":\"2026-02-27T21:17:05Z\",\"created_by\":\"Leon Letto\",\"updated_at\":\"2026-02-27T21:17:05Z\"}"}
{"actor":"Leon Letto","comment":null,"created_at":"2026-02-28T10:43:29Z","event_type":"closed","id":46,"issue_id":"thrum-lk1","new_value":"Implemented RunPlugins with timeout, glob file collection, PluginPresets, integrated into RunBackup. 6 tests pass.","old_value":""}
