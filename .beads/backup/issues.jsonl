{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:39:14Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b401aab806474d5765947bf33e0127d27debd4f2772d37b64c7639150f0a1ad9","created_at":"2026-02-27T21:17:26Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/safety.go` (pre-restore safety backup)\n- Create: `internal/backup/safety_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nTest that CreateSafetyBackup creates a pre-restore-TIMESTAMP.zip in archives/ containing the current thrum data. Test it skips if no existing data.\n\n### Step 2: Implement\n```go\nfunc CreateSafetyBackup(backupDir, repoName string) (string, error)\n// If \u003cbackupDir\u003e/\u003crepoName\u003e/current/ exists OR sync worktree has data:\n//   1. Run a quick backup to temp dir\n//   2. Compress to \u003cbackupDir\u003e/\u003crepoName\u003e/archives/pre-restore-TIMESTAMP.zip\n//   3. Return path to safety backup\n// If no existing data, return empty string (nothing to protect)\n```\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -run TestSafety -v -race\n```\n\n## Acceptance Criteria\n- [ ] Creates pre-restore zip before any restore operation\n- [ ] Skips if no existing data to protect\n- [ ] Pre-restore zips are exempt from GFS rotation\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-0ga","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement safety backup before restore","updated_at":"2026-02-28T18:39:14Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All 9 pre-existing failures fixed — 0 failures, 81 passed","closed_at":"2026-03-01T05:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"46791af708d0534b844d1f84acf3ed2291ce132455cfac7ff6f23273013df4b0","created_at":"2026-03-01T00:23:47Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"9 tests in pre-existing spec files consistently fail. These were closed as 'already existing' during the integration but need investigation. The failures are:\n\n1. daemon SC-43: Stop daemon cleanly — daemon in temp repo reports 'not running'\n2. init SC-02: Re-init already-initialized repo — assertion mismatch\n3. messaging SC-15: Send broadcast — session-related error\n4. multi-agent SC-58: Two agents coordinate — session already ended error\n5. multi-agent SC-63: Session handoff — session already ended error\n6. multi-agent SC-64: Parallel agents with sync — send fails\n7. registration SC-05: Register agent via quickstart — session conflict\n8. web-ui SC-53: Inbox compose message — COMPOSE button not visible\n9. web-ui SC-57: Settings panel — strict mode violation (2 settings buttons)\n\nFile: Multiple pre-existing spec files\n\nAcceptance criteria:\n- Each failure is investigated for root cause\n- Failures that are genuine bugs get fix PRs or are marked with clear skip reasons\n- Failures that are test issues get test fixes\n- Net result: fewer than 9 failures in the full suite","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-0mh","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-03-01T05:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"36d6f16d67cfbcb195f6a30e794261de49fb6c50703c0d1c333360d56691321a","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-12q","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix llms.txt stale --all flag reference","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:37:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3e98b72158ab7e423d152942fa2a53a7e37dd309577a346a7a8e3d8e47f1acdf","created_at":"2026-02-27T21:17:09Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/rotation.go` (GFS retention logic + zip compression)\n- Create: `internal/backup/rotation_test.go`\n\n## Steps\n\n### Step 1: Write failing tests\nTest cases for GFS rotation:\n- 5 daily backups kept, 6th oldest deleted\n- Weekly: oldest surviving daily per week promoted\n- Monthly: oldest surviving weekly per month kept forever\n- Pre-restore safety backups exempt from rotation\n- Edge cases: empty archives dir, single backup, backups spanning month boundaries\n\n### Step 2: Implement rotation\n```go\nfunc CompressCurrentToArchive(currentDir, archivesDir string) (string, error)\n// Compresses currentDir into archives/YYYY-MM-DDTHHMMSS.zip using archive/zip\n// Returns path to created zip\n\nfunc ApplyRetention(archivesDir string, retention config.RetentionConfig) error\n// Parse archive filenames for timestamps\n// Classify into daily/weekly/monthly buckets\n// Delete archives that exceed retention limits\n// Skip files matching pre-restore-*.zip pattern\n```\n\n### Step 3: Integrate into RunBackup\nBefore writing new backup, compress existing current/ to archive, then apply retention.\n\n### Step 4: Verify\n```bash\ngo test ./internal/backup/... -run TestRotation -v -race\ngo test ./internal/backup/... -run TestRetention -v -race\n```\n\n## Acceptance Criteria\n- [ ] Pure Go using archive/zip (no external deps)\n- [ ] GFS: 5 daily, 4 weekly, monthly forever (configurable)\n- [ ] Pre-restore-*.zip exempt from rotation\n- [ ] Archive filenames are ISO8601 timestamps\n- [ ] Handles edge cases (empty dir, single file, month boundaries)\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-16m","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement GFS archive rotation","updated_at":"2026-02-28T18:37:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:32:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a56239e6a37f591053442b3671363c5de4c848f9ae80f35ad8163edfe0a26d06","created_at":"2026-02-27T21:17:27Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/export.go` (core export logic)\n- Create: `internal/backup/export_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nCreate a temp dir with mock JSONL files mimicking the a-sync worktree layout (events.jsonl + messages/*.jsonl). Test that ExportSyncData copies them to the backup dir preserving structure.\n\n### Step 2: Implement ExportSyncData\n```go\npackage backup\n\nfunc ExportSyncData(syncDir, backupDir string) (SyncExportResult, error)\n```\n- Use paths.SyncWorktreePath to find sync dir\n- Copy events.jsonl to backupDir/events.jsonl\n- Copy messages/*.jsonl to backupDir/messages/\n- Use atomic copy (write to .tmp, rename)\n- Return counts of files and events copied\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] Copies JSONL files from sync worktree preserving layout\n- [ ] Handles missing sync dir gracefully (error with clear message)\n- [ ] Handles empty messages/ dir\n- [ ] Uses atomic writes\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-1mk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement JSONL export from sync worktree","updated_at":"2026-02-28T18:32:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:35:20Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1a59478e79212dfe9e0ffd3ecb1e750fd529730ee160a5fe36acdaf9379a0fa3","created_at":"2026-02-27T21:15:12Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Config model, JSONL export from sync worktree and SQLite local-only tables, manifest generation, CLI command wiring (thrum backup, thrum backup status, thrum backup config).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-1xz","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Core Backup Infrastructure","updated_at":"2026-02-28T18:35:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All 6 tasks complete","closed_at":"2026-03-01T05:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"95481bcc01c8c20dc435c55ca7129953258fa63ca2068d47105865ac65bb8b0c","created_at":"2026-03-01T00:23:32Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Address gaps between the E2E integration plan and actual implementation. Covers missing tests (F2-2, F2-4, F2-13), weakened assertions (J9), pre-existing failures (9 tests), and documentation gaps (F5 behavior).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-22y","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"epic","updated_at":"2026-03-01T05:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T23:05:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8834053012c125ad40de8dd03b550488133f731fb8c8bab2e8a46795c155dfb8","created_at":"2026-02-28T22:08:42Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Write backup.spec.ts — Backup/Restore Tests\n\n### Files\n- Create: `tests/e2e/backup.spec.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 13)\n\n### Tests to Write (serial mode)\n- Create backup (thrum backup --dir \u003ctest-repo\u003e/test-backups, verify dir exists)\n- Backup status (thrum backup status --dir, verify output)\n- Backup config (thrum backup config, verify output)\n- Restore from backup (thrum backup restore --dir --yes, verify output)\n\nUse getTestRoot() + '/test-backups' as backup dir.\n\n### Acceptance Criteria\n- [ ] All 4 tests pass\n- [ ] Backup files created inside test repo (not source repo)\n\n### Commit\n```\ngit commit -m \"test(e2e): add backup.spec.ts — backup create, status, config, restore\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2hy","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Write backup.spec.ts — backup/restore tests","updated_at":"2026-02-28T23:05:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All 6 tasks complete: P1 cross-worktree delivery verification + P2 assertion tightening, missing regressions, documentation","closed_at":"2026-03-01T06:29:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a8fb2e450fedc4cf3af879cfb182f515517cfc32928a28fed3890f5d22c191a9","created_at":"2026-03-01T05:51:18Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Code review and spec coverage analysis found significant gaps in the E2E test implementation. Tests pass but many do not verify actual behavior — they assert CLI commands return non-empty/non-error output instead of checking that features work correctly. Core issue: messaging and multi-agent tests verify message storage but never verify delivery to a second agent in a second worktree, which is the entire point of E2E messaging scenarios.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2ug","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"E2E Test Coverage Gaps — Review Findings","updated_at":"2026-03-01T06:29:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Created setup-verification.spec.ts with D1-D4 tests verifying coordinator/implementer worktrees, redirect, agent registration, and team roster","closed_at":"2026-03-01T06:09:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2a5bf51fde9d568b4b142f8378f20baec1df1b6c523e6711577b42815274d05f","created_at":"2026-03-01T05:51:26Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"session.spec.ts is entirely missing. The design doc and implementation plan both call for it. Create session.spec.ts covering:\n- D1: Initialize test worktrees (worktree init + redirect verification)\n- D2: Register Coordinator Agent (thrum quickstart + thrum whoami verification)\n- D3: Register Implementer Agent\n- D4: Verify Team Roster (thrum team shows both agents)\n\nThese must use actual worktree paths, not env var overrides from the same directory.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2ug.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Create session.spec.ts covering D1–D4","updated_at":"2026-03-01T06:09:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Rewrote messaging.spec.ts (E1-E9) with cross-worktree delivery verification: send from coordinator, verify in implementer inbox","closed_at":"2026-03-01T06:09:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3eb8c81c1efe83f386ab0c2c7a3ac579dc9582cb7df9f468380bc1b968d9c073","created_at":"2026-03-01T05:51:34Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"messaging.spec.ts uses fabricated SC- IDs instead of spec E1–E9. Tests only verify message storage via 'message get', never verify delivery to another agent's inbox.\n\nDIRECTIVES:\n1. Remap test IDs to match spec E1–E9\n2. For each send test, set up a second agent and verify the message appears in the RECIPIENT's inbox, not just in storage\n3. SC-15 (broadcast): Must verify broadcast reaches a different agent's inbox, not just that send returns a message_id\n4. SC-20 (unread indicators): Must actually test unread indicators from a recipient's perspective\n5. Implement missing scenarios: E6 (unknown recipient fails), E7 (multiple recipients with one bad address — atomic rejection), E8 (send to role name with warning), E9 (name!=role validation)\n6. SC-19 (scope/refs) can stay as bonus coverage but should be noted as non-spec","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2ug.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix messaging.spec.ts to test actual delivery, not just storage","updated_at":"2026-03-01T06:09:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Rewrote multi-agent.spec.ts (SC-58/63/64) with cross-worktree delivery verification using thrumIn(getImplementerRoot())","closed_at":"2026-03-01T06:09:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8c08af00bfd07c7d97ed44e6a8535549ba9e3a1a567e99c4efd28f95ed364ffa","created_at":"2026-03-01T05:51:44Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Multi-agent tests (SC-58, SC-63, SC-64) do not test cross-worktree messaging. They run from the coordinator directory with env var overrides instead of executing CLI from the actual implementer worktree.\n\nDIRECTIVES:\n1. SC-58: After sending to @e2e_sc58_impl, verify the message appears in the implementer's inbox by running 'thrum inbox' from the implementer worktree (use thrumIn helper or equivalent)\n2. SC-63 (session handoff): Verify the reviewer agent RECEIVES the handoff message — check reviewer's inbox, not just message storage. Use the same pattern as SC-64 but from the actual worktree\n3. SC-64: Run inbox check from the implementer worktree directory, not from coordinator with THRUM_NAME env override. The env override approach has questionable identity resolution and may produce false positives\n4. All cross-agent tests must exercise the getImplementerRoot() path to confirm multi-worktree plumbing works","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2ug.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix multi-agent.spec.ts to use actual cross-worktree verification","updated_at":"2026-03-01T06:09:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Tightened SC-33, F2-2, groups F2 assertions; added F2-1 who-has single agent test","closed_at":"2026-03-01T06:29:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"06b80fdd63149add635edc716bd96f041b6d291df1b3557938e1e25d72111b4e","created_at":"2026-03-01T05:51:53Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Multiple tests had assertions weakened to make them pass rather than testing actual behavior.\n\nDIRECTIVES:\n1. SC-24 (messaging.spec.ts): Restore thread_id assertion. Test name is 'Reply to a message (auto-thread creation)' but thread creation is not verified. Must check that reply creates a thread_id on the original message\n2. SC-33 (coordination.spec.ts): Tighten assertion from /coordinator|implementer|tester/ to specifically check for the expected agent. Current assertion is trivially true given setup\n3. F2-2 (coordination.spec.ts): Assert that BOTH agents appear in who-has output, not just that output is non-empty/non-error\n4. F2 groups.spec.ts: Replace toMatch(/2/) with an assertion anchored to the group name (e.g. /test-team.*2/ or parse structured output). Current regex matches any '2' anywhere in output\n5. F2-1 (who-has single agent): Add this missing test — it's the simplest who-has test and should be present","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2ug.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix weakened assertions across spec files","updated_at":"2026-03-01T06:29:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Added J2 (prime unread), J10 (name-only routing warning), J13 (name=role validation)","closed_at":"2026-03-01T06:29:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ddaa1ed238a1be57709bf410ab73f59639509f737c36c02800f554baf35c5e75","created_at":"2026-03-01T05:52:00Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The implementation plan maps 13 regression scenarios to regression.spec.ts but only 10 are implemented. Three are missing with no skip annotation or explanation.\n\nDIRECTIVES:\n1. J2 (prime unread count accuracy): Implement — send a message, then verify 'thrum prime | grep inbox' shows unread \u003e 0\n2. J10 and J13: Identify what these scenarios are from the spec and either implement them or add explicit test.skip with documented reason\n3. Every missing scenario must either be implemented or have a skip annotation explaining why","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2ug.5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add missing regression scenarios J2, J10, J13","updated_at":"2026-03-01T06:29:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Documented fixed path/workers:1 design in global-setup; corrected SC-40/SC-41 FIXME to identify init.defaultBranch as root cause","closed_at":"2026-03-01T06:29:48Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"f1bd038e309aa0c7e240f891be16bed3b649da7f3229bcb83a5b3c385cdd923c","created_at":"2026-03-01T05:52:08Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Two structural issues in global-setup.ts:\n\nDIRECTIVES:\n1. Test isolation: The fixed /tmp/thrum-e2e-release path breaks parallel run isolation. The old setup used mkdtempSync. Either restore unique temp dirs per run, or document clearly that parallel runs are not supported and add a lockfile to prevent concurrent execution\n2. Worktree creation: global-setup manually creates the implementer worktree instead of using scripts/setup-worktree-thrum.sh as the design doc specifies. Either use the script or document what setup steps are being skipped and why\n3. Fix SC-40/SC-41 fixme comments: The stated root cause ('git commit fails in temp repo clones') is misleading. Investigate and correct the explanation so future maintainers don't chase the wrong problem","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-2ug.6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix global-setup.ts test isolation and worktree creation","updated_at":"2026-03-01T06:29:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:32:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"bcd588c05d5b4a65b12e4b28e9d4feba1f469a04d6dbe9874aaa0c41b7f4a367","created_at":"2026-02-27T21:17:45Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/local_export.go` (SQLite to JSONL for local tables)\n- Create: `internal/backup/local_export_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nCreate in-memory SQLite DB, populate message_reads, subscriptions, sync_checkpoints tables. Test that ExportLocalTables writes correct JSONL files.\n\n### Step 2: Implement ExportLocalTables\n```go\nfunc ExportLocalTables(db *sql.DB, backupDir string) (LocalExportResult, error)\n```\n- Export message_reads, subscriptions, sync_checkpoints as JSONL\n- Write to backupDir/local/message_reads.jsonl etc.\n- Use generic exportTable helper: SELECT * → json.Marshal each row → write line\n- Dynamic column scanning (like beads backup_export.go pattern)\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] Exports 3 local-only tables as JSONL\n- [ ] Each line is valid JSON\n- [ ] Round-trip: export then parse produces same data\n- [ ] Handles empty tables (writes empty file)\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-4av","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement SQLite local-only table export","updated_at":"2026-02-28T18:32:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"15a2f978d63a9f841757a1513603a085564f7b3773c4e117aec55ec833606aeb","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-4c0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update website docs for v0.5.1 changes","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Plugin add/list/remove CLI commands, presets for beads/beads-rust, config persistence, wired into backup.","closed_at":"2026-02-28T18:45:12Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ff0d63c61eb20a9e9f0c59c2eaa40abf40638d155c287b2f15446f7edddf973e","created_at":"2026-02-27T21:17:23Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `cmd/thrum/main.go` (add `thrum backup plugin add/list/remove` subcommands)\n- Modify: `internal/config/daemon.go` (add helper to add/remove plugins)\n\n## Steps\n\n### Step 1: Add plugin management subcommands\n```\nthrum backup plugin add --name beads --command 'bd backup --force' --include '.beads/backup/*'\nthrum backup plugin add --preset beads    # Built-in preset for common tools\nthrum backup plugin list\nthrum backup plugin remove --name beads\n```\n\n### Step 2: Implement presets\nBuilt-in presets for common tools:\n- beads: {command: 'bd backup --force', include: ['.beads/backup/*']}\n- beads-rust: {command: 'beads backup --force', include: ['.beads/backup/*']}\n\n### Step 3: Verify\n```bash\ngo build ./cmd/thrum/\n./thrum backup plugin add --preset beads\n./thrum backup plugin list\n./thrum backup config\n```\n\n## Acceptance Criteria\n- [ ] Plugin add/list/remove commands work\n- [ ] Presets for beads and beads-rust\n- [ ] Config updated in .thrum/config.json\n- [ ] thrum backup config shows plugins","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-4zr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add beads plugin preset and config command","updated_at":"2026-02-28T18:45:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"J9 inbox verification added","closed_at":"2026-03-01T05:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ab220babb6cbd040ce4bdddc9deb7bbfa23dc6a7ed51c9876c4e7117633bbaa7","created_at":"2026-03-01T00:23:43Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The plan specified that J9 (Unknown recipient hard error) should also verify the inbox does NOT contain the failed message. The current implementation only checks the error output.\n\nFile: tests/e2e/regression.spec.ts\n\nAcceptance criteria:\n- After sending to @does-not-exist fails, check `inbox --json` and verify it does not contain the failed message text\n- Existing J9 assertions still pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-6zq","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-03-01T05:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"ComposeBar redesign complete","closed_at":"2026-02-24T18:35:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"787d4bd738cc7e1732138f4d3a64526327fbade719f41080fc696b7556712b24","created_at":"2026-02-24T16:19:44Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Re-implement: (C1) MentionAutocomplete show agent display names as labels, (C2) ComposeBar two-row Slack-style layout, (C3) MentionAutocomplete test updates, (D4) MentionAutocomplete search by agent_id+display+role with agents-first ordering. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups C + D4.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"ComposeBar Redesign + MentionAutocomplete — Two-row layout, agent names","updated_at":"2026-02-24T18:35:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:30:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"257fd4664f3ce4c2701bc391ff417adf1b5d74b06accf194225e8d5dbd3cae23","created_at":"2026-02-24T16:21:36Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/MentionAutocomplete.tsx\n\n## Steps\n1. Separate agent and group suggestion building into agentSuggestions and groupSuggestions arrays\n2. Agent filter: match against agent.role, agent.agent_id, AND agent.display (all lowercased)\n3. Agent label: agent.display || agent.agent_id.replace(/^(agent|user):/, '')\n4. Agent sublabel: agent.role\n5. Group filter: unchanged (match group.name)\n6. Merge: filteredSuggestions = [...agentSuggestions, ...groupSuggestions] (agents first)\n\n## Acceptance Criteria\n- [ ] Typing @coordinator_ shows coordinator_main as first suggestion\n- [ ] Agents appear before groups in dropdown\n- [ ] Build passes","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"MentionAutocomplete: search by agent_id+display+role, agents first","updated_at":"2026-02-24T18:30:47Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:34:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"581b0dd69612f50395fe3bb5c2f367d0c43c6d1a4ef3a8b532c46c931399bdde","created_at":"2026-02-24T16:21:41Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/ComposeBar.tsx\n\n## Steps\n1. Add removeChip(chip) function that filters selectedRecipients\n2. Remove Users import from lucide-react (keep Loader2, X)\n3. Restructure form from single-row to two-row:\n   - Row 1 (addressing): To: label + allMentions chips (union of selectedRecipients + mentions) + '+ Add' button + recipient dropdown. Hidden when groupScope set.\n   - Row 2 (message): flex-1 MentionAutocomplete + Send button inline\n4. Chips from selectedRecipients get X button for removal via removeChip\n5. Add pt-1 to isImpersonating warning div\n\n## Acceptance Criteria\n- [ ] Addressing row above textarea\n- [ ] Full-width textarea on its own row\n- [ ] Chips show combined recipients\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"ComposeBar: Two-row Slack-style layout with removable chips","updated_at":"2026-02-24T18:34:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:34:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a2950cfed2934915135f8f223e4a741c77f5e98a75e600801f97b94ae4a2fe71","created_at":"2026-02-24T16:21:49Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/__tests__/MentionAutocomplete.test.tsx\n\n## Steps\n1. Update mock display values: 'Assistant Bot' → 'assistant_main', 'Research Agent' → 'researcher_main', 'Testing Agent' → 'tester_main'\n2. Update ALL label assertions: @assistant → @assistant_main, @researcher → @researcher_main, @tester → @tester_main\n3. Update mention extraction assertions: ['assistant'] → ['assistant_main'], ['assistant','researcher'] → ['assistant_main','researcher_main'], etc.\n4. Update typed text in tests: 'Hello @assistant and @researcher' → 'Hello @assistant_main and @researcher_main', etc.\n\n## Acceptance Criteria\n- [ ] All MentionAutocomplete tests pass\n- [ ] All 473+ tests pass: cd ui \u0026\u0026 pnpm test -- -- --run","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update MentionAutocomplete tests for agent display names","updated_at":"2026-02-24T18:34:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in f99260b: gitConfigValue() now uses exec.Command directly instead of safecmd.Git to read real git config user.name","closed_at":"2026-02-25T16:11:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a0408b037327a4eaf38889e7faab7d9d189a86a4ac51e1757528ec5bbb3a23db","created_at":"2026-02-25T16:11:20Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"safecmd.Git injects -c user.name=Thrum on every git command, which overrides git config --get user.name in the user.identify RPC. Fix: gitConfigValue() uses exec.Command directly to bypass the override.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-79d","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix user.identify returning Thrum instead of git username","updated_at":"2026-02-25T16:11:25Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"CSS variable migration complete","closed_at":"2026-02-24T18:35:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6197857f8441ef96aa94db2c4180f4d74087b1862bfde926a915b338d2d16b48","created_at":"2026-02-24T16:19:25Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Replace all hardcoded cyan-* Tailwind classes and #0d1120 hex values with CSS variable tokens across 17+ UI files. Add 4 new CSS variables. Fix dialog/panel backgrounds to use --panel-bg-start. Fix MessageBubble hardcoded hex colors for light mode. Do NOT modify tailwind.config.js. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups A + D5 + D6.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"CSS Variable Migration — Replace hardcoded cyan with CSS var tokens","updated_at":"2026-02-24T18:35:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:04:14Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0fbb58697c518d48bf74ea35bd7b111c2090ef37ed32e8c775053145a21a25b1","created_at":"2026-02-24T16:21:38Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/index.css\n\n## Steps\n1. Add to :root section: --accent-glow-soft: transparent; --accent-glow-hover: transparent; --mention-highlight: rgba(8, 145, 178, 0.1); --mention-highlight-self: rgba(8, 145, 178, 0.2);\n2. Add to .dark section: --accent-glow-soft: rgba(56, 189, 248, 0.3); --accent-glow-hover: rgba(56, 189, 248, 0.6); --mention-highlight: rgba(56, 189, 248, 0.15); --mention-highlight-self: rgba(56, 189, 248, 0.3);\n\n## Acceptance Criteria\n- [ ] 4 new variables in :root with light values\n- [ ] 4 new variables in .dark with dark values\n- [ ] Build passes: cd ui \u0026\u0026 pnpm build","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add 4 new CSS variables to index.css for both :root and .dark","updated_at":"2026-02-24T17:04:14Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:09:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"17d0d90326a779bbd8a72cca5784cc50d1cb51062a8d69e5f76e379385903929","created_at":"2026-02-24T16:21:53Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/ui/button.tsx (5 cyan + 2 shadow rgbas)\n- Modify: ui/packages/web-app/src/components/ui/card.tsx (1 cyan + 1 shadow + slate gradient)\n- Modify: ui/packages/web-app/src/components/ui/dialog.tsx (1 cyan + 1 shadow + gradient → --panel-bg-start/--panel-bg-end)\n- Modify: ui/packages/web-app/src/components/ui/badge.tsx (3 cyan patterns)\n- Modify: ui/packages/web-app/src/components/ui/ScopeBadge.tsx (3 cyan classes)\n\n## Steps\nApply the canonical mapping from RECOVERY_PLAN.md section A2. Key mappings:\n- text-cyan-400/500 → text-[var(--accent-color)]\n- border-cyan-500/10-30 → border-[var(--accent-border)]\n- ring-cyan-500 → ring-[var(--accent-color)]\n- from-cyan-600 → from-[var(--accent-hover)]\n- to-cyan-500 → to-[var(--accent-color)]\n- from-slate-900 to-slate-800 → from-[var(--panel-bg-start)] to-[var(--panel-bg-end)]\n- shadow rgba(56,189,248,...) → shadow-[0_0_15px_var(--accent-glow-soft)]\n\nIMPORTANT: dialog.tsx gradient must use --panel-bg-start/--panel-bg-end (NOT --app-bg-secondary)\n\n## Acceptance Criteria\n- [ ] 0 cyan- references in these 5 files\n- [ ] Build passes","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Replace cyan classes in UI primitives (button, card, dialog, badge, ScopeBadge)","updated_at":"2026-02-24T17:09:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:09:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1dc7f936283459a8f56132adba5326a4150a3625d0b7ac2e230f6ab1d2715f5a","created_at":"2026-02-24T16:22:00Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/ComposeBar.tsx (19 cyan + 1 hex)\n- Modify: ui/packages/web-app/src/components/groups/GroupChannelView.tsx (38 cyan + 2 hex — largest)\n- Modify: ui/packages/web-app/src/components/inbox/MessageBubble.tsx (3 inline rgba + hardcoded hex colors for light mode D5)\n- Modify: ui/packages/web-app/src/components/status/HealthBar.tsx (2 cyan)\n- Modify: ui/packages/web-app/src/components/agents/AgentCard.tsx (1 cyan)\n- Modify: ui/packages/web-app/src/components/Sidebar.tsx (5 cyan)\n- Modify: ui/packages/web-app/src/components/coordination/WhoHasView.tsx (3 cyan)\n- Modify: ui/packages/web-app/src/components/subscriptions/SubscriptionPanel.tsx (2 cyan)\n\n## Steps\nApply canonical mapping from RECOVERY_PLAN.md A2. Key notes:\n- bg-[#0d1120] → bg-[var(--panel-bg-start)] (NOT --app-bg-secondary — causes transparent panels)\n- MessageBubble: also fix hardcoded hex text-[#e2e8f0], text-[#cbd5e1], text-[#64748b] → use CSS vars (text-[var(--text-secondary)] etc.)\n- MessageBubble: hover:bg-[rgba(56,189,248,0.04)] → hover:bg-[var(--accent-subtle-bg)]\n- MessageBubble inline mention rgba styles → var(--mention-highlight), var(--mention-highlight-self)\n- MentionAutocomplete.tsx: bg-popover → bg-[var(--panel-bg-start)] on dropdown container\n- Leave yellow/amber, red, purple, gray untouched\n\n## Acceptance Criteria\n- [ ] 0 cyan- references in all component .tsx files\n- [ ] 0 #0d1120 references\n- [ ] Build passes","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Replace cyan classes in feature components (ComposeBar, GroupChannelView, MessageBubble, 5 others)","updated_at":"2026-02-24T17:09:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:10:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6194edfb63b23f828168d9bdce1ec54e535163035ea5301756b6d3ffa17300bd","created_at":"2026-02-24T16:22:07Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/status/__tests__/HealthBar.test.tsx\n- Modify: ui/packages/web-app/src/components/agents/__tests__/AgentCard.test.tsx\n- Modify: ui/packages/web-app/src/components/ui/__tests__/ScopeBadge.test.tsx\n- Modify: ui/packages/web-app/src/components/inbox/__tests__/MessageBubble.test.tsx (hover class assertion)\n\n## Steps\nUpdate any assertions that check for cyan-* classes or rgba values to use the new CSS variable equivalents:\n- hover:bg-[rgba(56,189,248,0.04)] → hover:bg-[var(--accent-subtle-bg)]\n- ring-cyan-500 → ring-[var(--accent-color)]\n- text-cyan-400 → text-[var(--accent-color)]\n- border-cyan-500/20 → border-[var(--accent-border)]\n\n## Acceptance Criteria\n- [ ] All 473+ tests pass: cd ui \u0026\u0026 pnpm test -- -- --run\n- [ ] Build passes: cd ui \u0026\u0026 pnpm build\n- [ ] grep -r cyan- ui/packages/web-app/src/components/ --include=*.tsx returns 0 results","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update test files for CSS variable migration","updated_at":"2026-02-24T17:10:39Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All tasks implemented and verified","closed_at":"2026-02-27T22:20:03Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"31c5061b212dd9157d46dc5b0bca975010c2517702b99b24c80cf3fba7e82f2c","created_at":"2026-02-27T21:48:55Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Fix agent name auto-generation and relax validation to allow hyphens. Three tasks: allow hyphens in regex, sanitize auto-generated names, add validation to HandleRegister RPC.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7iv","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Agent Name Validation Fix","updated_at":"2026-02-27T22:20:03Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T22:20:02Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"52ff61d2a5ed53e2299b19bcf6829a6d086ff9a7a512227f51d662cfac720a3b","created_at":"2026-02-27T21:49:28Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `internal/identity/identity.go` (regex, ValidateAgentName, doc comment)\n- Test: `internal/identity/identity_test.go`\n\n## Steps\n\n### Step 1: Write failing tests\n\nAdd test cases to identity_test.go for ValidateAgentName:\n- `\"alice-agent\"` → should pass (currently fails)\n- `\"impl-backup-restore\"` → should pass\n- `\"a-b-c\"` → should pass\n- `\"-leading\"` → should still fail (starts with hyphen)\n- `\"trailing-\"` → should still fail (ends with hyphen)\n\n### Step 2: Update regex and error message\n\nIn `internal/identity/identity.go`:\n- Line 24: Change `agentNameRegex` from `^[a-z0-9_]+$` to `^[a-z0-9][a-z0-9_-]*[a-z0-9]$|^[a-z0-9]$`\n  (allows hyphens in middle, requires alphanumeric start/end, single char OK)\n- Line 224: Update error message to mention hyphens\n- Lines 202-208: Update doc comment to list hyphens as allowed\n\n### Step 3: Verify\n\n```bash\ngo test ./internal/identity/... -run TestValidateAgentName -v -race\n```\n\n## Acceptance Criteria\n\n- [ ] Names with hyphens like `alice-agent` pass validation\n- [ ] Leading/trailing hyphens rejected\n- [ ] Existing valid names still pass\n- [ ] Existing invalid names still fail (uppercase, dots, spaces)\n- [ ] `isBase32Hash` unaffected (hyphens not in Crockford alphabet)\n- [ ] Consistent with `safeIdentifierRE` in `internal/cli/runtime_init.go`","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7iv.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Allow hyphens in agent name regex","updated_at":"2026-02-27T22:20:02Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T22:20:02Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"44447e62c900fdd04036309c325cb2021c829d22aa1971d15ef4835017b8150d","created_at":"2026-02-27T21:49:28Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/identity/sanitize.go` (new file for SanitizeAgentName)\n- Create: `internal/identity/sanitize_test.go`\n- Modify: `cmd/thrum/main.go` (~lines 370-375, ~lines 407-414 — two auto-gen sites)\n\n## Steps\n\n### Step 1: Write failing tests\n\nCreate `internal/identity/sanitize_test.go`:\n\n```go\nfunc TestSanitizeAgentName(t *testing.T) {\n    tests := []struct {\n        input, expected string\n    }{\n        {\"citationsBranch\", \"citationsbranch\"},\n        {\"feature/backup-restore\", \"feature_backup-restore\"},\n        {\"my.branch.name\", \"my_branch_name\"},\n        {\"UPPERCASE\", \"uppercase\"},\n        {\"already_valid\", \"already_valid\"},\n        {\"with spaces\", \"with_spaces\"},\n        {\"__leading__trailing__\", \"leading__trailing\"},\n        {\"a/b/c\", \"a_b_c\"},\n        {\"feature/UI-Recovery\", \"feature_ui-recovery\"},\n    }\n    for _, tt := range tests {\n        t.Run(tt.input, func(t *testing.T) {\n            got := SanitizeAgentName(tt.input)\n            assert.Equal(t, tt.expected, got)\n        })\n    }\n}\n```\n\n### Step 2: Implement SanitizeAgentName\n\nCreate `internal/identity/sanitize.go`:\n\n```go\n// SanitizeAgentName converts an arbitrary string into a valid agent name.\n// - Lowercases the input\n// - Replaces invalid characters (dots, slashes, spaces, etc.) with underscores\n// - Preserves hyphens (valid in agent names)\n// - Collapses consecutive underscores\n// - Strips leading/trailing underscores and hyphens\nfunc SanitizeAgentName(name string) string {\n    name = strings.ToLower(name)\n    // Replace invalid chars with underscore (keep a-z, 0-9, _, -)\n    var b strings.Builder\n    for _, r := range name {\n        if (r \u003e= 'a' \u0026\u0026 r \u003c= 'z') || (r \u003e= '0' \u0026\u0026 r \u003c= '9') || r == '_' || r == '-' {\n            b.WriteRune(r)\n        } else {\n            b.WriteRune('_')\n        }\n    }\n    result := b.String()\n    // Collapse consecutive underscores\n    for strings.Contains(result, \"__\") {\n        result = strings.ReplaceAll(result, \"__\", \"_\")\n    }\n    // Strip leading/trailing underscores and hyphens\n    result = strings.Trim(result, \"_-\")\n    return result\n}\n```\n\n### Step 3: Wire into auto-generation in cmd/thrum/main.go\n\nAt ~line 375 (interactive init):\n```go\ndefaultName = agentRoleResolved + \"_\" + identity.SanitizeAgentName(mod)\n```\n\nAt ~line 414 (non-interactive):\n```go\nagentNameResolved = agentRoleResolved + \"_\" + identity.SanitizeAgentName(module)\n```\n\n### Step 4: Verify\n\n```bash\ngo test ./internal/identity/... -run TestSanitize -v -race\ngo test ./cmd/thrum/... -v -race\n```\n\n## Acceptance Criteria\n\n- [ ] Branch name `citationsBranch` produces `coordinator_citationsbranch`\n- [ ] Branch name `feature/backup-restore` produces `coordinator_feature_backup-restore`\n- [ ] Both interactive and non-interactive paths sanitize\n- [ ] Sanitized names pass ValidateAgentName\n- [ ] All existing tests still pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7iv.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Sanitize auto-generated agent names","updated_at":"2026-02-27T22:20:02Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-27T22:20:02Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"66c51f6676f9ca5429f6a126f8c02e3d5fd2969f5de28a021eab3a41bfe95231","created_at":"2026-02-27T21:49:28Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `internal/daemon/rpc/agent.go` (HandleRegister, ~line 164)\n- Test: `internal/daemon/rpc/agent_test.go`\n\n## Steps\n\n### Step 1: Write failing test\n\nAdd to agent_test.go a test that attempts to register with an invalid name:\n\n```go\nfunc TestHandleRegister_InvalidName(t *testing.T) {\n    // Register with uppercase name should fail\n    resp, err := handler.HandleRegister(ctx, mustMarshal(RegisterRequest{\n        Name:   \"Invalid_Name\",\n        Role:   \"tester\",\n        Module: \"main\",\n    }))\n    assert.Error(t, err)\n    assert.Contains(t, err.Error(), \"invalid agent name\")\n    assert.Nil(t, resp)\n}\n```\n\n### Step 2: Add validation to HandleRegister\n\nIn `internal/daemon/rpc/agent.go`, after the existing field validation (~line 176) and before `GenerateAgentID` (~line 180), add:\n\n```go\n// Validate agent name format (only when explicitly named)\nif req.Name != \"\" {\n    if err := identity.ValidateAgentName(req.Name); err != nil {\n        return nil, fmt.Errorf(\"invalid agent name: %w\", err)\n    }\n}\n```\n\n### Step 3: Fix any existing tests using invalid names\n\nCheck `internal/daemon/rpc/message_test.go:1931-1932` which registers `\"alice-agent\"` — this should now pass since hyphens are allowed (Task 1). If any test uses uppercase names, fix them.\n\n### Step 4: Verify\n\n```bash\ngo test ./internal/daemon/rpc/... -run TestHandleRegister -v -race\ngo test ./internal/daemon/rpc/... -v -race\n```\n\n## Acceptance Criteria\n\n- [ ] HandleRegister rejects names with uppercase characters\n- [ ] HandleRegister rejects names with dots, spaces, special chars\n- [ ] HandleRegister accepts valid names (lowercase, digits, underscores, hyphens)\n- [ ] HandleRegister still works for unnamed agents (req.Name == \"\")\n- [ ] Existing `alice-agent` test passes (hyphens now valid from Task 1)\n- [ ] All RPC tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7iv.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add validation to HandleRegister RPC","updated_at":"2026-02-27T22:20:02Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:40:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a3fb00cf985bcb43bde9c7647548e9b47849036363e1457a3d50a7ae0ea660ba","created_at":"2026-02-27T21:18:05Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `cmd/thrum/main.go` (add restore subcommand to backup group)\n\n## Steps\n\n### Step 1: Add restore subcommand\nAdd to the backupCmd() group:\n```\nthrum backup restore [archive.zip]\n```\n- Optional positional arg: path to zip archive\n- If omitted, restore from current/ in backup dir\n- --dir flag to override backup dir (same as thrum backup)\n- Confirmation prompt before proceeding (unless --yes flag)\n\n### Step 2: Integration test\nTest full round-trip: backup -\u003e corrupt/delete data -\u003e restore -\u003e verify data matches.\n\n### Step 3: Verify\n```bash\ngo build ./cmd/thrum/\n./thrum backup restore --help\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] thrum backup restore works from current/\n- [ ] thrum backup restore ./archive.zip works from zip\n- [ ] Confirmation prompt shown (--yes to skip)\n- [ ] Error message if no backup found\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-85u","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Wire up thrum backup restore CLI","updated_at":"2026-02-28T18:40:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed: Wait now auto-reconnects to daemon with 60s retry. Also fixed user.identify returning Thrum instead of git username (safecmd.Git override).","closed_at":"2026-02-25T15:59:01Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2b4f9dd945d826294d03191a5e7b6a854b3794bb7e0881e6cc5b861aa3cc4928","created_at":"2026-02-25T15:58:50Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-8nq","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix thrum wait orphaned on daemon restart","updated_at":"2026-02-25T15:59:01Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4f142db260ad885041f45b3ea6d1c3a020f3f7f1262ee6b5bd0a5ea86c0a66fd","created_at":"2026-02-24T16:19:55Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"New work: (E) Wire user.identify RPC into AppShell auto-registration to show git config user.name instead of 'thrum'. (F) Redesign AgentContextPanel from large bordered card to thin header bar + gear icon slide-out panel matching GroupChannelView pattern. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups E + F.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Agent View Redesign + Git Username — Minimal header, gear slide-out","updated_at":"2026-02-26T06:51:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"7d3d120e9ed2252ae5ac1253ef5b3bdb4c48b32d8197cf0f44dba787675a2278","created_at":"2026-02-24T16:22:07Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/AppShell.tsx\n\n## Steps\n1. In AppShell auto-registration flow, call user.identify RPC first to get git config user.name\n2. Pass the real name to user.register instead of hardcoded 'thrum'\n3. Fallback to 'thrum' if user.identify fails\n\n## Acceptance Criteria\n- [ ] UI header shows git config user.name instead of 'Thrum'\n- [ ] Fallback works if git config not set","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Wire user.identify RPC into AppShell for git username display","updated_at":"2026-02-26T06:51:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6876b26074e9d59456761bef7042407a39e4c76d0647aadbc98041e8106e56ec","created_at":"2026-02-24T16:22:19Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/agents/AgentContextPanel.tsx\n- Test: ui/packages/web-app/src/components/agents/__tests__/AgentContextPanel.test.tsx\n\n## Steps\n1. Replace the large bordered card with a thin header bar (~40px height):\n   - Status dot (online/offline) + agent display name (bold) + role badge + intent text (truncated) + gear icon button\n2. Add gear icon click → slide-out panel (absolute right, w-72, same pattern as GroupChannelView settings):\n   - Full agent details: AGENT ID, ROLE, INTENT, TASK, BRANCH, UNCOMMITTED (with file list), CHANGED, HEARTBEAT\n   - Delete Agent button at bottom behind border-top divider\n   - Close X button at top-right\n3. Move AgentDeleteDialog trigger inside the slide-out panel\n4. Update tests to match new structure\n\nReference: ui/packages/web-app/src/components/groups/GroupChannelView.tsx lines 170-400 for the slide-out pattern\n\n## Acceptance Criteria\n- [ ] Agent header is a single thin bar (not a large card)\n- [ ] Gear icon opens slide-out panel with full details\n- [ ] Delete Agent is inside slide-out, not inline\n- [ ] Messages get maximum vertical space\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Redesign AgentContextPanel: thin header bar + gear slide-out","updated_at":"2026-02-26T06:51:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"301cd8fb913a48e488f1a60382e3c716e01a7f43ce6f8f76701160541e533fb3","created_at":"2026-02-25T00:15:38Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The UI's auto-registration flow in AppShell.tsx registers a 'thrum' user agent via user.register RPC. This agent then appears in the sidebar agent list as 'Thrum' alongside real agents. Either: (a) the UI user should not appear in the agent list, or (b) the agent list should filter out user-type agents. Investigate how AppShell registers and whether the agent list RPC can exclude UI users.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.3","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix phantom 'Thrum' agent in sidebar","updated_at":"2026-02-25T16:55:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"340671237b6dde4a4852c9ddb8043d7a29299e728bcd9afb7c61935c5c07425a","created_at":"2026-02-25T00:15:40Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"My Inbox view shows 'No messages' even though messages exist. Root cause: the UI registers as 'thrum' (hardcoded) via user.register, but actual messages are addressed to real agent names like @coordinator_main. The inbox filter matches against the UI's registered identity ('thrum') and finds nothing. Fix: wire user.identify RPC to get git username, then use that as the UI identity so inbox filtering works. This is closely related to thrum-9b7.1 (git username display) — the same user.identify call fixes both the display name and the inbox filter.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.4","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix My Inbox empty — UI identity mismatch drops all messages","updated_at":"2026-02-25T16:55:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"F2-2 multi-agent who-has test added","closed_at":"2026-03-01T05:13:50Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"94c802815e27f267521f0000dc9bea7680d901f1f44f18139277943649478a9f","created_at":"2026-03-01T00:23:36Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The plan specified a test where both coordinator and implementer worktrees modify the same tracked file, then `who-has` shows both agents. The current F2-2 was replaced with a JSON output test (plan's F2-4). Need to add the original F2-2 scenario back.\n\nFile: tests/e2e/coordination.spec.ts\n\nAcceptance criteria:\n- Both e2e_coordtest and e2e_implementer (or dedicated agents) modify the same committed file\n- `thrum who-has \u003cfile\u003e` output references both agents\n- Test passes consistently with workers:1","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9yf","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-03-01T05:13:50Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T23:05:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"36a913e7a30c1fdbb8575ad4474608a022ecb48ff14260ea536edb9bfe3b40c3","created_at":"2026-02-28T22:08:15Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Expand coordination.spec.ts — CLI Commands (F2-1 through F2-8)\n\n### Files\n- Modify: `tests/e2e/coordination.spec.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 9)\n\n### Tests to Add (inside existing describe block)\n- F2-2: who-has with multiple agents editing same file (both worktrees modify, verify both shown)\n- F2-3: who-has with no agents editing (should not error)\n- F2-4: who-has JSON output (--json flag, parse result)\n- F2-5: agent set-intent updates intent\n- F2-6: agent heartbeat\n- F2-7: agent list --context shows context\n- F2-8: team shows activity and status (text + JSON)\n- F2-13: status standalone command\n\nImport thrumIn from thrum-cli. For multi-worktree tests, create test files, commit, modify in both worktrees, verify who-has output, then clean up with git reset.\n\n### Acceptance Criteria\n- [ ] All new tests pass alongside existing SC-30–33 tests\n- [ ] Test repo left clean after who-has tests (git reset in finally blocks)\n\n### Commit\n```\ngit commit -m \"test(e2e): expand coordination tests — who-has, intent, heartbeat (F2-1–F2-8)\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-a8y","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Expand coordination.spec.ts with CLI command tests","updated_at":"2026-02-28T23:05:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"d8f272ae30d4e1206c1690fb5a5dde21d98f170ee9573b898553cbea74d7c395","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-aya","is_template":0,"issue_type":"chore","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Archive completed dev-docs (RECOVERY_PLAN, ui-recovery prompt)","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"multi-agent.spec.ts already exists with SC-58 to SC-64","closed_at":"2026-02-28T23:05:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9f063215c7a6bf1c68fc44addd52abaa8f79ce88b0374f58a192eeeacb242065","created_at":"2026-02-28T22:08:20Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Write multi-agent.spec.ts — Cross-Worktree Messaging (K2-K5)\n\n### Files\n- Create: `tests/e2e/multi-agent.spec.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 10)\n\n### Tests to Write (serial mode, beforeAll clears inboxes)\n- K2: Send includes CallerAgentID (send from coord, check impl inbox JSON for agent_id)\n- K3: Inbox filters by agent (send to impl, verify NOT in coord inbox, IS in impl inbox)\n- K5: Wait receives @everyone broadcasts\n- K6: Agent list shows agent_id in JSON\n\n### Acceptance Criteria\n- [ ] All 4 tests pass\n- [ ] Cross-worktree message delivery verified\n\n### Commit\n```\ngit commit -m \"test(e2e): add multi-agent.spec.ts — cross-worktree messaging (K2-K5)\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-bju","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Write multi-agent.spec.ts — cross-worktree tests","updated_at":"2026-02-28T23:05:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All 4 tasks complete. Git context flows through heartbeat, JSON fields aligned, team shows branch and file changes.","closed_at":"2026-03-01T06:41:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ac9345d86aba88e2e5ee9cae40c187fa5f7b85f1ab487cb02146efcf62bf83f2","created_at":"2026-03-01T06:32:48Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"thrum team shows empty git data for all agents and JSON output is inconsistent with whoami. Root cause: quickstart/session-start never sets a worktree ref, so heartbeat has no path for git extraction. Additionally, team --json uses different field names than whoami --json for the same concepts (worktree_path vs worktree). Fix: auto-set worktree ref on session start, align JSON field names, and confirm the existing display code works once data flows.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-bmu","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Team Command Git Context \u0026 JSON Consistency","updated_at":"2026-03-01T06:41:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Quickstart and session-start now auto-set worktree ref from git toplevel. Git context flows through heartbeat.","closed_at":"2026-03-01T06:38:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"19cf9b30cc818e924e883a50a0571afb342a4fd6944bd51db1333300040d7456","created_at":"2026-03-01T06:33:01Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"PROBLEM: Heartbeat handler calls getWorktreePath() which queries session_refs for ref_type='worktree'. Neither quickstart nor session-start ever sets this ref, so git context extraction is always skipped.\n\nFILES:\n- internal/cli/quickstart.go — after session.start RPC succeeds, add a worktree ref\n- cmd/thrum/main.go — sessionStartRunE: same fix\n- internal/daemon/rpc/session.go — HandleStart: auto-detect and set worktree ref server-side (preferred, single fix point)\n\nAPPROACH (pick one):\nA) Server-side: In HandleStart/HandleHeartbeat, if no worktree ref exists, detect git root from the agent's registered module/hostname context and auto-set it\nB) Client-side: In quickstart.go and sessionStartRunE, after session.start succeeds, send a heartbeat with --add-ref worktree:$(git rev-parse --show-toplevel)\nC) Hybrid: HandleStart accepts an optional worktree_path param, CLI sends it, server stores it as a session ref\n\nRecommended: Option C — CLI sends the path (it knows CWD), server stores it. Add worktree_path to SessionStartRequest, and in HandleStart insert it into session_refs.\n\nACCEPTANCE:\n- After 'thrum quickstart', session_refs contains a worktree ref with the git root path\n- After 'thrum session start', same\n- 'thrum session heartbeat' extracts git context (branch, unmerged commits, file changes)\n- 'thrum team' shows Branch and Files sections with real data","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-bmu.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Auto-set worktree ref on quickstart and session start","updated_at":"2026-03-01T06:38:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Renamed worktree_path to worktree in TeamMember JSON tags (both daemon and CLI structs)","closed_at":"2026-03-01T06:38:19Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"911c4e3f0f246960b18e667549d751518ed1f1c1a4abd7f68c5acd6bcf760925","created_at":"2026-03-01T06:33:09Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"PROBLEM: thrum team --json outputs TeamMember with worktree_path, while thrum whoami --json outputs AgentSummary with worktree. Same concept, different field names. Consumers parsing both outputs must handle two names for the same thing.\n\nFILES:\n- internal/daemon/rpc/team.go — TeamMember struct: rename worktree_path json tag to worktree\n- internal/cli/team.go — CLI-side TeamMember struct: same rename\n- internal/cli/team.go — FormatTeam(): update any references to WorktreePath field name\n\nCHANGES:\n1. TeamMember.WorktreePath json:`worktree_path` → json:`worktree`\n2. Update FormatTeam() to use the renamed field\n3. Verify team.go tests still pass after rename\n\nACCEPTANCE:\n- thrum team --json shows 'worktree' not 'worktree_path'\n- thrum whoami --json and thrum team --json use identical field names for shared concepts\n- Existing tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-bmu.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Align TeamMember JSON field names with AgentSummary","updated_at":"2026-03-01T06:38:19Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"HeartbeatResponse now includes branch, unmerged_commits, and file_changes. Removed extra AgentListContext RPC call from CLI.","closed_at":"2026-03-01T06:41:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6dc92295a108876da0b24daf1584995330fead6af63cba8b760e083f05124eb6","created_at":"2026-03-01T06:33:18Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"PROBLEM: HeartbeatResponse only returns session_id and last_seen_at. The heartbeat extracts git context and writes it to agent_work_contexts, but the caller never sees it. The CLI formatter (FormatHeartbeat) could display branch/files if the response included them.\n\nFILES:\n- internal/daemon/rpc/session.go — HeartbeatResponse struct: add Branch, UnmergedCommits, FileChanges, WorktreePath\n- internal/daemon/rpc/session.go — HandleHeartbeat: populate response fields after updateWorkContext\n- internal/cli/session.go or agent.go — FormatHeartbeat: display git context if present\n\nCHANGES:\n1. Extend HeartbeatResponse with optional git fields (branch, unmerged_commits count, file_changes)\n2. After updateWorkContext succeeds, populate the response from the extracted gitCtx\n3. Update FormatHeartbeat to show the git summary\n\nACCEPTANCE:\n- thrum session heartbeat --json includes branch, unmerged_commits, file_changes when available\n- thrum session heartbeat (human) shows a git context summary\n- No change when worktree ref is missing (graceful degradation)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-bmu.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Include git context in heartbeat response","updated_at":"2026-03-01T06:41:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"FormatTeam correctly displays git data — Branch with commit count and Files with diffs confirmed working.","closed_at":"2026-03-01T06:41:31Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0b663b9bd4b29cf8f545ce23a5856be608ab1ace6c9d0cd48033353877b1c742","created_at":"2026-03-01T06:33:28Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"PROBLEM: FormatTeam in internal/cli/team.go already has code to display Branch (N commits ahead) and FileChanges. But since git data was never populated (thrum-bmu.1), this code path has never been exercised in practice. It may have bugs.\n\nFILES:\n- internal/cli/team.go — FormatTeam(): verify branch + commit count display, file changes display\n- internal/cli/team_test.go — add/update tests with populated git data\n\nDEPENDS ON: thrum-bmu.1 (worktree ref must be set so data flows)\n\nCHANGES:\n1. After thrum-bmu.1 is complete, run thrum session heartbeat then thrum team and verify output matches expected format\n2. Expected format per agent with git data:\n   Branch:   thrum-dev (2 commits ahead)\n   Files:\n     internal/backup/restore.go   5m ago   +9  -2\n3. Fix any formatting bugs found\n4. Add test cases to team_test.go with populated UnmergedCommits and FileChanges\n\nACCEPTANCE:\n- thrum team shows Branch line with commit count for agents with git data\n- thrum team shows Files section with path, time ago, +additions -deletions\n- thrum team shows 'Files: (no changes)' when no uncommitted changes exist\n- Tests cover both populated and empty git data cases","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-bmu.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Verify FormatTeam displays git data correctly once populated","updated_at":"2026-03-01T06:41:31Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Post-backup hook with env vars, 60s timeout, non-fatal failures. 3 tests pass.","closed_at":"2026-02-28T18:46:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8569d8740829a3f930234bc3d0c9122bd7c77423c98a4b1bc514d2fda618dd87","created_at":"2026-02-27T21:17:42Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `internal/backup/backup.go` (add post_backup command execution after all backups)\n- Modify: `internal/config/daemon.go` (add PostBackup string field to BackupConfig)\n- Create: `internal/backup/post_hook.go` (post-backup command runner)\n- Create: `internal/backup/post_hook_test.go`\n\n## Steps\n\n### Step 1: Add PostBackup to config\nAdd `PostBackup string` field to BackupConfig in daemon.go.\n\n### Step 2: Implement post-backup hook runner\n```go\nfunc RunPostBackup(command, repoPath, backupDir, repoName, currentDir string) error\n```\n- Run command via `sh -c` with CWD=repoPath\n- Set environment variables:\n  - THRUM_BACKUP_DIR = backupDir\n  - THRUM_BACKUP_REPO = repoName\n  - THRUM_BACKUP_CURRENT = currentDir path\n- 60s timeout\n- Non-fatal: warn on failure, don't fail the backup\n\n### Step 3: Wire into RunBackup orchestrator\nCall RunPostBackup as the final step after rotation completes.\n\n### Step 4: Add CLI support\n`thrum backup config set post-backup 'bash dev-docs/dev-scripts/sync-dev-docs.sh'`\n\n### Step 5: Verify\n```bash\ngo test ./internal/backup/... -run TestPostBackup -v -race\n```\n\n## Acceptance Criteria\n- [ ] post_backup command runs after all backups complete\n- [ ] Environment variables set correctly\n- [ ] Failure is non-fatal (warns, backup still succeeds)\n- [ ] 60s timeout enforced\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-chr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement post-backup hook execution","updated_at":"2026-02-28T18:46:28Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"sessions.spec.ts already exists with SC-10 to SC-14","closed_at":"2026-02-28T23:05:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"152c8922a6560434c96bdeb5a6675534d3df0d64507b2b8b08a8245b037d8782","created_at":"2026-02-28T22:07:53Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Write session.spec.ts — Agent Registration \u0026 Sessions (D1-D4)\n\n### Files\n- Create: `tests/e2e/session.spec.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 6)\n\n### Tests to Write\n- D2: Verify coordinator identity via whoami (THRUM_NAME=e2e_coordinator)\n- D3: Verify implementer identity via whoami (THRUM_NAME=e2e_implementer)\n- D4: Team roster shows both agents\n- D4-json: Team roster JSON is valid\n\nUse `thrumIn()` with coordinator/implementer dirs and env vars.\n\n### Acceptance Criteria\n- [ ] All 4 tests pass against the global test environment\n- [ ] Tests use proper env vars for identity resolution\n\n### Commit\n```\ngit commit -m \"test(e2e): add session.spec.ts — agent registration \u0026 team roster (D1-D4)\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-ckr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Write session.spec.ts — agent registration tests","updated_at":"2026-02-28T23:05:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"371780a7431a6986d3b8d86d42975b1b6de23ab8933499fc9ba095ae478c5a1f","created_at":"2026-03-01T05:14:58Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Bugs discovered during E2E test drift fix work (thrum-22y). These are product-level issues, not test issues.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"E2E-Discovered Bugs","updated_at":"2026-03-01T05:14:58Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Not a bug. exclude_self=true is correct behavior — agents should not see their own messages (DMs or broadcasts) in their inbox. The 7 test failures were caused by tests checking the sender's inbox for sent messages instead of checking the recipient's inbox. This was fixed in thrum-2ug.2 by rewriting tests to verify delivery on the receiver side.","closed_at":"2026-03-01T08:38:00Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"e92e7ddb4c12903c7ba827cfcd8eb14ea9a25b3a92cf3effee3c78cb59496228","created_at":"2026-03-01T05:15:05Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The inbox command hardcodes exclude_self=true (internal/cli/inbox.go:76). This means an agent can never see messages it sent in its own inbox. This is by design for DMs (sender shouldn't see outbound in inbox), but for broadcasts sent to @everyone, the sender's broadcast also disappears from their own inbox. This caused 7+ test failures. Consider: should broadcasts be visible to the sender in their own inbox? Or add an --include-self flag?","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.1","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Inbox exclude_self hides own broadcasts","updated_at":"2026-03-01T08:38:00Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"435199a5b8cbc9cf963c65f48bfab381932c95a0e1b9a76b80267efa1db92611","created_at":"2026-03-01T07:21:37Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Summary\n`thrum sync force` in local-only mode writes message data to the a-sync worktree but does NOT commit the changes to the a-sync git branch. This makes cross-machine sync via `git push/fetch` impossible without remote sync configuration.\n\n## Affected Tests\n- `tests/e2e/sync.spec.ts` — SC-41: Cross-machine sync via git push/pull (test.fixme)\n\n## Symptoms\n1. `thrum init` creates the `a-sync` branch and worktree at `.git/thrum-sync/a-sync/`\n2. `thrum send \"message\"` — message stored in daemon DB\n3. `thrum sync force` — reports \"synced\", writes JSONL files to worktree\n4. `git show a-sync:` — only shows `events.jsonl`, NO `messages/` directory\n5. Worktree at `.git/thrum-sync/a-sync/` has uncommitted files:\n   - `messages/\u003cagent\u003e.jsonl` (per-agent message files)\n   - `\u003cagent\u003e.jsonl` (agent-level events)\n   - `events.jsonl.merge.tmp`\n\nThe worktree has the data but it's never committed to the branch, so `git push origin a-sync` pushes stale data.\n\n## Root Cause\n`sync force` in local-only mode (no Tailscale/remote configured) writes JSONL data to the a-sync worktree directory but skips the `git add` + `git commit` step. The sync status shows \"local-only (remote sync disabled)\".\n\nThe sync code likely has a conditional path:\n- **Remote sync enabled**: write to worktree → git add → git commit → git push\n- **Local-only**: write to worktree → stop (no commit)\n\n## Key Files\n- `internal/daemon/rpc/subscribe.go` — sync notification dispatch\n- `internal/daemon/state/` — sync state management\n- Sync manager code (location TBD — search for `syncManager`, `BroadcastNotify`)\n\n## Verified Behavior\n```bash\n# After thrum init + quickstart + send + sync force:\n$ git show a-sync:\nevents.jsonl           # ← only structural events, no messages/\n\n$ ls .git/thrum-sync/a-sync/\nevents.jsonl           # committed\nevents.jsonl.merge.tmp # uncommitted\nmessages/              # uncommitted — contains per-agent JSONL\nsc41test.jsonl         # uncommitted\n```\n\n## Expected Behavior\n`sync force` should commit all worktree changes to the a-sync branch regardless of remote sync configuration, so that users can manually `git push origin a-sync` for cross-machine sync without requiring Tailscale.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.10","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"sync force local-only mode doesn't commit messages to a-sync branch (SC-41)","updated_at":"2026-03-01T07:25:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9986260e36b38d774b6c025f3f2c8879ace4a9039b82b0b6d1c206b9ed3f4b56","created_at":"2026-03-01T08:29:55Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"In tests/e2e/global-setup.ts, bare remote is created with 'git init --bare' which uses the system default branch name (may not be 'main'). Should use 'git init --bare --initial-branch=main' to ensure deterministic branch naming across environments.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.11","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"global-setup.ts uses 'git init' without --initial-branch=main","updated_at":"2026-03-01T08:29:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"cea1323235cb435af6769a5040155ff1d57168b491f0a08ff3e4ee1874a0835e","created_at":"2026-03-01T08:29:55Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"sync.spec.ts sets environment variables (THRUM_SYNC_REMOTE, etc.) that assume specific paths/values. These should derive from the global-setup fixtures to avoid breakage if the test infrastructure paths change.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.12","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"sync.spec.ts hardcodes env vars that may not match test environment","updated_at":"2026-03-01T08:29:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"452f4ea955db74896d828c51438f47af6925293dc53b1f65cc2ebeb216b4a2a3","created_at":"2026-03-01T08:29:55Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"agent-cleanup.spec.ts uses a getSyncDir() helper that constructs the sync directory path. This path assumption may not match the actual daemon sync directory if the daemon uses a different convention or the test environment differs from production layout.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.13","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"agent-cleanup.spec.ts getSyncDir() path assumption may not match actual daemon sync dir","updated_at":"2026-03-01T08:29:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed: moved role/module validation after identity reuse block, added cmd.Flags().Changed() guards so explicit CLI flags are never silently overridden by identity file values.","closed_at":"2026-03-01T08:42:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"dd4ab96718d4615f9aa4381d6a59f943069b7d5a1c27f305b5b28f79434a593a","created_at":"2026-03-01T05:15:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"When quickstart is called without --name and an identity file already exists, the identity reuse logic (cmd/thrum/main.go:3740) silently overrides --role and --module with the existing identity's values. This means `thrum quickstart --role coordinator` may actually register as a different role if a prior identity file exists. The override is silent — no warning is logged. This caused SC-05 failures. Fix: warn when overriding CLI flags, or don't override explicit flags.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.2","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Quickstart identity reuse silently overrides --role flag","updated_at":"2026-03-01T08:42:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed: daemon status --json now always exits 0 (running status is in the JSON body). Human-readable mode keeps exit 1 for Unix convention compatibility.","closed_at":"2026-03-01T08:44:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"474548a234789586dc494bc403cb71d977216fab06b0861ba5cc7e0397cf30d1","created_at":"2026-03-01T05:15:19Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"daemon status exits with code 1 when the daemon is not running. This is intentional for scripting (non-zero = not running), but the human-readable output ('not running') is only available on stdout of the failed process. Any wrapper using execFileSync or similar throws on exit 1, losing the output. Consider: exit 0 with a 'not running' status in JSON, or provide a --check flag that always exits 0.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.3","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"daemon status exit code 1 when not running loses output","updated_at":"2026-03-01T08:44:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"170b8814d28315aaf4253b621916e4ed73883d876ea08974bdadc35af0c95a61","created_at":"2026-03-01T05:15:25Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-54 (Agent list in sidebar) shows Agents(0) even after registering agents via CLI. The agents are registered and visible via `thrum agent list`, but the UI's agent list RPC returns 0. May be a timing issue, projection not updating after CLI registration, or the WebSocket not pushing agent registration events to the UI.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.4","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"UI agent list shows 0 agents after CLI registration","updated_at":"2026-03-01T05:15:25Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"cdba98ec1fc2c016a4c719ab805ed9f241660ba9864d9b391dc3f47775d57b81","created_at":"2026-03-01T05:15:30Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-13 session list command doesn't return the expected format. The test skips because the output doesn't match expectations. Needs investigation: what format does session list actually return vs what the test expects?","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.5","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"session list output format mismatch","updated_at":"2026-03-01T05:15:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"14a5d1197035c6356b821f97b10e67cc9ff7542fd637bbdf24806269ca6ebcc7","created_at":"2026-03-01T05:15:37Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"reply command creates a thread but the original message's thread_id field remains undefined/null. Expected: after replying to msg_xxx, `message get msg_xxx` should show the thread_id linking it to the auto-created thread. This may be by design (only the reply message gets thread_id) but it makes it impossible to navigate from original → thread.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.6","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Reply auto-thread doesn't set thread_id on original message","updated_at":"2026-03-01T05:15:37Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8a705fe3f6d17d87184740916482e577332a6673b1c062cf38aef71a8b0c57d0","created_at":"2026-03-01T05:52:16Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-50 ('Live Feed shows real messages') sends a broadcast via sendMessage() then checks if the page shows it. If the Live Feed applies exclude_self filtering like inbox does, this test will fail in CI but pass locally depending on timing. The test has no fixme despite the known ambiguity with exclude_self and broadcasts. Related to thrum-cv9.1 (inbox exclude_self hides own broadcasts).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.7","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"(BUG) SC-50 Live Feed may false-positive due to exclude_self on broadcasts","updated_at":"2026-03-01T05:52:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"499d5a237ecafc8c3b7453abd10b46d1c870850214d0eceabc106dc3d54019a8","created_at":"2026-03-01T07:21:36Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Summary\nWebSocket push notifications don't trigger Live Feed re-render in the web UI.\n\n## Affected Tests\n- `tests/e2e/web-ui.spec.ts` — SC-51: Live Feed real-time updates (test.fixme)\n- `tests/e2e/smoke.spec.ts` — smoke: CLI message sent while UI is open (test.fixme)\n\n## Symptoms\n1. Navigate to web UI, Live Feed is displayed\n2. Send a message via CLI while browser is open (`thrum send \"test\"`)\n3. Message sends successfully (confirmed via `inbox --json`)\n4. Live Feed does NOT update — message doesn't appear without manual page refresh\n\n## Root Cause Analysis\nThe WebSocket connection is established (health bar shows CONNECTED). The daemon broadcasts `sync.notify` events on new messages. However, the React Query invalidation triggered by WS push is not propagating to the `LiveFeed` component.\n\nThe data flow is:\n- WebSocket receives `sync.notify` → should trigger React Query cache invalidation\n- `useFeed()` → `useMessageList()` via RPC should re-fetch\n- `FeedItem` renders `item.preview` as text content\n\nThe break appears to be between the WS event handler and React Query's `invalidateQueries()` call.\n\n## Key Files\n- `ui/packages/web-app/src/components/LiveFeed.tsx` — LiveFeed component\n- `ui/packages/web-app/src/hooks/useFeed.ts` — useFeed hook (React Query)\n- `ui/packages/web-app/src/hooks/useWebSocket.ts` — WS connection + event handling\n- `ui/packages/shared-logic/src/hooks/useMessageList.ts` — message list query\n\n## Reproduction\n```bash\n# Terminal 1: start UI\nthrum daemon status  # ensure running\nopen http://localhost:\u003cport\u003e\n\n# Terminal 2: send message\nthrum send \"Real-time test $(date +%s)\"\n# Message should appear in Live Feed without refresh — it doesn't\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.8","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"WebSocket push notifications don't trigger Live Feed re-render (SC-51, smoke)","updated_at":"2026-03-01T07:24:55Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"425ed2f75d6a605f00a2bd72845a9401ed072d9b680058e0c9025c287e4a9b26","created_at":"2026-03-01T07:21:36Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Summary\n`thrum wait` exits with code 1 instead of delivering notifications when a matching message is sent during the wait period. The subscribe RPC works, but the wait command never receives the push.\n\n## Affected Tests\n- `tests/e2e/notifications.spec.ts` — SC-34: Subscribe to scope notifications (test.fixme)\n- `tests/e2e/notifications.spec.ts` — SC-35: Subscribe to mention notifications (test.fixme)\n- `tests/e2e/notifications.spec.ts` — SC-36: Subscribe to all / firehose (test.fixme)\n\n## Symptoms\nAll three tests follow the same pattern:\n1. `thrum subscribe --scope module:auth` (or `--mention @role`, or `--all`) — succeeds\n2. Start `thrum wait --scope module:auth --timeout 10s` in background\n3. Wait 1s for connection to establish\n4. `thrum send \"message\" --scope module:auth` — sends successfully\n5. `thrum wait` exits with code 1 (timeout), never receives the notification\n\n## Root Cause Analysis\nThe subscribe RPC creates the subscription successfully. The wait command establishes a connection and polls for matching messages. However, the daemon's subscription notification dispatch doesn't deliver the scoped/mention message to the waiting subscriber within the timeout window.\n\nPossible causes:\n- Subscribe and wait may use different subscription IDs (subscribe creates one, wait creates another?)\n- The wait command's poll interval may be too slow relative to the test timeout\n- Scope/mention filtering in the subscription dispatch may not match the send parameters\n- The `--scope` flag on `wait` may not correctly map to the subscribe RPC's filter params\n\n## Key Files\n- `internal/cli/wait.go` — Wait() function, subscribe/unsubscribe RPC calls\n- `internal/daemon/rpc/subscribe.go` — HandleSubscribe, notification dispatch\n- `internal/daemon/rpc/message.go` — HandleSend, subscription notification triggers\n- `cmd/thrum/main.go` — wait command CLI handler\n\n## Data Flow\n```\nthrum wait --scope module:auth --timeout 10s\n  → cli.Wait() → RPC \"subscribe\" (scope=module:auth)\n  → poll RPC \"message.list\" (filtered by subscription)\n  → on match: print message, exit 0\n  → on timeout: exit 1\n\nthrum send \"msg\" --scope module:auth\n  → RPC \"message.send\" → WriteEvent() → subscription notification broadcast\n  → waiting subscriber should receive via WS push or poll\n```\n\n## Reproduction\n```bash\n# Terminal 1\nthrum subscribe --scope module:auth\nthrum wait --scope module:auth --timeout 10s\n\n# Terminal 2 (within 10s)\nthrum send \"Test notification\" --scope module:auth\n\n# Expected: Terminal 1 prints message and exits 0\n# Actual: Terminal 1 exits with code 1 after timeout\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-cv9.9","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"thrum wait exits code 1 instead of delivering scoped/mention notifications (SC-34/35/36)","updated_at":"2026-03-01T07:25:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T23:05:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"360bfc1529f3539564b591e98cfa02e61307dc289cccb75c5509287a94856cd0","created_at":"2026-02-28T22:08:06Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Write groups.spec.ts — Group Messaging (F1-F5)\n\n### Files\n- Create: `tests/e2e/groups.spec.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 8)\n\n### Tests to Write (serial mode)\n- F1: Create group (thrum group create test-team)\n- F2: Add members (@e2e_coordinator, @e2e_implementer)\n- F3: Add by role (thrum group add coordinators --role coordinator)\n- F4: Send group message and verify delivery\n- F5: Nested groups not supported (adding group name as plain member)\n\n### Acceptance Criteria\n- [ ] All 5 tests pass\n- [ ] Groups cleaned up or isolated per test\n\n### Commit\n```\ngit commit -m \"test(e2e): add groups.spec.ts — group create, members, messaging (F1-F5)\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-d7g","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Write groups.spec.ts — group messaging tests","updated_at":"2026-02-28T23:05:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"F2-4 restored as distinct who-has JSON test","closed_at":"2026-03-01T05:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4a61100a91adc689a279ccee7d280efb1fb428119280e493ec0935ceea73d6d6","created_at":"2026-03-01T00:23:51Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The plan had F2-4 as a separate test for `who-has --json` output format. It was merged into F2-2 (replacing the original F2-2 scenario). With F2-2 being restored to its original multi-agent scenario, F2-4 should exist as its own test.\n\nFile: tests/e2e/coordination.spec.ts\n\nAcceptance criteria:\n- Test creates a modified file, runs `who-has \u003cfile\u003e --json`, parses JSON output\n- Verifies the output is valid JSON with expected structure\n- Test passes consistently","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-dil","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-03-01T05:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All spec files written/verified, tasks closed","closed_at":"2026-02-28T23:05:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0fc4306afc0d5dd49aea894342cef503e8b451d3fb12543f693674f6292c11f9","created_at":"2026-02-28T22:06:11Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-dl2","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"E2E Test Specs: Session, messaging, groups, multi-agent, regression, web-ui, backup","updated_at":"2026-02-28T23:05:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"messaging.spec.ts already exists with SC-15 to SC-25","closed_at":"2026-02-28T23:05:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5cf6bda5368dce83b7655b34ff3da4ae49d5da29cc8b9f0a644be229768d7f1d","created_at":"2026-02-28T22:07:59Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Write messaging.spec.ts — CLI Messaging (E1-E9)\n\n### Files\n- Create: `tests/e2e/messaging.spec.ts`\n- Delete: `tests/e2e/notifications.spec.ts` (replaced)\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 7)\n\n### Tests to Write (serial mode)\n- E1: Direct message coordinator → implementer (send + check inbox)\n- E2: Reply implementer → coordinator\n- E3: Priority flag removed (-p should error)\n- E4: Broadcast message (@everyone)\n- E5: Mark as read\n- E6: Send to unknown recipient fails\n- E8: Send to role name resolves via group\n- E9: Name≠role validation on registration\n\nEach test uses coordEnv() and implEnv() helper functions for THRUM_NAME/ROLE/MODULE.\n\n### Acceptance Criteria\n- [ ] All 8 tests pass\n- [ ] notifications.spec.ts deleted\n\n### Commit\n```\ngit commit -m \"test(e2e): add messaging.spec.ts (E1-E9), remove notifications.spec.ts\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-dxl","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Write messaging.spec.ts — CLI messaging tests","updated_at":"2026-02-28T23:05:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"48e4e7b7655af0dfce83dc3c806c45371c54ace1e90f45bef62ae6bf22fb6d83","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-ftu","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix website index.html hardcoded :4100 port","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:35:20Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4ee1c3147106a0974145bd6c5912280c5c31a94db77abfce6a56f6e7e1876a25","created_at":"2026-02-27T21:18:22Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `cmd/thrum/main.go` (add backupCmd group with create/status/config subcommands)\n- Create: `internal/backup/manifest.go` (manifest generation)\n- Create: `internal/backup/backup.go` (orchestrator: calls export functions, writes manifest)\n- Test: `internal/backup/backup_test.go`\n\n## Steps\n\n### Step 1: Implement manifest\n```go\ntype Manifest struct {\n    Version      int            `json:\"version\"`\n    Timestamp    time.Time      `json:\"timestamp\"`\n    ThrumVersion string         `json:\"thrum_version\"`\n    RepoName     string         `json:\"repo_name\"`\n    Counts       ManifestCounts `json:\"counts\"`\n}\n```\n\n### Step 2: Implement RunBackup orchestrator\n```go\nfunc RunBackup(opts BackupOptions) (*BackupResult, error)\n```\n- Resolve backup dir (CLI flag \u003e config \u003e default .thrum/backup)\n- Derive repo name from git remote or dir name (use cli.GetRepoName)\n- Create \u003cbackupDir\u003e/\u003crepoName\u003e/current/\n- Call ExportSyncData, ExportLocalTables, ExportConfigFiles\n- Write manifest.json\n- Return BackupResult with counts and paths\n\n### Step 3: Wire CLI\nAdd backupCmd() to main.go following daemonCmd() pattern:\n- `thrum backup` (default: run backup)\n- `thrum backup status` (show last backup from manifest)\n- `thrum backup config` (show effective backup config)\n- `--dir` flag overrides config backup dir\n\n### Step 4: Verify\n```bash\ngo test ./internal/backup/... -v -race\ngo build ./cmd/thrum/\n./thrum backup --help\n```\n\n## Acceptance Criteria\n- [ ] thrum backup creates backup with all data\n- [ ] thrum backup --dir /tmp/test works\n- [ ] thrum backup status shows last backup info\n- [ ] thrum backup config shows effective config\n- [ ] Manifest written with accurate counts\n- [ ] Repo name used as subfolder\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-gln","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Wire up thrum backup CLI commands","updated_at":"2026-02-28T18:35:20Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Release testing complete: 58 pass, 0 fail","closed_at":"2026-02-26T04:44:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8f2aede23f86e3d0620a8da88413c7dc6472c12923975acbe4b40931d8048d8c","created_at":"2026-02-25T22:46:41Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-htj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"v0.5.1 Release Testing","updated_at":"2026-02-26T04:44:53Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"F5 divergence documented in groups.spec.ts","closed_at":"2026-03-01T05:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"96e2684e29e620e0329c558664c63ea479e59fbeed13c709b2281decc981f099","created_at":"2026-03-01T00:23:54Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The plan expected `group add meta-group test-team` to succeed silently (treating group name as plain agent ref). The actual CLI returns 'agent not found' because 'test-team' isn't a registered agent. The test was adapted to match actual behavior. This needs documentation — either update the design doc to reflect actual behavior, or file a bug if the plan's behavior was intended.\n\nFile: Design doc or bug report\n\nAcceptance criteria:\n- The divergence is documented (either design doc updated or bug filed)\n- groups.spec.ts F5 test has a comment explaining the divergence from the original plan","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-jj3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-03-01T05:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"UI structural fixes complete","closed_at":"2026-02-24T18:35:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2b0e61e85522404b0e9261adb4ae2c2e176aa6daf89560e72d3d29ae1bdffe19","created_at":"2026-02-24T16:19:36Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Re-implement: (B1) DaemonRestart port preservation via THRUM_WS_PORT env var, (B2) URL hash routing for navigation persistence in uiStore, (B3) refetchInterval:5000 polling for useMessageList, (B4) refetchInterval:30000 for useSessionList, (D1) MessageList hooks ordering fix + auto-scroll, (D2) Remove useBrowserNotifications from DashboardPage. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups B + D1 + D2.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"UI Structural Fixes — Daemon port, hash routing, polling, hooks","updated_at":"2026-02-24T18:35:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5d62901018caf97075b5a0ea5ed517151b661bcda5020e1e114ce285d11c3e64","created_at":"2026-02-24T16:21:49Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: internal/cli/daemon.go\n\n## Steps\nIn DaemonRestart(), add code to:\n1. Read prevPort := ReadWebSocketPort(repoPath) BEFORE calling DaemonStop\n2. After DaemonStop and sleep, if prevPort \u003e 0: os.Setenv(\"THRUM_WS_PORT\", fmt.Sprintf(\"%d\", prevPort)) with defer os.Unsetenv\n3. Verify os and fmt are already imported\n\n## Acceptance Criteria\n- [ ] go build ./cmd/thrum/ compiles\n- [ ] Port preserved across thrum daemon restart","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"DaemonRestart port preservation via THRUM_WS_PORT env var","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"402c1d142150aa5249bef0a9dabe87a4e73c84fc3c6bfea9eccc4bd047501461","created_at":"2026-02-24T16:21:56Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/shared-logic/src/stores/uiStore.ts\n\n## Steps\n1. Add validViews array with all View type values\n2. Add stateFromHash() that parses window.location.hash (URLSearchParams on hash after #) into UIState\n3. Add stateToHash() that writes UIState to URL hash via window.history.replaceState (no history spam)\n4. Change initialState to merge defaults with stateFromHash() restored values\n5. Add uiStore.subscribe() that calls stateToHash on every state change\n6. Call stateToHash(initialState) once at startup\n\nHash format: #view=live-feed\u0026agent=xyz\u0026group=abc\n\n## Acceptance Criteria\n- [ ] Refreshing page returns to current view\n- [ ] URL updates when navigating between views\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"URL hash routing for navigation persistence in uiStore","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"64f67693b6f49e853b5bb56bb531034cf462c2138d095aa6bc6e28aa477ade0d","created_at":"2026-02-24T16:22:02Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/shared-logic/src/hooks/useMessage.ts\n- Modify: ui/packages/shared-logic/src/hooks/useSession.ts\n\n## Steps\n1. In useMessageList: add refetchInterval: 5000 after existing staleTime: 1000\n2. In useSessionList: add refetchInterval: 30000 after existing staleTime: 30000\n\nBrowser clients don't have WebSocket push subscriptions (requires agent session), so polling is the primary refresh mechanism.\n\n## Acceptance Criteria\n- [ ] Messages appear within 5s of being sent (without page refresh)\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add polling fallbacks for useMessageList and useSessionList","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8b4f4e0f682adbb2d5334774311f6766ea613fa78a4533ff7dc9c366514078b4","created_at":"2026-02-24T16:22:11Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/MessageList.tsx\n\n## Steps\n1. Move scrollEndRef (useRef), prevMessageCountRef (useRef), useLayoutEffect (scroll to bottom on initial render), and useEffect (scroll to bottom when messages.length increases) ABOVE the early returns (loading/empty states)\n2. Add conversations = groupByConversation(messages).slice().reverse() so newest appear at bottom\n3. Add \u003cdiv ref={scrollEndRef} /\u003e at the end of the scroll area\n\nThis fixes React error #310 (Rendered more hooks than during the previous render).\n\n## Acceptance Criteria\n- [ ] No React error #310 on My Inbox or agent inbox views\n- [ ] Messages appear newest at bottom\n- [ ] Auto-scrolls to bottom on load and when new messages arrive\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix MessageList hooks ordering + auto-scroll to bottom","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4a6f136d0abe53c8b6fb27eabec0d31c777809546e40d41e2baed0d4bbbbecb9","created_at":"2026-02-24T16:22:16Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/pages/DashboardPage.tsx\n- Modify: ui/packages/web-app/src/pages/__tests__/DashboardPage.test.tsx\n\n## Steps\n1. Remove useBrowserNotifications call from DashboardPage\n2. Remove useCurrentUser import from DashboardPage (no longer needed for notifications)\n3. Keep useCurrentUser in the test mock (child components still use it)\n\n## Acceptance Criteria\n- [ ] No browser notification permission prompt on page load\n- [ ] Tests pass (DashboardPage.test.tsx)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Remove useBrowserNotifications from DashboardPage","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T23:05:38Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5f83aebfb9bf1c924d89ce15274bfa43a474dc8c62713edd4b34c07a064b28cc","created_at":"2026-02-28T22:08:30Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Write regression.spec.ts — Bugfix Regressions (J1-J13)\n\n### Files\n- Create: `tests/e2e/regression.spec.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 11)\n\n### Tests to Write (independent, any order)\n- J1: Priority flag removed from CLI (-p and --priority both error)\n- J3: Init detects worktree and creates redirect (create temp main + worktree, verify .thrum/redirect)\n- J4: Init does NOT write mcpServers to settings.json\n- J5: Wait subscription cleanup on disconnect (two sequential waits, no \"subscription already exists\")\n- J6: Ping resolves by agent name (thrum ping @e2e_coordinator)\n- J7: MCP serve does not crash (timeout, no panic)\n- J8: Wait --all flag removed (unknown flag error)\n- J9: Unknown recipient hard error (message not stored)\n- J11: Group-send warning excludes @everyone\n- J12: Wait excludes own outbound messages\n\nEach test that creates temp repos must clean up in finally blocks (stop daemon, rmSync).\n\n### Acceptance Criteria\n- [ ] All 10 tests pass (or test.fixme for known issues)\n- [ ] No temp dirs leaked on failure\n\n### Commit\n```\ngit commit -m \"test(e2e): add regression.spec.ts — bugfix regressions J1-J13\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kpw","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Write regression.spec.ts — bugfix regression tests","updated_at":"2026-02-28T23:05:38Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Implemented RunPlugins with timeout, glob file collection, PluginPresets, integrated into RunBackup. 6 tests pass.","closed_at":"2026-02-28T18:43:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"89ddfe9b66ccd7515e6b7fd0b7b541740cb3a0b27ce2c4f886fcd4174ac23b85","created_at":"2026-02-27T21:17:05Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/plugins.go` (plugin command runner and file collector)\n- Create: `internal/backup/plugins_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nTest RunPlugins with a mock plugin config that runs a simple command (echo) and includes files matching a glob pattern. Test timeout handling (60s). Test command failure is non-fatal (warn, continue).\n\n### Step 2: Implement\n```go\nfunc RunPlugins(plugins []config.PluginConfig, repoPath, backupDir string) ([]PluginResult, error)\n// For each plugin:\n//   1. Run plugin.Command with CWD=repoPath, 60s timeout\n//   2. If command fails: log warning, skip file collection, continue\n//   3. Glob plugin.Include patterns relative to repoPath\n//   4. Copy matched files to backupDir/plugins/\u003cplugin.Name\u003e/\n//   5. Preserve relative paths within the plugin dir\n```\n\n### Step 3: Integrate into RunBackup\nAfter core export, run plugins if configured. Include plugin names in manifest.\n\n### Step 4: Verify\n```bash\ngo test ./internal/backup/... -run TestPlugin -v -race\n```\n\n## Acceptance Criteria\n- [ ] Runs plugin commands with 60s timeout\n- [ ] Collects files matching glob patterns\n- [ ] Plugin failure is non-fatal (warns, continues)\n- [ ] Files placed in plugins/\u003cname\u003e/ preserving relative paths\n- [ ] Plugin names listed in manifest\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-lk1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement third-party plugin execution","updated_at":"2026-02-28T18:43:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:39:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"151325d80e27740f7d7f947fa90c29d12b86b3a9e3b69c45e3b6533995fc15e0","created_at":"2026-02-27T21:17:48Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/restore.go` (restore logic)\n- Create: `internal/backup/restore_test.go`\n\n## Steps\n\n### Step 1: Write failing tests\nTest restore from current/ dir and from a zip archive. Verify JSONL files end up in sync worktree, local tables imported to SQLite, config files restored.\n\n### Step 2: Implement\n```go\nfunc RunRestore(opts RestoreOptions) error\n// opts: BackupDir, RepoName, ArchivePath (optional), RepoPath\n//\n// 1. CreateSafetyBackup (if existing data present)\n// 2. cli.DaemonStop(repoPath) — ignore not-running error\n// 3. Determine source: ArchivePath (extract zip to temp) or current/\n// 4. Copy JSONL files to sync worktree (paths.SyncWorktreePath)\n// 5. Import local/ JSONL tables into SQLite\n// 6. Restore config/ files to .thrum/\n// 7. Delete .thrum/var/messages.db (will be rebuilt)\n// 8. cli.DaemonStart(repoPath, localOnly) — rebuilds SQLite via projector\n```\n\n### Step 3: Implement zip extraction helper\n```go\nfunc extractZipToDir(zipPath, destDir string) error\n```\n\n### Step 4: Implement local table import\n```go\nfunc ImportLocalTables(db *sql.DB, backupDir string) error\n// Read local/message_reads.jsonl etc, INSERT OR IGNORE into SQLite\n```\n\n### Step 5: Verify\n```bash\ngo test ./internal/backup/... -run TestRestore -v -race\n```\n\n## Acceptance Criteria\n- [ ] Safety backup created before restore\n- [ ] Daemon stopped before restore, restarted after\n- [ ] JSONL files restored to sync worktree\n- [ ] Local tables imported to SQLite\n- [ ] Config/identity/context files restored\n- [ ] SQLite rebuilt automatically on daemon start\n- [ ] Works from current/ dir or zip archive\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-lru","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement restore from backup","updated_at":"2026-02-28T18:39:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:40:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5f7602b806696248950dc7979aac8061d454add0a96ef8d39ed4c02dd6a20ebf","created_at":"2026-02-27T21:15:17Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"GFS retention policy with archive/zip, restore with safety backup, daemon stop/restart, SQLite projection rebuild.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-n0u","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Rotation \u0026 Restore","updated_at":"2026-02-28T18:40:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"web-ui.spec.ts already exists with SC-49 to SC-57","closed_at":"2026-02-28T23:05:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2cd5ad2291b2e5b5294998e0ddfaa7148aa43b242a7b52f6216f505fe2f1c04c","created_at":"2026-02-28T22:08:37Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Write web-ui.spec.ts — Web UI Tests (K2-1 through K2-13)\n\n### Files\n- Create: `tests/e2e/web-ui.spec.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 12)\n\n### Tests to Write (uses Playwright page fixture)\n- K2-1: Page loads successfully (status 200, doctype, body not empty)\n- K2-2: Health bar shows CONNECTED (wait 15s)\n- K2-3: Agent list shows agents\n- K2-4: Live feed shows messages (send via CLI, verify in page)\n- K2-5: Live feed updates in real-time via WebSocket (send AFTER page load, verify without refresh)\n- K2-9: Theme toggle persists (click toggle, reload, verify)\n- K2-12: Responsive layout renders at 1280x720\n\n### Acceptance Criteria\n- [ ] All 7 tests pass\n- [ ] WebSocket connection established before assertions\n\n### Commit\n```\ngit commit -m \"test(e2e): add web-ui.spec.ts — embedded UI tests (K2-1–K2-13)\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-pmb","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Write web-ui.spec.ts — web UI tests","updated_at":"2026-02-28T23:05:39Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:32:08Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"48d0ec2a66914b74f47d0b2766c8f794d5d0adef0d80a4aef7a5dc3fb4e10b11","created_at":"2026-02-27T21:18:01Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/config_export.go` (copy config/identity/context files)\n- Create: `internal/backup/config_export_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nCreate temp .thrum dir with config.json, identities/*.json, context/*.md. Test ExportConfigFiles copies them to backupDir/config/ preserving structure.\n\n### Step 2: Implement ExportConfigFiles\n```go\nfunc ExportConfigFiles(thrumDir, backupDir string) error\n```\n- Copy .thrum/config.json → backupDir/config/config.json\n- Copy .thrum/identities/*.json → backupDir/config/identities/\n- Copy .thrum/context/*.md → backupDir/config/context/\n- Skip runtime files (var/, *.sock, *.pid, *.lock, *.port)\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] Copies config, identity, and context files\n- [ ] Preserves directory structure\n- [ ] Skips runtime/ephemeral files\n- [ ] Handles missing optional dirs (identities/, context/)\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qd9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Implement config and identity file backup","updated_at":"2026-02-28T18:32:08Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All 10 review findings addressed in single commit.","closed_at":"2026-02-28T19:12:34Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2aabe0974e2d5f7f93e3b18db32615a9960152b51381bf4a67a9ced3733e9acb","created_at":"2026-02-28T19:04:15Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Fixes identified from code review and plan-vs-implementation gap analysis of the backup/restore feature on feature/team-fix branch. Covers security issues, functional gaps, and quality improvements.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"epic","updated_at":"2026-02-28T19:12:34Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3c105abfbd9ca257dad38676db0fcb61a2e6754f0e9f17baeb34c4224ae3edd8","created_at":"2026-02-28T19:04:57Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SECURITY: restore.go:234-244 — JSON column names from backup JSONL files are interpolated directly into SQL queries via fmt.Sprintf without validation. A tampered backup zip could inject arbitrary SQL through crafted JSON keys like 'a\"--'.\n\nFix: Before constructing the INSERT query, query PRAGMA table_info for the target table and build an allowlist of valid column names. Reject any JSON key not in the allowlist. The table name itself is safe (comes from hardcoded localOnlyTables list).\n\nFile: internal/backup/restore.go, importTable function, lines 234-244.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a5276fd4d7d8599fd23b45f130bf78b42a223a8a59e99aad85222f82cf672d4c","created_at":"2026-02-28T19:04:59Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"QUALITY: export.go:104-115 — After copying a file via io.Copy, atomicCopyFile re-reads the entire destination file from disk just to count newlines. For large JSONL event logs this is wasteful I/O. The line count is also discarded by some callers (e.g., restoreSyncData).\n\nFix: Either count newlines during the io.Copy phase using a counting writer wrapper, or scan the source file with a seek-back. Remove the os.ReadFile call.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.10","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All tasks addressed","closed_at":"2026-02-28T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4317bfd9deb6c96ab90e141d958980e041386811f676e23376d3fdd6996ede9c","created_at":"2026-02-28T19:20:08Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Follow-up fixes from second code review pass. All minor-to-moderate issues remaining after the main fix commit (7d1fa0d).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"epic","updated_at":"2026-02-28T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Invalid — the monthly != 0 guard is correct. Skipping the block when monthly==0 means no archives are added to keep set, so they all get deleted. Changing to \u003e= 0 would be a regression.","closed_at":"2026-02-28T20:12:10Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c7527cc968c9a532d0378a8b2fad1bf2ce9363ae983a740407f3482e309eafb4","created_at":"2026-02-28T19:20:30Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"rotation.go:194 — The *int pointer fix correctly distinguishes nil from 0, but ApplyRetention still has 'if monthly != 0' which skips the entire monthly rotation block when monthly is explicitly 0. This means a user setting monthly:0 (keep no monthly archives) silently disables monthly rotation instead of purging all monthly archives.\n\nFix: Change 'if monthly != 0' to 'if monthly \u003e= 0' on line 194 of internal/backup/rotation.go. Add a test case for monthly=0 that verifies all monthly archives are purged.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T20:12:10Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 58a4d17","closed_at":"2026-02-28T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"503de2d1c35d324e319488c2df76dd51b65992904347ca384d975af832313f21","created_at":"2026-02-28T19:20:30Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"restore.go:352 — extractZip uses unbounded io.Copy when decompressing zip entries. A malicious or corrupt zip with a small compressed entry that expands to gigabytes will exhaust disk space.\n\nFix: Wrap the reader with io.LimitReader:\n  const maxExtractedBytes = 2 \u003c\u003c 30 // 2 GiB\n  if _, err := io.Copy(outFile, io.LimitReader(rc, maxExtractedBytes)); err != nil {\n\nOr check f.UncompressedSize64 before extraction and reject entries exceeding the limit. Add a test with a small zip that would exceed the limit.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 58a4d17","closed_at":"2026-02-28T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6fea270fdc4e44ca573a509baa4405f10ffe0eb5099525cba4e90dd0da91b2cb","created_at":"2026-02-28T19:20:30Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"cmd/thrum/main.go:5045-5061 — backup status now shows archive count and total size, but the design doc implies rotation stats should also include date ranges. Archive filenames encode timestamps (format 2006-01-02T150405.zip).\n\nFix: After collecting entries in runBackupStatus, parse timestamps from archive filenames (skip pre-restore-* files), track oldest/newest, and display them:\n  Archives: 3 (12.4 MB)\n    Oldest: 2026-02-20 14:30:05\n    Newest: 2026-02-28 18:43:12","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 58a4d17","closed_at":"2026-02-28T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"50c43d8aa5906c03d3f304c08d818713a391de43e3345c88d1659c7a8359a838","created_at":"2026-02-28T19:20:31Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"restore.go:280 — Column names are allowlisted via PRAGMA table_info (good), but the double-quote wrapping uses simple string concat without escaping. If a column name itself contained a double-quote (unlikely since thrum controls the schema, but possible), it would break the SQL.\n\nFix: Change line 271 from:\n  columns = append(columns, \"\\\"\"+col+\"\\\"\")\nto:\n  columns = append(columns, \"\\\"\"+strings.ReplaceAll(col, \"\\\"\", \"\\\"\\\"\")+\"\\\"\")\n\nTrivial one-line defense-in-depth fix.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 58a4d17","closed_at":"2026-02-28T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"18abd877386099da6396028550648880ababe0df66f141a57e0e8169259214c1","created_at":"2026-02-28T19:20:31Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"cmd/thrum/main.go imports — The internal/backup import is out of alphabetical order (appears after daemon/* imports instead of before cli). This may fail make lint / goimports.\n\nFix: Move the 'github.com/leonletto/thrum/internal/backup' import line to before 'github.com/leonletto/thrum/internal/cli' in the import block. Or just run goimports on the file.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11.5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 58a4d17","closed_at":"2026-02-28T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"cb1d0a6bfb33af2e6c8809a0159ccc1bc0c1c78881cd035def73a6dab0cbf3b0","created_at":"2026-02-28T20:12:11Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"restore.go importTable — Each JSONL row is inserted via a separate db.Exec with no surrounding transaction. For tables with hundreds+ rows this is significantly slower, and if interrupted mid-import the table is partially populated with no way to detect or recover.\n\nFix: Wrap the insert loop in a transaction:\n  tx, err := db.Begin()\n  if err != nil { return ... }\n  // ... scanner loop, use tx.Exec instead of db.Exec ...\n  return tx.Commit()","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11.6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 58a4d17","closed_at":"2026-02-28T20:13:52Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"f14aea499c3a7afa4ef8eb29efe8370122479b4c6b5b386ed05148acafe5c867","created_at":"2026-02-28T20:12:11Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"restore.go:247 — bufio.NewScanner(f) uses the default 64KB max token size. Thrum messages can contain arbitrary content (long code blocks, base64 data), so a single JSONL line could easily exceed 64KB. When it does, scanner.Scan() returns false and the row is silently dropped or the import aborts.\n\nFix: After creating the scanner, increase the buffer:\n  scanner := bufio.NewScanner(f)\n  scanner.Buffer(make([]byte, 0, 64*1024), 10*1024*1024) // 10 MiB max line","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.11.7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T20:13:52Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4953b5744dcc0bc35b55bd0730761f0dc6359652bb97e1f1fb70572da5698895","created_at":"2026-02-28T19:04:57Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"FUNCTIONAL GAP: The design doc specifies stop daemon before restore (step 2) and restart after (step 8). The current implementation in cmd/thrum/main.go runBackupRestore just prints a manual instruction. If daemon is running during restore, it holds open handles to messages.db and active write locks on sync worktree files, creating race conditions that can corrupt data.\n\nFix: In runBackupRestore (cmd/thrum/main.go:5091-5163):\n- Before backup.RunRestore(): call cli.DaemonStop(flagRepo) (best-effort, continue if already stopped)\n- After successful restore: call cli.DaemonStart or cli.DaemonRestart and warn if it fails\n- Remove the manual 'Restart the daemon' print message.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1049cf75983778639c821357073bd62bb5378eabc9f30fe9eff8c8ae0db63137","created_at":"2026-02-28T19:04:58Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"BUG: backup.go:97 passes opts.SyncDir as repoPath to RunPlugins. SyncDir is the a-sync detached worktree, not the repo root. Plugin commands like 'bd backup --force' expect to run from the project root where .beads/ exists. Glob patterns like '.beads/backup/*' resolve against the sync worktree where .beads/ doesn't exist.\n\nFix:\n1. Add RepoPath field to BackupOptions struct\n2. Wire flagRepo from runBackupCreate into opts.RepoPath\n3. Pass opts.RepoPath (not opts.SyncDir) to RunPlugins and RunPostBackup\n4. Verify plugins get correct CWD in tests.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:29Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5b25e542a49fbc4e9c1e8b70e2de98d7ffe1404b02f0a6233f49187aeedbc12f","created_at":"2026-02-28T19:04:58Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SECURITY: restore.go:265-268 — The current zip-slip check uses filepath prefix matching which has edge cases. The standard industry pattern is to check for '..' path traversal directly.\n\nFix: Replace the prefix-based check with:\n  rel := filepath.Clean(f.Name)\n  if strings.HasPrefix(rel, \"..\" + string(os.PathSeparator)) || rel == \"..\" {\n      return fmt.Errorf(\"illegal file path in zip: %s\", f.Name)\n  }\n  destPath := filepath.Join(destDir, rel)\n\nAdd test cases for malicious zip entries: '../etc/passwd', '../../tmp/a/evil', '.', empty name.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:29Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"946501e3c419c5c7d85531736ee9cad2ffe46215fb1cd2c74e71a27a530521b3","created_at":"2026-02-28T19:04:58Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"BUG: rotation.go:27 — On non-IsNotExist ReadDir errors, the function returns err.Error() (the error message string) as the first return value (which should be the archive zip path). Should return empty string.\n\nFix: Change 'return err.Error(), err' to 'return \"\", err' on line 27 of rotation.go.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"c2c31494737c7de290ed689e93e914e8cc7d7eff4a82c4933d0b34c0c0c46ca6","created_at":"2026-02-28T19:04:58Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"PLAN GAP: Design doc Restore Flow step 9 says 'Run plugin restore commands if configured'. Not implemented. During restore, plugin backup files are extracted from the zip into plugins/\u003cname\u003e/ but no plugin restore commands are executed. For beads, this means backup data is present but not imported back into beads' data store.\n\nFix:\n1. Add Plugins field to restoreOptions (or RunRestore params)\n2. After restoring files, iterate configured plugins and run their commands with the extracted plugin dir as context\n3. Wire plugin config from CLI into the restore call\n4. Add test for plugin restore execution.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"55c8a192f663b0610081953707e90bc1fe63a7f3b4f4577fffa7c05008d91334","created_at":"2026-02-28T19:04:58Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"PLAN GAP: Design doc specifies 'thrum backup status — Show last backup, rotation stats'. Implementation only shows the last backup manifest. Missing: number of archives in archives/, breakdown by daily/weekly/monthly, oldest/newest archive timestamps, total archive disk usage.\n\nFix: In runBackupStatus (cmd/thrum/main.go:5001-5046):\n1. Read the archives/ directory\n2. Parse archive filenames for timestamps\n3. Count archives, compute total size\n4. Display rotation stats alongside the existing manifest info.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.7","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0f92b0a52147acdabc318ab5474f28f5d6e184ff8b3e3fa47fb2696239cd6507","created_at":"2026-02-28T19:04:59Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"BUG: config/daemon.go:98-106 — applyDefaults treats 0 as 'unset' for Daily/Weekly/Monthly retention, overwriting with defaults. A user who intentionally sets monthly:0 (keep no monthly archives) gets silently changed to -1 (keep forever).\n\nFix: Use pointer types (*int) for RetentionConfig fields, or use a sentinel value like -2 for 'unset'. Update applyDefaults to only set defaults when the pointer is nil (or sentinel is present). Update JSON tags with omitempty as appropriate. Update tests.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.8","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in commit 7d1fa0d","closed_at":"2026-02-28T19:12:30Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"cee77d9feab9b841eed59020a40b33ad1389d6153a704fc5495ee683b6e9f36b","created_at":"2026-02-28T19:04:59Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"QUALITY: plugins.go:38 and post_hook.go:29 route plugin stdout to os.Stderr with no capture. When a plugin fails, users only see 'exit status 1' with no diagnostic information from the plugin's stderr output.\n\nFix:\n1. In RunPlugins: capture stderr into a strings.Builder via cmd.Stderr = \u0026sb\n2. Store last N bytes (e.g., 4KB) in PluginResult.CmdError for diagnostics\n3. Same for RunPostBackup / PostHookResult.Error\n4. Still route stdout to os.Stderr to avoid polluting JSON output mode.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qel.9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-02-28T19:12:30Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in restore.go: read limit+1 bytes, error if count exceeds max","closed_at":"2026-02-28T22:50:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9f077b2b40f5a15dfea45b8122b603c250b8cbd7cba00078ef4a1de17289df20","created_at":"2026-02-28T22:50:17Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"io.LimitReader in extractZip silently truncated files exceeding 2 GiB instead of returning an error. Fixed by reading limit+1 bytes and checking if the count exceeds the cap.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-rlj","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix io.LimitReader silent truncation in backup restore","updated_at":"2026-02-28T22:50:25Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Infrastructure complete, all 5 tasks done","closed_at":"2026-02-28T23:05:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"cd9df764b19d63b1ec83b271edfdcb7141d05eed70eda8ad551dc6603fce30d7","created_at":"2026-02-28T22:06:07Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-sn4","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"E2E Infrastructure: Multi-worktree test environment","updated_at":"2026-02-28T23:05:47Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T22:50:44Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"799b4f883b2f60597e63d3600464eb31e988a2c202fe1ce57a86fea85d028504","created_at":"2026-02-28T22:08:17Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Extend global-setup.ts — Stable Path + Multi-Worktree\n\n### Files\n- Modify: `tests/e2e/global-setup.ts`\n- Reference: `scripts/setup-worktree-thrum.sh`, `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 1)\n\n### What to Do\nReplace random temp dir with stable `/tmp/thrum-e2e-release/coordinator/`. Clean previous run if exists. Separate `thrum init` (repo setup) from `thrum quickstart` (agent registration). Add implementer worktree via `setup-worktree-thrum.sh`. Add bare remote for sync tests.\n\n### Key Changes\n1. Change E2E_ROOT to `/tmp/thrum-e2e-release`\n2. `createCoordinatorRepo()`: git init, commit, `thrum init`, then `thrum quickstart --role coordinator --module all --name e2e_coordinator --intent \"E2E test coordinator\"`\n3. `createImplementerWorktree()`: Run `scripts/setup-worktree-thrum.sh /tmp/thrum-e2e-release/implementer implementer-wt --identity e2e_implementer --role implementer --base main`, then `thrum quickstart` in implementer dir\n4. `createBareRemote()`: git init --bare, add as origin, push main\n5. Export new constants: IMPLEMENTER_REPO_FILE, BARE_REMOTE_FILE\n6. Write all 4 marker files to node_modules/\n7. Remove previous /tmp/thrum-e2e-release/ at start if exists (stop old daemon first)\n\n### Acceptance Criteria\n- [ ] `npx playwright test --list` shows tests without errors\n- [ ] `/tmp/thrum-e2e-release/coordinator/.thrum/` exists after setup\n- [ ] `/tmp/thrum-e2e-release/implementer/.thrum/redirect` points to coordinator\n- [ ] `thrum daemon status` works from coordinator dir\n- [ ] Both agents visible in `thrum agent list`\n\n### Commit\n```\ngit commit -m \"feat(e2e): extend global-setup with stable path, implementer worktree, bare remote\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-sn4.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Extend global-setup.ts with stable path and multi-worktree","updated_at":"2026-02-28T22:50:44Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T22:51:23Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5b9c9d6d3160f5f3e65dd4dc7dd6b24b121848a48ea731828a6c8098fa673fba","created_at":"2026-02-28T22:08:25Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Extend thrum-cli.ts — Multi-Worktree Helpers\n\n### Files\n- Modify: `tests/e2e/helpers/thrum-cli.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 2)\n\n### What to Do\nAdd `getImplementerRoot()`, `getBareRemote()`, and `thrumIn()` exports.\n\n### Code to Add (after getTestRoot)\n```typescript\nconst IMPLEMENTER_REPO_FILE = path.join(SOURCE_ROOT, 'node_modules', '.e2e-implementer-repo');\nconst BARE_REMOTE_FILE = path.join(SOURCE_ROOT, 'node_modules', '.e2e-bare-remote');\n\nexport function getImplementerRoot(): string {\n  if (existsSync(IMPLEMENTER_REPO_FILE)) {\n    return readFileSync(IMPLEMENTER_REPO_FILE, 'utf-8').trim();\n  }\n  return getTestRoot();\n}\n\nexport function getBareRemote(): string {\n  if (existsSync(BARE_REMOTE_FILE)) {\n    return readFileSync(BARE_REMOTE_FILE, 'utf-8').trim();\n  }\n  throw new Error('Bare remote marker file not found');\n}\n\nexport function thrumIn(cwd: string, args: string[], timeout = 10_000, env?: NodeJS.ProcessEnv): string {\n  try {\n    return execFileSync(BIN, args, { cwd, encoding: 'utf-8', timeout, env: env ?? thrumEnv() }).trim();\n  } catch (err: any) {\n    const stderr = err.stderr?.toString() || '';\n    throw new Error(`thrum ${args.join(' ')} failed in ${cwd} (exit ${err.status}):\n${stderr}`);\n  }\n}\n```\n\n### Acceptance Criteria\n- [ ] `npx playwright test --list` shows no import errors\n- [ ] All 3 new functions exported\n\n### Commit\n```\ngit commit -m \"feat(e2e): add getImplementerRoot, getBareRemote, thrumIn helpers\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-sn4.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Extend thrum-cli.ts with multi-worktree helpers","updated_at":"2026-02-28T22:51:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T22:51:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"d4a10dfbc895333ac1b4ba84965d937d7ad9e1498b57645815ce920fbc9472e8","created_at":"2026-02-28T22:08:31Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Extend fixtures.ts — Multi-Agent Helpers\n\n### Files\n- Modify: `tests/e2e/helpers/fixtures.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 3)\n\n### What to Do\nAdd `quickstartAgentIn()` and `ensureTestSessions()` exports. Import `thrumIn`, `getTestRoot`, `getImplementerRoot` from thrum-cli.\n\n### Acceptance Criteria\n- [ ] New functions compile without errors\n- [ ] ensureTestSessions() handles \"already active\" gracefully\n\n### Commit\n```\ngit commit -m \"feat(e2e): add multi-worktree fixture helpers\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-sn4.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Extend fixtures.ts with multi-agent helpers","updated_at":"2026-02-28T22:51:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T22:52:15Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"558873569f03aae99cecccb5761e39471f49d8dff4dc56fc0e122acabdb479d6","created_at":"2026-02-28T22:08:39Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Rewrite global-teardown.ts — Preserve Artifacts\n\n### Files\n- Modify: `tests/e2e/global-teardown.ts`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 4)\n\n### What to Do\nTeardown should ONLY print a summary of preserved artifacts. Do NOT stop daemon. Do NOT delete /tmp/thrum-e2e-release/. Remove only marker files from node_modules/.\n\n### Key Output\n```\n[teardown] Test artifacts preserved:\n[teardown]   coordinator/ — /tmp/thrum-e2e-release/coordinator\n[teardown]   implementer/ — /tmp/thrum-e2e-release/implementer\n[teardown] Daemon still running — inspect with:\n[teardown]   bin/thrum --repo /tmp/thrum-e2e-release/coordinator daemon status\n[teardown] Run 'make clean-e2e' to stop daemon and remove everything.\n```\n\nImport IMPLEMENTER_REPO_FILE and BARE_REMOTE_FILE from global-setup.\n\n### Acceptance Criteria\n- [ ] Teardown does NOT stop daemon\n- [ ] Teardown does NOT delete test directory\n- [ ] Marker files in node_modules/ are removed\n- [ ] Summary message printed to console\n\n### Commit\n```\ngit commit -m \"refactor(e2e): teardown preserves artifacts, prints summary only\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-sn4.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Rewrite global-teardown.ts to preserve artifacts","updated_at":"2026-02-28T22:52:15Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T22:52:41Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"129650c35cb07a5d92032cf5062106542e1067a69e182f776a9b3c3db5053551","created_at":"2026-02-28T22:08:46Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Add clean-e2e and test-e2e Makefile Targets\n\n### Files\n- Modify: `Makefile`\n- Reference: `/Users/leon/dev/opensource/thrum/dev-docs/plans/2026-02-28-e2e-integration-plan.md` (Task 5)\n\n### What to Add (near existing test targets)\n```makefile\n## E2E test cleanup — stops daemon and removes /tmp/thrum-e2e-release/\nclean-e2e:\n\t@echo \"Stopping E2E daemon...\"\n\t@if [ -d /tmp/thrum-e2e-release/coordinator ]; then \\\n\t\tbin/thrum --repo /tmp/thrum-e2e-release/coordinator daemon stop 2\u003e/dev/null || true; \\\n\tfi\n\t@echo \"Removing /tmp/thrum-e2e-release/...\"\n\t@rm -rf /tmp/thrum-e2e-release\n\t@rm -f node_modules/.e2e-test-repo node_modules/.e2e-implementer-repo \\\n\t\tnode_modules/.e2e-bare-remote node_modules/.e2e-ws-port\n\t@echo \"E2E cleanup complete.\"\n\n## Run E2E tests (builds first, creates test environment)\ntest-e2e:\n\tnpx playwright test\n```\n\n### Acceptance Criteria\n- [ ] `make clean-e2e` runs without error\n- [ ] `make test-e2e` runs playwright tests\n\n### Commit\n```\ngit commit -m \"feat: add clean-e2e and test-e2e Makefile targets\"\n```","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-sn4.5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add clean-e2e and test-e2e Makefile targets","updated_at":"2026-02-28T22:52:41Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"F2-13 status standalone command test added","closed_at":"2026-03-01T05:13:51Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"19cf503e0500fb35b8055c1b2e9ebae00e2b2305cc44e91e89f0f842ea9d646a","created_at":"2026-03-01T00:23:41Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The plan specified a test for the `thrum status` standalone command. It was never implemented.\n\nFile: tests/e2e/coordination.spec.ts\n\nAcceptance criteria:\n- Test runs `thrum status` and verifies output contains expected fields (agent name, session, branch)\n- Test passes consistently with workers:1","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-t99","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"task","updated_at":"2026-03-01T05:13:51Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4593ea725afc58b7ff059b4b87222e03d5a20dc17e4310369b0bc102d1a48969","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-yh2","is_template":0,"issue_type":"chore","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update dev-docs bug reports with resolution status","updated_at":"2026-02-26T06:22:28Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All 3 tasks complete: plugin execution, plugin CLI/presets, post-backup hooks.","closed_at":"2026-02-28T18:46:33Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1e9ee40a138519408c0c2f1b968e78c677baa2ec029e90aa65013e66545bdd9c","created_at":"2026-02-27T21:15:17Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Third-party plugin execution and file collection, sync-dev-docs.sh integration, beads plugin config.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-ynl","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Plugin System \u0026 Integration","updated_at":"2026-02-28T18:46:33Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-28T18:29:04Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"842fa80e7c5a5173f7b68d9a317602cc60e1ae0029a412e3a11c217e83756eb6","created_at":"2026-02-27T21:17:08Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `internal/config/daemon.go` (add BackupConfig struct and fields to ThrumConfig)\n- Test: `internal/config/daemon_test.go` (add tests for backup config load/save)\n\n## Steps\n\n### Step 1: Write failing test\nTest that BackupConfig loads from config.json with dir, retention, and plugins fields. Test defaults (empty dir = .thrum/backup, daily=5, weekly=4, monthly=-1).\n\n### Step 2: Add BackupConfig struct\n```go\ntype BackupConfig struct {\n    Dir       string          `json:\"dir,omitempty\"`\n    Retention RetentionConfig `json:\"retention,omitempty\"`\n    Plugins   []PluginConfig  `json:\"plugins,omitempty\"`\n}\n\ntype RetentionConfig struct {\n    Daily   int `json:\"daily\"`   // default 5\n    Weekly  int `json:\"weekly\"`  // default 4\n    Monthly int `json:\"monthly\"` // default -1 (forever)\n}\n\ntype PluginConfig struct {\n    Name    string   `json:\"name\"`\n    Command string   `json:\"command\"`\n    Include []string `json:\"include\"`\n}\n```\n\nAdd `Backup BackupConfig` field to ThrumConfig. Update applyDefaults() with backup defaults. Update SaveThrumConfig to preserve backup section.\n\n### Step 3: Verify\n```bash\ngo test ./internal/config/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] BackupConfig loads from config.json\n- [ ] Defaults applied when fields missing\n- [ ] SaveThrumConfig preserves unknown keys AND backup section\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z41","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add BackupConfig to ThrumConfig","updated_at":"2026-02-28T18:29:04Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"All 6 triage tasks complete. Fixed 3 (SC-13, SC-52, SC-67), documented 10 as product bugs or removed features.","closed_at":"2026-03-01T06:34:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9254545a08b19c97895acbf57edc3c56d143913a4bde01debf0be4b69fd00f13","created_at":"2026-03-01T05:14:17Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Analyze all 16 skipped E2E tests and either remove obsolete ones, fix fixable ones, or document why they remain skipped. Goal: reduce skipped count and ensure each skip has a clear justification.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z80","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"E2E Skipped Test Triage","updated_at":"2026-03-01T06:34:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"SC-18/SC-25/SC-60/SC-61/SC-62 are correctly test.skip for removed/unimplemented features. No changes needed.","closed_at":"2026-03-01T06:34:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8b2c9f9395fd35575b5cf250d93baf082c61564610cc5eeaaae7685301dd99c9","created_at":"2026-03-01T05:14:24Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-18 tests --priority flag which was removed. SC-25 and SC-61 test --broadcast flag (thrum-b0d4). SC-60 tests --as impersonation flag. SC-62 tests file conflict detection. Analyze: remove tests for permanently removed features, keep skips for planned features with tracking issue references.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z80.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Triage removed/missing feature tests (SC-18, SC-25, SC-60, SC-61, SC-62)","updated_at":"2026-03-01T06:34:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"SC-34/35/36 are product limitations — thrum wait polls personal inbox only, cannot watch subscription channels. Kept as fixme with clear root cause.","closed_at":"2026-03-01T06:34:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5fa0215d47db857e43a5147fc03526e15eef641dd59191ddb44000fc923b012b","created_at":"2026-03-01T05:14:29Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-34 (scope subscriptions), SC-35 (mention subscriptions), SC-36 (firehose subscription). All skip because subscription/notification system is not wired up. Analyze: is the feature planned? If so, keep skips with tracking refs. If abandoned, remove tests.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z80.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Triage notification subscription tests (SC-34, SC-35, SC-36)","updated_at":"2026-03-01T06:34:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"SC-67 un-skipped: fixed JSON shape assertions (agent_id under .agent not root). Now passes.","closed_at":"2026-03-01T06:34:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ebf80375f567541fb759da5cc710699c623c275afd5f5fa4036a91244e134a6b","created_at":"2026-03-01T05:14:34Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-67 skips because --json flag is not supported for all commands. Analyze which commands lack --json support and either add it or remove the test.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z80.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Triage SC-67 JSON output mode","updated_at":"2026-03-01T06:34:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"SC-40/SC-41 root cause documented in thrum-2ug.6: git init.defaultBranch mismatch. Kept as fixme.","closed_at":"2026-03-01T06:34:16Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"51b09711fc088e239c0a3ec01d844adb38841f4721593f822fea38d67911aca5","created_at":"2026-03-01T05:14:40Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-40 (cross-worktree message visibility) and SC-41 (cross-machine sync via git push/pull) skip because they need multi-daemon or remote git simulation. Analyze: can the E2E infra support these scenarios with the existing implementer worktree? If not, document as integration test gap.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z80.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Triage cross-worktree/cross-machine sync tests (SC-40, SC-41)","updated_at":"2026-03-01T06:34:16Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"SC-51/smoke are product bugs (WS push not triggering React Query refetch). SC-52 fixed by simplifying selector to match SC-53. Smoke kept as fixme.","closed_at":"2026-03-01T06:34:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1cab64de60336727c695a288a059d7f01b257f97800118f70966908fbd02f872","created_at":"2026-03-01T05:14:46Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-51 (Live Feed real-time updates) and SC-52 (Inbox view shows real messages) skip due to timing-sensitive WebSocket behavior and exclude_self filtering. SC-84 (smoke: CLI message sent while UI open) is flaky timing. Analyze: can these be made reliable with waitForSelector/polling, or should they remain skipped?","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z80.5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Triage flaky web UI tests (SC-51, SC-52, smoke)","updated_at":"2026-03-01T06:34:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"SC-13 un-skipped: session.list RPC is implemented. SC-54 is product timing issue (agent projection reset after daemon restart). Kept as fixme.","closed_at":"2026-03-01T06:34:17Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"9d451692276d1d2bc1eb6814d12c38f0f3f76da1e8c9d5196a0df72e40fce439","created_at":"2026-03-01T05:14:52Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"SC-13 (List all sessions) skips because session list command doesn't return expected format. SC-54 (Agent list in sidebar) is fixme because UI shows Agents(0) even after registering agents — likely projection/timing issue. Analyze root causes and fix or document.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z80.6","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Triage session list + agent sidebar tests (SC-13, SC-54)","updated_at":"2026-03-01T06:34:17Z","waiters":"","wisp_type":"","work_type":""}
