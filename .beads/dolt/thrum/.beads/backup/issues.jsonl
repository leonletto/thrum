{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"b401aab806474d5765947bf33e0127d27debd4f2772d37b64c7639150f0a1ad9","created_at":"2026-02-27T21:17:26Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/safety.go` (pre-restore safety backup)\n- Create: `internal/backup/safety_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nTest that CreateSafetyBackup creates a pre-restore-TIMESTAMP.zip in archives/ containing the current thrum data. Test it skips if no existing data.\n\n### Step 2: Implement\n```go\nfunc CreateSafetyBackup(backupDir, repoName string) (string, error)\n// If \u003cbackupDir\u003e/\u003crepoName\u003e/current/ exists OR sync worktree has data:\n//   1. Run a quick backup to temp dir\n//   2. Compress to \u003cbackupDir\u003e/\u003crepoName\u003e/archives/pre-restore-TIMESTAMP.zip\n//   3. Return path to safety backup\n// If no existing data, return empty string (nothing to protect)\n```\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -run TestSafety -v -race\n```\n\n## Acceptance Criteria\n- [ ] Creates pre-restore zip before any restore operation\n- [ ] Skips if no existing data to protect\n- [ ] Pre-restore zips are exempt from GFS rotation\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-0ga","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Implement safety backup before restore","updated_at":"2026-02-27T21:17:26Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"36d6f16d67cfbcb195f6a30e794261de49fb6c50703c0d1c333360d56691321a","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-12q","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix llms.txt stale --all flag reference","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"3e98b72158ab7e423d152942fa2a53a7e37dd309577a346a7a8e3d8e47f1acdf","created_at":"2026-02-27T21:17:09Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/rotation.go` (GFS retention logic + zip compression)\n- Create: `internal/backup/rotation_test.go`\n\n## Steps\n\n### Step 1: Write failing tests\nTest cases for GFS rotation:\n- 5 daily backups kept, 6th oldest deleted\n- Weekly: oldest surviving daily per week promoted\n- Monthly: oldest surviving weekly per month kept forever\n- Pre-restore safety backups exempt from rotation\n- Edge cases: empty archives dir, single backup, backups spanning month boundaries\n\n### Step 2: Implement rotation\n```go\nfunc CompressCurrentToArchive(currentDir, archivesDir string) (string, error)\n// Compresses currentDir into archives/YYYY-MM-DDTHHMMSS.zip using archive/zip\n// Returns path to created zip\n\nfunc ApplyRetention(archivesDir string, retention config.RetentionConfig) error\n// Parse archive filenames for timestamps\n// Classify into daily/weekly/monthly buckets\n// Delete archives that exceed retention limits\n// Skip files matching pre-restore-*.zip pattern\n```\n\n### Step 3: Integrate into RunBackup\nBefore writing new backup, compress existing current/ to archive, then apply retention.\n\n### Step 4: Verify\n```bash\ngo test ./internal/backup/... -run TestRotation -v -race\ngo test ./internal/backup/... -run TestRetention -v -race\n```\n\n## Acceptance Criteria\n- [ ] Pure Go using archive/zip (no external deps)\n- [ ] GFS: 5 daily, 4 weekly, monthly forever (configurable)\n- [ ] Pre-restore-*.zip exempt from rotation\n- [ ] Archive filenames are ISO8601 timestamps\n- [ ] Handles edge cases (empty dir, single file, month boundaries)\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-16m","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Implement GFS archive rotation","updated_at":"2026-02-27T21:17:09Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a56239e6a37f591053442b3671363c5de4c848f9ae80f35ad8163edfe0a26d06","created_at":"2026-02-27T21:17:27Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/export.go` (core export logic)\n- Create: `internal/backup/export_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nCreate a temp dir with mock JSONL files mimicking the a-sync worktree layout (events.jsonl + messages/*.jsonl). Test that ExportSyncData copies them to the backup dir preserving structure.\n\n### Step 2: Implement ExportSyncData\n```go\npackage backup\n\nfunc ExportSyncData(syncDir, backupDir string) (SyncExportResult, error)\n```\n- Use paths.SyncWorktreePath to find sync dir\n- Copy events.jsonl to backupDir/events.jsonl\n- Copy messages/*.jsonl to backupDir/messages/\n- Use atomic copy (write to .tmp, rename)\n- Return counts of files and events copied\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] Copies JSONL files from sync worktree preserving layout\n- [ ] Handles missing sync dir gracefully (error with clear message)\n- [ ] Handles empty messages/ dir\n- [ ] Uses atomic writes\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-1mk","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Implement JSONL export from sync worktree","updated_at":"2026-02-27T21:17:27Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1a59478e79212dfe9e0ffd3ecb1e750fd529730ee160a5fe36acdaf9379a0fa3","created_at":"2026-02-27T21:15:12Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Config model, JSONL export from sync worktree and SQLite local-only tables, manifest generation, CLI command wiring (thrum backup, thrum backup status, thrum backup config).","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-1xz","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Core Backup Infrastructure","updated_at":"2026-02-27T21:15:12Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"bcd588c05d5b4a65b12e4b28e9d4feba1f469a04d6dbe9874aaa0c41b7f4a367","created_at":"2026-02-27T21:17:45Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/local_export.go` (SQLite to JSONL for local tables)\n- Create: `internal/backup/local_export_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nCreate in-memory SQLite DB, populate message_reads, subscriptions, sync_checkpoints tables. Test that ExportLocalTables writes correct JSONL files.\n\n### Step 2: Implement ExportLocalTables\n```go\nfunc ExportLocalTables(db *sql.DB, backupDir string) (LocalExportResult, error)\n```\n- Export message_reads, subscriptions, sync_checkpoints as JSONL\n- Write to backupDir/local/message_reads.jsonl etc.\n- Use generic exportTable helper: SELECT * → json.Marshal each row → write line\n- Dynamic column scanning (like beads backup_export.go pattern)\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] Exports 3 local-only tables as JSONL\n- [ ] Each line is valid JSON\n- [ ] Round-trip: export then parse produces same data\n- [ ] Handles empty tables (writes empty file)\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-4av","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Implement SQLite local-only table export","updated_at":"2026-02-27T21:17:45Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"15a2f978d63a9f841757a1513603a085564f7b3773c4e117aec55ec833606aeb","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-4c0","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update website docs for v0.5.1 changes","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"ff0d63c61eb20a9e9f0c59c2eaa40abf40638d155c287b2f15446f7edddf973e","created_at":"2026-02-27T21:17:23Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `cmd/thrum/main.go` (add `thrum backup plugin add/list/remove` subcommands)\n- Modify: `internal/config/daemon.go` (add helper to add/remove plugins)\n\n## Steps\n\n### Step 1: Add plugin management subcommands\n```\nthrum backup plugin add --name beads --command 'bd backup --force' --include '.beads/backup/*'\nthrum backup plugin add --preset beads    # Built-in preset for common tools\nthrum backup plugin list\nthrum backup plugin remove --name beads\n```\n\n### Step 2: Implement presets\nBuilt-in presets for common tools:\n- beads: {command: 'bd backup --force', include: ['.beads/backup/*']}\n- beads-rust: {command: 'beads backup --force', include: ['.beads/backup/*']}\n\n### Step 3: Verify\n```bash\ngo build ./cmd/thrum/\n./thrum backup plugin add --preset beads\n./thrum backup plugin list\n./thrum backup config\n```\n\n## Acceptance Criteria\n- [ ] Plugin add/list/remove commands work\n- [ ] Presets for beads and beads-rust\n- [ ] Config updated in .thrum/config.json\n- [ ] thrum backup config shows plugins","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-4zr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Add beads plugin preset and config command","updated_at":"2026-02-27T21:17:23Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"ComposeBar redesign complete","closed_at":"2026-02-24T18:35:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"787d4bd738cc7e1732138f4d3a64526327fbade719f41080fc696b7556712b24","created_at":"2026-02-24T16:19:44Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Re-implement: (C1) MentionAutocomplete show agent display names as labels, (C2) ComposeBar two-row Slack-style layout, (C3) MentionAutocomplete test updates, (D4) MentionAutocomplete search by agent_id+display+role with agents-first ordering. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups C + D4.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"ComposeBar Redesign + MentionAutocomplete — Two-row layout, agent names","updated_at":"2026-02-24T18:35:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:30:47Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"257fd4664f3ce4c2701bc391ff417adf1b5d74b06accf194225e8d5dbd3cae23","created_at":"2026-02-24T16:21:36Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/MentionAutocomplete.tsx\n\n## Steps\n1. Separate agent and group suggestion building into agentSuggestions and groupSuggestions arrays\n2. Agent filter: match against agent.role, agent.agent_id, AND agent.display (all lowercased)\n3. Agent label: agent.display || agent.agent_id.replace(/^(agent|user):/, '')\n4. Agent sublabel: agent.role\n5. Group filter: unchanged (match group.name)\n6. Merge: filteredSuggestions = [...agentSuggestions, ...groupSuggestions] (agents first)\n\n## Acceptance Criteria\n- [ ] Typing @coordinator_ shows coordinator_main as first suggestion\n- [ ] Agents appear before groups in dropdown\n- [ ] Build passes","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"MentionAutocomplete: search by agent_id+display+role, agents first","updated_at":"2026-02-24T18:30:47Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:34:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"581b0dd69612f50395fe3bb5c2f367d0c43c6d1a4ef3a8b532c46c931399bdde","created_at":"2026-02-24T16:21:41Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/ComposeBar.tsx\n\n## Steps\n1. Add removeChip(chip) function that filters selectedRecipients\n2. Remove Users import from lucide-react (keep Loader2, X)\n3. Restructure form from single-row to two-row:\n   - Row 1 (addressing): To: label + allMentions chips (union of selectedRecipients + mentions) + '+ Add' button + recipient dropdown. Hidden when groupScope set.\n   - Row 2 (message): flex-1 MentionAutocomplete + Send button inline\n4. Chips from selectedRecipients get X button for removal via removeChip\n5. Add pt-1 to isImpersonating warning div\n\n## Acceptance Criteria\n- [ ] Addressing row above textarea\n- [ ] Full-width textarea on its own row\n- [ ] Chips show combined recipients\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"ComposeBar: Two-row Slack-style layout with removable chips","updated_at":"2026-02-24T18:34:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:34:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a2950cfed2934915135f8f223e4a741c77f5e98a75e600801f97b94ae4a2fe71","created_at":"2026-02-24T16:21:49Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/__tests__/MentionAutocomplete.test.tsx\n\n## Steps\n1. Update mock display values: 'Assistant Bot' → 'assistant_main', 'Research Agent' → 'researcher_main', 'Testing Agent' → 'tester_main'\n2. Update ALL label assertions: @assistant → @assistant_main, @researcher → @researcher_main, @tester → @tester_main\n3. Update mention extraction assertions: ['assistant'] → ['assistant_main'], ['assistant','researcher'] → ['assistant_main','researcher_main'], etc.\n4. Update typed text in tests: 'Hello @assistant and @researcher' → 'Hello @assistant_main and @researcher_main', etc.\n\n## Acceptance Criteria\n- [ ] All MentionAutocomplete tests pass\n- [ ] All 473+ tests pass: cd ui \u0026\u0026 pnpm test -- -- --run","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-76v.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update MentionAutocomplete tests for agent display names","updated_at":"2026-02-24T18:34:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed in f99260b: gitConfigValue() now uses exec.Command directly instead of safecmd.Git to read real git config user.name","closed_at":"2026-02-25T16:11:25Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a0408b037327a4eaf38889e7faab7d9d189a86a4ac51e1757528ec5bbb3a23db","created_at":"2026-02-25T16:11:20Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"safecmd.Git injects -c user.name=Thrum on every git command, which overrides git config --get user.name in the user.identify RPC. Fix: gitConfigValue() uses exec.Command directly to bypass the override.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-79d","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix user.identify returning Thrum instead of git username","updated_at":"2026-02-25T16:11:25Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"CSS variable migration complete","closed_at":"2026-02-24T18:35:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6197857f8441ef96aa94db2c4180f4d74087b1862bfde926a915b338d2d16b48","created_at":"2026-02-24T16:19:25Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Replace all hardcoded cyan-* Tailwind classes and #0d1120 hex values with CSS variable tokens across 17+ UI files. Add 4 new CSS variables. Fix dialog/panel backgrounds to use --panel-bg-start. Fix MessageBubble hardcoded hex colors for light mode. Do NOT modify tailwind.config.js. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups A + D5 + D6.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"CSS Variable Migration — Replace hardcoded cyan with CSS var tokens","updated_at":"2026-02-24T18:35:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:04:14Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"0fbb58697c518d48bf74ea35bd7b111c2090ef37ed32e8c775053145a21a25b1","created_at":"2026-02-24T16:21:38Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/index.css\n\n## Steps\n1. Add to :root section: --accent-glow-soft: transparent; --accent-glow-hover: transparent; --mention-highlight: rgba(8, 145, 178, 0.1); --mention-highlight-self: rgba(8, 145, 178, 0.2);\n2. Add to .dark section: --accent-glow-soft: rgba(56, 189, 248, 0.3); --accent-glow-hover: rgba(56, 189, 248, 0.6); --mention-highlight: rgba(56, 189, 248, 0.15); --mention-highlight-self: rgba(56, 189, 248, 0.3);\n\n## Acceptance Criteria\n- [ ] 4 new variables in :root with light values\n- [ ] 4 new variables in .dark with dark values\n- [ ] Build passes: cd ui \u0026\u0026 pnpm build","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add 4 new CSS variables to index.css for both :root and .dark","updated_at":"2026-02-24T17:04:14Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:09:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"17d0d90326a779bbd8a72cca5784cc50d1cb51062a8d69e5f76e379385903929","created_at":"2026-02-24T16:21:53Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/ui/button.tsx (5 cyan + 2 shadow rgbas)\n- Modify: ui/packages/web-app/src/components/ui/card.tsx (1 cyan + 1 shadow + slate gradient)\n- Modify: ui/packages/web-app/src/components/ui/dialog.tsx (1 cyan + 1 shadow + gradient → --panel-bg-start/--panel-bg-end)\n- Modify: ui/packages/web-app/src/components/ui/badge.tsx (3 cyan patterns)\n- Modify: ui/packages/web-app/src/components/ui/ScopeBadge.tsx (3 cyan classes)\n\n## Steps\nApply the canonical mapping from RECOVERY_PLAN.md section A2. Key mappings:\n- text-cyan-400/500 → text-[var(--accent-color)]\n- border-cyan-500/10-30 → border-[var(--accent-border)]\n- ring-cyan-500 → ring-[var(--accent-color)]\n- from-cyan-600 → from-[var(--accent-hover)]\n- to-cyan-500 → to-[var(--accent-color)]\n- from-slate-900 to-slate-800 → from-[var(--panel-bg-start)] to-[var(--panel-bg-end)]\n- shadow rgba(56,189,248,...) → shadow-[0_0_15px_var(--accent-glow-soft)]\n\nIMPORTANT: dialog.tsx gradient must use --panel-bg-start/--panel-bg-end (NOT --app-bg-secondary)\n\n## Acceptance Criteria\n- [ ] 0 cyan- references in these 5 files\n- [ ] Build passes","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Replace cyan classes in UI primitives (button, card, dialog, badge, ScopeBadge)","updated_at":"2026-02-24T17:09:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:09:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1dc7f936283459a8f56132adba5326a4150a3625d0b7ac2e230f6ab1d2715f5a","created_at":"2026-02-24T16:22:00Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/ComposeBar.tsx (19 cyan + 1 hex)\n- Modify: ui/packages/web-app/src/components/groups/GroupChannelView.tsx (38 cyan + 2 hex — largest)\n- Modify: ui/packages/web-app/src/components/inbox/MessageBubble.tsx (3 inline rgba + hardcoded hex colors for light mode D5)\n- Modify: ui/packages/web-app/src/components/status/HealthBar.tsx (2 cyan)\n- Modify: ui/packages/web-app/src/components/agents/AgentCard.tsx (1 cyan)\n- Modify: ui/packages/web-app/src/components/Sidebar.tsx (5 cyan)\n- Modify: ui/packages/web-app/src/components/coordination/WhoHasView.tsx (3 cyan)\n- Modify: ui/packages/web-app/src/components/subscriptions/SubscriptionPanel.tsx (2 cyan)\n\n## Steps\nApply canonical mapping from RECOVERY_PLAN.md A2. Key notes:\n- bg-[#0d1120] → bg-[var(--panel-bg-start)] (NOT --app-bg-secondary — causes transparent panels)\n- MessageBubble: also fix hardcoded hex text-[#e2e8f0], text-[#cbd5e1], text-[#64748b] → use CSS vars (text-[var(--text-secondary)] etc.)\n- MessageBubble: hover:bg-[rgba(56,189,248,0.04)] → hover:bg-[var(--accent-subtle-bg)]\n- MessageBubble inline mention rgba styles → var(--mention-highlight), var(--mention-highlight-self)\n- MentionAutocomplete.tsx: bg-popover → bg-[var(--panel-bg-start)] on dropdown container\n- Leave yellow/amber, red, purple, gray untouched\n\n## Acceptance Criteria\n- [ ] 0 cyan- references in all component .tsx files\n- [ ] 0 #0d1120 references\n- [ ] Build passes","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Replace cyan classes in feature components (ComposeBar, GroupChannelView, MessageBubble, 5 others)","updated_at":"2026-02-24T17:09:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T17:10:39Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6194edfb63b23f828168d9bdce1ec54e535163035ea5301756b6d3ffa17300bd","created_at":"2026-02-24T16:22:07Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/status/__tests__/HealthBar.test.tsx\n- Modify: ui/packages/web-app/src/components/agents/__tests__/AgentCard.test.tsx\n- Modify: ui/packages/web-app/src/components/ui/__tests__/ScopeBadge.test.tsx\n- Modify: ui/packages/web-app/src/components/inbox/__tests__/MessageBubble.test.tsx (hover class assertion)\n\n## Steps\nUpdate any assertions that check for cyan-* classes or rgba values to use the new CSS variable equivalents:\n- hover:bg-[rgba(56,189,248,0.04)] → hover:bg-[var(--accent-subtle-bg)]\n- ring-cyan-500 → ring-[var(--accent-color)]\n- text-cyan-400 → text-[var(--accent-color)]\n- border-cyan-500/20 → border-[var(--accent-border)]\n\n## Acceptance Criteria\n- [ ] All 473+ tests pass: cd ui \u0026\u0026 pnpm test -- -- --run\n- [ ] Build passes: cd ui \u0026\u0026 pnpm build\n- [ ] grep -r cyan- ui/packages/web-app/src/components/ --include=*.tsx returns 0 results","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-7fg.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update test files for CSS variable migration","updated_at":"2026-02-24T17:10:39Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"a3fb00cf985bcb43bde9c7647548e9b47849036363e1457a3d50a7ae0ea660ba","created_at":"2026-02-27T21:18:05Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `cmd/thrum/main.go` (add restore subcommand to backup group)\n\n## Steps\n\n### Step 1: Add restore subcommand\nAdd to the backupCmd() group:\n```\nthrum backup restore [archive.zip]\n```\n- Optional positional arg: path to zip archive\n- If omitted, restore from current/ in backup dir\n- --dir flag to override backup dir (same as thrum backup)\n- Confirmation prompt before proceeding (unless --yes flag)\n\n### Step 2: Integration test\nTest full round-trip: backup -\u003e corrupt/delete data -\u003e restore -\u003e verify data matches.\n\n### Step 3: Verify\n```bash\ngo build ./cmd/thrum/\n./thrum backup restore --help\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] thrum backup restore works from current/\n- [ ] thrum backup restore ./archive.zip works from zip\n- [ ] Confirmation prompt shown (--yes to skip)\n- [ ] Error message if no backup found\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-85u","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Wire up thrum backup restore CLI","updated_at":"2026-02-27T21:18:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Fixed: Wait now auto-reconnects to daemon with 60s retry. Also fixed user.identify returning Thrum instead of git username (safecmd.Git override).","closed_at":"2026-02-25T15:59:01Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2b4f9dd945d826294d03191a5e7b6a854b3794bb7e0881e6cc5b861aa3cc4928","created_at":"2026-02-25T15:58:50Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-8nq","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix thrum wait orphaned on daemon restart","updated_at":"2026-02-25T15:59:01Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4f142db260ad885041f45b3ea6d1c3a020f3f7f1262ee6b5bd0a5ea86c0a66fd","created_at":"2026-02-24T16:19:55Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"New work: (E) Wire user.identify RPC into AppShell auto-registration to show git config user.name instead of 'thrum'. (F) Redesign AgentContextPanel from large bordered card to thin header bar + gear icon slide-out panel matching GroupChannelView pattern. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups E + F.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Agent View Redesign + Git Username — Minimal header, gear slide-out","updated_at":"2026-02-26T06:51:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"7d3d120e9ed2252ae5ac1253ef5b3bdb4c48b32d8197cf0f44dba787675a2278","created_at":"2026-02-24T16:22:07Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/AppShell.tsx\n\n## Steps\n1. In AppShell auto-registration flow, call user.identify RPC first to get git config user.name\n2. Pass the real name to user.register instead of hardcoded 'thrum'\n3. Fallback to 'thrum' if user.identify fails\n\n## Acceptance Criteria\n- [ ] UI header shows git config user.name instead of 'Thrum'\n- [ ] Fallback works if git config not set","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Wire user.identify RPC into AppShell for git username display","updated_at":"2026-02-26T06:51:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"6876b26074e9d59456761bef7042407a39e4c76d0647aadbc98041e8106e56ec","created_at":"2026-02-24T16:22:19Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/agents/AgentContextPanel.tsx\n- Test: ui/packages/web-app/src/components/agents/__tests__/AgentContextPanel.test.tsx\n\n## Steps\n1. Replace the large bordered card with a thin header bar (~40px height):\n   - Status dot (online/offline) + agent display name (bold) + role badge + intent text (truncated) + gear icon button\n2. Add gear icon click → slide-out panel (absolute right, w-72, same pattern as GroupChannelView settings):\n   - Full agent details: AGENT ID, ROLE, INTENT, TASK, BRANCH, UNCOMMITTED (with file list), CHANGED, HEARTBEAT\n   - Delete Agent button at bottom behind border-top divider\n   - Close X button at top-right\n3. Move AgentDeleteDialog trigger inside the slide-out panel\n4. Update tests to match new structure\n\nReference: ui/packages/web-app/src/components/groups/GroupChannelView.tsx lines 170-400 for the slide-out pattern\n\n## Acceptance Criteria\n- [ ] Agent header is a single thin bar (not a large card)\n- [ ] Gear icon opens slide-out panel with full details\n- [ ] Delete Agent is inside slide-out, not inline\n- [ ] Messages get maximum vertical space\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Redesign AgentContextPanel: thin header bar + gear slide-out","updated_at":"2026-02-26T06:51:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"301cd8fb913a48e488f1a60382e3c716e01a7f43ce6f8f76701160541e533fb3","created_at":"2026-02-25T00:15:38Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"The UI's auto-registration flow in AppShell.tsx registers a 'thrum' user agent via user.register RPC. This agent then appears in the sidebar agent list as 'Thrum' alongside real agents. Either: (a) the UI user should not appear in the agent list, or (b) the agent list should filter out user-type agents. Investigate how AppShell registers and whether the agent list RPC can exclude UI users.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.3","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix phantom 'Thrum' agent in sidebar","updated_at":"2026-02-25T16:55:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-25T16:55:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"340671237b6dde4a4852c9ddb8043d7a29299e728bcd9afb7c61935c5c07425a","created_at":"2026-02-25T00:15:40Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"My Inbox view shows 'No messages' even though messages exist. Root cause: the UI registers as 'thrum' (hardcoded) via user.register, but actual messages are addressed to real agent names like @coordinator_main. The inbox filter matches against the UI's registered identity ('thrum') and finds nothing. Fix: wire user.identify RPC to get git username, then use that as the UI identity so inbox filtering works. This is closely related to thrum-9b7.1 (git username display) — the same user.identify call fixes both the display name and the inbox filter.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-9b7.4","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix My Inbox empty — UI identity mismatch drops all messages","updated_at":"2026-02-25T16:55:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"d8f272ae30d4e1206c1690fb5a5dde21d98f170ee9573b898553cbea74d7c395","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-aya","is_template":0,"issue_type":"chore","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Archive completed dev-docs (RECOVERY_PLAN, ui-recovery prompt)","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8569d8740829a3f930234bc3d0c9122bd7c77423c98a4b1bc514d2fda618dd87","created_at":"2026-02-27T21:17:42Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `dev-docs/dev-scripts/sync-dev-docs.sh` (replace manual beads backup with thrum backup)\n\n## Steps\n\n### Step 1: Configure thrum backup with beads plugin\n```bash\nthrum backup plugin add --preset beads\n```\n\n### Step 2: Update sync script\nReplace the manual beads backup section with a single thrum backup call:\n```bash\n# Refresh thrum + beads backup before syncing\necho 'Running thrum backup...'\n(cd \"$THRUM\" \u0026\u0026 thrum backup --dir \"$THRUM/dev-docs/backup\" 2\u003e\u00261) || echo 'Backup warning (non-fatal)'\necho 'Backup complete.'\n```\n\nThis produces:\n- dev-docs/backup/thrum/current/ (thrum data + beads plugin data)\n- dev-docs/backup/thrum/archives/ (rotated zips)\n\n### Step 3: Test the full flow\n```bash\nbash dev-docs/dev-scripts/sync-dev-docs.sh\nls dev-docs/backup/thrum/current/\n```\n\n## Acceptance Criteria\n- [ ] sync-dev-docs.sh uses thrum backup instead of manual bd backup\n- [ ] Beads data included via plugin system\n- [ ] Backup dir uses repo name subfolder (thrum/)\n- [ ] Script still syncs to thrumdev repo correctly","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-chr","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Update sync-dev-docs.sh for thrum backup","updated_at":"2026-02-27T21:17:42Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:27Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"48e4e7b7655af0dfce83dc3c806c45371c54ace1e90f45bef62ae6bf22fb6d83","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-ftu","is_template":0,"issue_type":"bug","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix website index.html hardcoded :4100 port","updated_at":"2026-02-26T06:22:27Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4ee1c3147106a0974145bd6c5912280c5c31a94db77abfce6a56f6e7e1876a25","created_at":"2026-02-27T21:18:22Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `cmd/thrum/main.go` (add backupCmd group with create/status/config subcommands)\n- Create: `internal/backup/manifest.go` (manifest generation)\n- Create: `internal/backup/backup.go` (orchestrator: calls export functions, writes manifest)\n- Test: `internal/backup/backup_test.go`\n\n## Steps\n\n### Step 1: Implement manifest\n```go\ntype Manifest struct {\n    Version      int            `json:\"version\"`\n    Timestamp    time.Time      `json:\"timestamp\"`\n    ThrumVersion string         `json:\"thrum_version\"`\n    RepoName     string         `json:\"repo_name\"`\n    Counts       ManifestCounts `json:\"counts\"`\n}\n```\n\n### Step 2: Implement RunBackup orchestrator\n```go\nfunc RunBackup(opts BackupOptions) (*BackupResult, error)\n```\n- Resolve backup dir (CLI flag \u003e config \u003e default .thrum/backup)\n- Derive repo name from git remote or dir name (use cli.GetRepoName)\n- Create \u003cbackupDir\u003e/\u003crepoName\u003e/current/\n- Call ExportSyncData, ExportLocalTables, ExportConfigFiles\n- Write manifest.json\n- Return BackupResult with counts and paths\n\n### Step 3: Wire CLI\nAdd backupCmd() to main.go following daemonCmd() pattern:\n- `thrum backup` (default: run backup)\n- `thrum backup status` (show last backup from manifest)\n- `thrum backup config` (show effective backup config)\n- `--dir` flag overrides config backup dir\n\n### Step 4: Verify\n```bash\ngo test ./internal/backup/... -v -race\ngo build ./cmd/thrum/\n./thrum backup --help\n```\n\n## Acceptance Criteria\n- [ ] thrum backup creates backup with all data\n- [ ] thrum backup --dir /tmp/test works\n- [ ] thrum backup status shows last backup info\n- [ ] thrum backup config shows effective config\n- [ ] Manifest written with accurate counts\n- [ ] Repo name used as subfolder\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-gln","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Wire up thrum backup CLI commands","updated_at":"2026-02-27T21:18:22Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Release testing complete: 58 pass, 0 fail","closed_at":"2026-02-26T04:44:53Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8f2aede23f86e3d0620a8da88413c7dc6472c12923975acbe4b40931d8048d8c","created_at":"2026-02-25T22:46:41Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-htj","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"v0.5.1 Release Testing","updated_at":"2026-02-26T04:44:53Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"UI structural fixes complete","closed_at":"2026-02-24T18:35:35Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"2b0e61e85522404b0e9261adb4ae2c2e176aa6daf89560e72d3d29ae1bdffe19","created_at":"2026-02-24T16:19:36Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Re-implement: (B1) DaemonRestart port preservation via THRUM_WS_PORT env var, (B2) URL hash routing for navigation persistence in uiStore, (B3) refetchInterval:5000 polling for useMessageList, (B4) refetchInterval:30000 for useSessionList, (D1) MessageList hooks ordering fix + auto-scroll, (D2) Remove useBrowserNotifications from DashboardPage. See dev-docs/failure-recovery/RECOVERY_PLAN.md Groups B + D1 + D2.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"UI Structural Fixes — Daemon port, hash routing, polling, hooks","updated_at":"2026-02-24T18:35:35Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5d62901018caf97075b5a0ea5ed517151b661bcda5020e1e114ce285d11c3e64","created_at":"2026-02-24T16:21:49Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: internal/cli/daemon.go\n\n## Steps\nIn DaemonRestart(), add code to:\n1. Read prevPort := ReadWebSocketPort(repoPath) BEFORE calling DaemonStop\n2. After DaemonStop and sleep, if prevPort \u003e 0: os.Setenv(\"THRUM_WS_PORT\", fmt.Sprintf(\"%d\", prevPort)) with defer os.Unsetenv\n3. Verify os and fmt are already imported\n\n## Acceptance Criteria\n- [ ] go build ./cmd/thrum/ compiles\n- [ ] Port preserved across thrum daemon restart","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"DaemonRestart port preservation via THRUM_WS_PORT env var","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"402c1d142150aa5249bef0a9dabe87a4e73c84fc3c6bfea9eccc4bd047501461","created_at":"2026-02-24T16:21:56Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/shared-logic/src/stores/uiStore.ts\n\n## Steps\n1. Add validViews array with all View type values\n2. Add stateFromHash() that parses window.location.hash (URLSearchParams on hash after #) into UIState\n3. Add stateToHash() that writes UIState to URL hash via window.history.replaceState (no history spam)\n4. Change initialState to merge defaults with stateFromHash() restored values\n5. Add uiStore.subscribe() that calls stateToHash on every state change\n6. Call stateToHash(initialState) once at startup\n\nHash format: #view=live-feed\u0026agent=xyz\u0026group=abc\n\n## Acceptance Criteria\n- [ ] Refreshing page returns to current view\n- [ ] URL updates when navigating between views\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.2","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"URL hash routing for navigation persistence in uiStore","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"64f67693b6f49e853b5bb56bb531034cf462c2138d095aa6bc6e28aa477ade0d","created_at":"2026-02-24T16:22:02Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/shared-logic/src/hooks/useMessage.ts\n- Modify: ui/packages/shared-logic/src/hooks/useSession.ts\n\n## Steps\n1. In useMessageList: add refetchInterval: 5000 after existing staleTime: 1000\n2. In useSessionList: add refetchInterval: 30000 after existing staleTime: 30000\n\nBrowser clients don't have WebSocket push subscriptions (requires agent session), so polling is the primary refresh mechanism.\n\n## Acceptance Criteria\n- [ ] Messages appear within 5s of being sent (without page refresh)\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.3","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Add polling fallbacks for useMessageList and useSessionList","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"8b4f4e0f682adbb2d5334774311f6766ea613fa78a4533ff7dc9c366514078b4","created_at":"2026-02-24T16:22:11Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/components/inbox/MessageList.tsx\n\n## Steps\n1. Move scrollEndRef (useRef), prevMessageCountRef (useRef), useLayoutEffect (scroll to bottom on initial render), and useEffect (scroll to bottom when messages.length increases) ABOVE the early returns (loading/empty states)\n2. Add conversations = groupByConversation(messages).slice().reverse() so newest appear at bottom\n3. Add \u003cdiv ref={scrollEndRef} /\u003e at the end of the scroll area\n\nThis fixes React error #310 (Rendered more hooks than during the previous render).\n\n## Acceptance Criteria\n- [ ] No React error #310 on My Inbox or agent inbox views\n- [ ] Messages appear newest at bottom\n- [ ] Auto-scrolls to bottom on load and when new messages arrive\n- [ ] Tests pass","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.4","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Fix MessageList hooks ordering + auto-scroll to bottom","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-24T18:29:58Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4a6f136d0abe53c8b6fb27eabec0d31c777809546e40d41e2baed0d4bbbbecb9","created_at":"2026-02-24T16:22:16Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n- Modify: ui/packages/web-app/src/pages/DashboardPage.tsx\n- Modify: ui/packages/web-app/src/pages/__tests__/DashboardPage.test.tsx\n\n## Steps\n1. Remove useBrowserNotifications call from DashboardPage\n2. Remove useCurrentUser import from DashboardPage (no longer needed for notifications)\n3. Keep useCurrentUser in the test mock (child components still use it)\n\n## Acceptance Criteria\n- [ ] No browser notification permission prompt on page load\n- [ ] Tests pass (DashboardPage.test.tsx)","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-kh3.5","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Remove useBrowserNotifications from DashboardPage","updated_at":"2026-02-24T18:29:58Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"89ddfe9b66ccd7515e6b7fd0b7b541740cb3a0b27ce2c4f886fcd4174ac23b85","created_at":"2026-02-27T21:17:05Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/plugins.go` (plugin command runner and file collector)\n- Create: `internal/backup/plugins_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nTest RunPlugins with a mock plugin config that runs a simple command (echo) and includes files matching a glob pattern. Test timeout handling (60s). Test command failure is non-fatal (warn, continue).\n\n### Step 2: Implement\n```go\nfunc RunPlugins(plugins []config.PluginConfig, repoPath, backupDir string) ([]PluginResult, error)\n// For each plugin:\n//   1. Run plugin.Command with CWD=repoPath, 60s timeout\n//   2. If command fails: log warning, skip file collection, continue\n//   3. Glob plugin.Include patterns relative to repoPath\n//   4. Copy matched files to backupDir/plugins/\u003cplugin.Name\u003e/\n//   5. Preserve relative paths within the plugin dir\n```\n\n### Step 3: Integrate into RunBackup\nAfter core export, run plugins if configured. Include plugin names in manifest.\n\n### Step 4: Verify\n```bash\ngo test ./internal/backup/... -run TestPlugin -v -race\n```\n\n## Acceptance Criteria\n- [ ] Runs plugin commands with 60s timeout\n- [ ] Collects files matching glob patterns\n- [ ] Plugin failure is non-fatal (warns, continues)\n- [ ] Files placed in plugins/\u003cname\u003e/ preserving relative paths\n- [ ] Plugin names listed in manifest\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-lk1","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Implement third-party plugin execution","updated_at":"2026-02-27T21:17:05Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"151325d80e27740f7d7f947fa90c29d12b86b3a9e3b69c45e3b6533995fc15e0","created_at":"2026-02-27T21:17:48Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/restore.go` (restore logic)\n- Create: `internal/backup/restore_test.go`\n\n## Steps\n\n### Step 1: Write failing tests\nTest restore from current/ dir and from a zip archive. Verify JSONL files end up in sync worktree, local tables imported to SQLite, config files restored.\n\n### Step 2: Implement\n```go\nfunc RunRestore(opts RestoreOptions) error\n// opts: BackupDir, RepoName, ArchivePath (optional), RepoPath\n//\n// 1. CreateSafetyBackup (if existing data present)\n// 2. cli.DaemonStop(repoPath) — ignore not-running error\n// 3. Determine source: ArchivePath (extract zip to temp) or current/\n// 4. Copy JSONL files to sync worktree (paths.SyncWorktreePath)\n// 5. Import local/ JSONL tables into SQLite\n// 6. Restore config/ files to .thrum/\n// 7. Delete .thrum/var/messages.db (will be rebuilt)\n// 8. cli.DaemonStart(repoPath, localOnly) — rebuilds SQLite via projector\n```\n\n### Step 3: Implement zip extraction helper\n```go\nfunc extractZipToDir(zipPath, destDir string) error\n```\n\n### Step 4: Implement local table import\n```go\nfunc ImportLocalTables(db *sql.DB, backupDir string) error\n// Read local/message_reads.jsonl etc, INSERT OR IGNORE into SQLite\n```\n\n### Step 5: Verify\n```bash\ngo test ./internal/backup/... -run TestRestore -v -race\n```\n\n## Acceptance Criteria\n- [ ] Safety backup created before restore\n- [ ] Daemon stopped before restore, restarted after\n- [ ] JSONL files restored to sync worktree\n- [ ] Local tables imported to SQLite\n- [ ] Config/identity/context files restored\n- [ ] SQLite rebuilt automatically on daemon start\n- [ ] Works from current/ dir or zip archive\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-lru","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Implement restore from backup","updated_at":"2026-02-27T21:17:48Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"5f7602b806696248950dc7979aac8061d454add0a96ef8d39ed4c02dd6a20ebf","created_at":"2026-02-27T21:15:17Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"GFS retention policy with archive/zip, restore with safety backup, daemon stop/restart, SQLite projection rebuild.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-n0u","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Rotation \u0026 Restore","updated_at":"2026-02-27T21:15:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"48d0ec2a66914b74f47d0b2766c8f794d5d0adef0d80a4aef7a5dc3fb4e10b11","created_at":"2026-02-27T21:18:01Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Create: `internal/backup/config_export.go` (copy config/identity/context files)\n- Create: `internal/backup/config_export_test.go`\n\n## Steps\n\n### Step 1: Write failing test\nCreate temp .thrum dir with config.json, identities/*.json, context/*.md. Test ExportConfigFiles copies them to backupDir/config/ preserving structure.\n\n### Step 2: Implement ExportConfigFiles\n```go\nfunc ExportConfigFiles(thrumDir, backupDir string) error\n```\n- Copy .thrum/config.json → backupDir/config/config.json\n- Copy .thrum/identities/*.json → backupDir/config/identities/\n- Copy .thrum/context/*.md → backupDir/config/context/\n- Skip runtime files (var/, *.sock, *.pid, *.lock, *.port)\n\n### Step 3: Verify\n```bash\ngo test ./internal/backup/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] Copies config, identity, and context files\n- [ ] Preserves directory structure\n- [ ] Skips runtime/ephemeral files\n- [ ] Handles missing optional dirs (identities/, context/)\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-qd9","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Implement config and identity file backup","updated_at":"2026-02-27T21:18:01Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"Closed","closed_at":"2026-02-26T06:22:28Z","closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"4593ea725afc58b7ff059b4b87222e03d5a20dc17e4310369b0bc102d1a48969","created_at":"2026-02-26T05:19:13Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-yh2","is_template":0,"issue_type":"chore","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":3,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":".","source_system":"","spec_id":"","status":"closed","target":"","timeout_ns":0,"title":"Update dev-docs bug reports with resolution status","updated_at":"2026-02-26T06:22:28Z","waiters":"","wisp_type":"","work_type":"mutex"}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"1e9ee40a138519408c0c2f1b968e78c677baa2ec029e90aa65013e66545bdd9c","created_at":"2026-02-27T21:15:17Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"Third-party plugin execution and file collection, sync-dev-docs.sh integration, beads plugin config.","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-ynl","is_template":0,"issue_type":"epic","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":2,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Plugin System \u0026 Integration","updated_at":"2026-02-27T21:15:17Z","waiters":"","wisp_type":"","work_type":""}
{"acceptance_criteria":"","actor":"","agent_state":"","assignee":null,"await_id":"","await_type":"","close_reason":"","closed_at":null,"closed_by_session":"","compacted_at":null,"compacted_at_commit":null,"compaction_level":0,"content_hash":"842fa80e7c5a5173f7b68d9a317602cc60e1ae0029a412e3a11c217e83756eb6","created_at":"2026-02-27T21:17:08Z","created_by":"Leon Letto","crystallizes":0,"defer_until":null,"description":"## Files\n\n- Modify: `internal/config/daemon.go` (add BackupConfig struct and fields to ThrumConfig)\n- Test: `internal/config/daemon_test.go` (add tests for backup config load/save)\n\n## Steps\n\n### Step 1: Write failing test\nTest that BackupConfig loads from config.json with dir, retention, and plugins fields. Test defaults (empty dir = .thrum/backup, daily=5, weekly=4, monthly=-1).\n\n### Step 2: Add BackupConfig struct\n```go\ntype BackupConfig struct {\n    Dir       string          `json:\"dir,omitempty\"`\n    Retention RetentionConfig `json:\"retention,omitempty\"`\n    Plugins   []PluginConfig  `json:\"plugins,omitempty\"`\n}\n\ntype RetentionConfig struct {\n    Daily   int `json:\"daily\"`   // default 5\n    Weekly  int `json:\"weekly\"`  // default 4\n    Monthly int `json:\"monthly\"` // default -1 (forever)\n}\n\ntype PluginConfig struct {\n    Name    string   `json:\"name\"`\n    Command string   `json:\"command\"`\n    Include []string `json:\"include\"`\n}\n```\n\nAdd `Backup BackupConfig` field to ThrumConfig. Update applyDefaults() with backup defaults. Update SaveThrumConfig to preserve backup section.\n\n### Step 3: Verify\n```bash\ngo test ./internal/config/... -v -race\n```\n\n## Acceptance Criteria\n- [ ] BackupConfig loads from config.json\n- [ ] Defaults applied when fields missing\n- [ ] SaveThrumConfig preserves unknown keys AND backup section\n- [ ] Tests pass with race detector","design":"","due_at":null,"ephemeral":0,"estimated_minutes":null,"event_kind":"","external_ref":null,"hook_bead":"","id":"thrum-z41","is_template":0,"issue_type":"task","last_activity":null,"metadata":"{}","mol_type":"","notes":"","original_size":null,"owner":"leon.letto@gmail.com","payload":"","pinned":0,"priority":1,"quality_score":null,"rig":"","role_bead":"","role_type":"","sender":"","source_repo":"","source_system":"","spec_id":"","status":"open","target":"","timeout_ns":0,"title":"Add BackupConfig to ThrumConfig","updated_at":"2026-02-27T21:17:08Z","waiters":"","wisp_type":"","work_type":""}
