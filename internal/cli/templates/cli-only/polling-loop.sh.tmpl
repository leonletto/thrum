#!/bin/bash
# CLI-only message polling loop for Thrum
# Auto-generated by thrum init --runtime cli-only
set -e

AGENT_NAME="${THRUM_NAME:-{{.AgentName}}}"
POLL_INTERVAL="${THRUM_POLL_INTERVAL:-5}"

echo "Polling for messages as $AGENT_NAME (every ${POLL_INTERVAL}s)..."
echo "Press Ctrl+C to stop."

while true; do
  MESSAGES=$(thrum inbox --unread --json 2>/dev/null)
  COUNT=$(echo "$MESSAGES" | jq -r '.count // 0')
  if [ "$COUNT" -gt 0 ]; then
    echo "$MESSAGES" | jq -r '.messages[] | "[\(.from)] \(.content)"'
  fi
  sleep "$POLL_INTERVAL"
done
