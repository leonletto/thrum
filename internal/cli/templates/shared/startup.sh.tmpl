#!/bin/bash
# Universal Thrum agent startup script
# Auto-generated by thrum init
set -e

# Configuration (override via env vars or args)
AGENT_NAME="${THRUM_NAME:-${1:-{{.AgentName}}}}"
AGENT_ROLE="${THRUM_ROLE:-${2:-{{.AgentRole}}}}"
AGENT_MODULE="${THRUM_MODULE:-${3:-{{.AgentModule}}}}"
AGENT_INTENT="${THRUM_INTENT:-General agent work}"

# 1. Ensure daemon is running
if ! thrum daemon status &>/dev/null; then
  thrum daemon start
fi

# 2. Register agent (idempotent)
thrum quickstart \
  --name "$AGENT_NAME" \
  --role "$AGENT_ROLE" \
  --module "$AGENT_MODULE" \
  --intent "$AGENT_INTENT" \
  --json

# 3. Check inbox and output context
thrum inbox --unread --json

# 4. Optional: Announce presence
if [ "${THRUM_ANNOUNCE:-false}" = "true" ]; then
  thrum send "Agent $AGENT_NAME online" --broadcast --priority low --json
fi
