<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Context Management — Thrum</title>
  <meta name="description" content="Per-agent context storage for persisting volatile project state across sessions and machines">
  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="Agent Context Management — Thrum">
  <meta property="og:description" content="Per-agent context storage for persisting volatile project state across sessions and machines">
  <meta property="og:url" content="https://leonletto.github.io/thrum/docs/context.html">
  <meta property="og:site_name" content="Thrum">
  <meta property="og:image" content="https://leonletto.github.io/thrum/img/social-card.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Agent Context Management — Thrum">
  <meta name="twitter:description" content="Per-agent context storage for persisting volatile project state across sessions and machines">
  <meta name="twitter:image" content="https://leonletto.github.io/thrum/img/social-card.png">
  <!-- Canonical: SPA is the primary URL -->
  <link rel="canonical" href="https://leonletto.github.io/thrum/docs.html#context.html">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x26A1;</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/theme.css">
  <link rel="stylesheet" href="../css/docs.css">
  <script>
    (function(){var t=localStorage.getItem('thrum-theme');if(t){document.documentElement.setAttribute('data-theme',t)}else if(window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches){document.documentElement.setAttribute('data-theme','light')}else{document.documentElement.setAttribute('data-theme','dark')}})();
  </script>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <nav class="header-nav">
        <a href="../index.html" class="logo">
          <span class="logo-glyph">&gt;_</span>
          <span class="logo-text">thrum</span>
        </a>
        <div class="nav-links">
          <a href="../index.html" class="nav-link">Home</a>
          <a href="../docs.html" class="nav-link nav-link-active">Docs</a>
          <a href="../about.html" class="nav-link">About</a>
          <a href="https://github.com/leonletto/thrum" class="nav-link nav-link-external" target="_blank" rel="noopener">GitHub</a>
        </div>
      </nav>
    </div>
  </header>
  <main class="docs-content" style="max-width:48rem;margin:2rem auto;padding:0 1.5rem">
    <div class="docs-content-inner">
<h1>Agent Context Management</h1>
<h2>Overview</h2>
<p>Agents lose state between sessions due to context window compaction, session resets, or switching machines. The context system preserves volatile session state so agents can pick up where they left off.</p>
<p><strong>Why this exists:</strong> When an agent session ends (context compacted, Claude Code restarted, new worktree), the work-in-progress state vanishes. Context files capture that state so the next session can continue seamlessly.</p>
<p><strong>Primary use case:</strong> The <code>/update-context</code> skill in Claude Code uses this system to save session summaries before compaction or session end.</p>
<p><strong>Storage:</strong> Context files live in <code>.thrum/context/</code> (gitignored by default). Each agent gets two files:</p>
<ul>
<li><code>.thrum/context/{name}.md</code> - Volatile session state (updated frequently)</li>
<li><code>.thrum/context/{name}_preamble.md</code> - Stable reference (rarely changes)</li>
</ul>
<h2>Context Files</h2>
<p>Context files hold volatile session state that doesn&#39;t belong in git commits but needs to survive session boundaries.</p>
<p><strong>What to put in context:</strong></p>
<ul>
<li>Current task and progress</li>
<li>Architectural decisions under consideration</li>
<li>Partial investigation results</li>
<li>Discovered patterns or anti-patterns</li>
<li>TODOs or questions for the next session</li>
<li>Work-in-progress findings</li>
</ul>
<p><strong>What NOT to put in context:</strong></p>
<ul>
<li>Permanent documentation (use git-tracked docs)</li>
<li>Message-based coordination (use <code>thrum send</code>)</li>
<li>Code or configuration (use proper git-tracked files)</li>
</ul>
<p><strong>Location:</strong></p>
<pre><code>.thrum/
├── context/
│   ├── furiosa.md                  # Agent context (volatile)
│   ├── furiosa_preamble.md         # Agent preamble (stable)
│   ├── maximus.md
│   ├── maximus_preamble.md
│   └── coordinator_1B9K33T6RK.md   # Hash-based agent ID</code></pre>
<p>Context files are local by default. Use <code>thrum context sync</code> to manually share across worktrees via the a-sync branch.</p>
<h2>Preamble</h2>
<p>Each agent can have a preamble - a stable, user-editable header stored at <code>.thrum/context/{agent}_preamble.md</code>. The preamble is automatically prepended when showing context, providing a persistent reference that survives context saves.</p>
<p><strong>Default preamble:</strong> When you run <code>thrum quickstart</code>, a default preamble is created automatically with thrum quick-reference commands.</p>
<p><strong>User-editable:</strong> The preamble is just a markdown file. You can edit it directly or replace it with <code>thrum context preamble --file custom.md</code>.</p>
<p><strong>Key properties:</strong></p>
<ul>
<li>Not touched by <code>thrum context save</code> - the preamble persists across saves</li>
<li>Auto-created on first quickstart with default thrum quick-reference</li>
<li>Not removed by <code>thrum context clear</code> - clear only removes session context</li>
<li>Removed on agent delete - cleaned up alongside context</li>
</ul>
<p><strong>Default content:</strong></p>
<pre><code class="language-markdown hljs"><span class="hljs-section">## Thrum Quick Reference</span>

<span class="hljs-strong">**Check messages:**</span> <span class="hljs-code">`thrum inbox --unread`</span>
<span class="hljs-strong">**Send message:**</span> <span class="hljs-code">`thrum send &quot;message&quot; --to @role`</span>
<span class="hljs-strong">**Reply:**</span> <span class="hljs-code">`thrum reply &lt;MSG_ID&gt; &quot;response&quot;`</span>
<span class="hljs-strong">**Status:**</span> <span class="hljs-code">`thrum status`</span>
<span class="hljs-strong">**Who&#x27;s online:**</span> <span class="hljs-code">`thrum agent list --context`</span>
<span class="hljs-strong">**Save context:**</span> <span class="hljs-code">`thrum context save`</span>
<span class="hljs-strong">**Wait for messages:**</span> <span class="hljs-code">`thrum wait --all --after -30s --timeout 5m`</span></code></pre>
<p><strong>Customization examples:</strong></p>
<p>You can edit the preamble to add project conventions, role-specific instructions, team rosters, or boot sequences:</p>
<pre><code class="language-bash hljs"><span class="hljs-comment"># Edit the preamble directly</span>
vim .thrum/context/furiosa_preamble.md

<span class="hljs-comment"># Or replace it from a file</span>
<span class="hljs-built_in">cat</span> &gt; my-preamble.md &lt;&lt;<span class="hljs-string">&#x27;EOF&#x27;</span>
<span class="hljs-comment">## Project Conventions</span>

**Architecture:** Hexagonal (ports/adapters)
**Testing:** Always run `make <span class="hljs-built_in">test</span>` before committing
**Commits:** Follow Conventional Commits (feat:, fix:, docs:)

<span class="hljs-comment">## Thrum Quick Reference</span>
... (default commands) ...
EOF

thrum context preamble --file my-preamble.md</code></pre>
<h2>CLI Commands</h2>
<h3>thrum context save</h3>
<p>Save context content from a file or stdin.</p>
<pre><code class="language-bash hljs">thrum context save [flags]</code></pre>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><code>--file</code></td>
<td>Path to markdown file to save as context</td>
<td></td>
</tr>
<tr>
<td><code>--agent</code></td>
<td>Override agent name (defaults to current identity)</td>
<td></td>
</tr>
</tbody></table>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash hljs"><span class="hljs-comment"># Save from a file</span>
thrum context save --file notes.md

<span class="hljs-comment"># Save from stdin</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Working on auth module&quot;</span> | thrum context save

<span class="hljs-comment"># Save for a different agent</span>
thrum context save --agent coordinator --file notes.md</code></pre>
<hr>
<h3>thrum context show</h3>
<p>Display the saved context for the current agent.</p>
<pre><code class="language-bash hljs">thrum context show [flags]</code></pre>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><code>--agent</code></td>
<td>Override agent name (defaults to current identity)</td>
<td></td>
</tr>
<tr>
<td><code>--raw</code></td>
<td>No header, file boundary markers for piping</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>--no-preamble</code></td>
<td>Exclude preamble from output</td>
<td><code>false</code></td>
</tr>
</tbody></table>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash hljs"><span class="hljs-comment"># Show preamble + context (default)</span>
thrum context show

<span class="hljs-comment"># Show context for a different agent</span>
thrum context show --agent furiosa

<span class="hljs-comment"># Raw output with file boundary markers</span>
thrum context show --raw

<span class="hljs-comment"># Context only, no preamble</span>
thrum context show --no-preamble</code></pre>
<p><strong>Output modes:</strong></p>
<p>Default (preamble + context with header):</p>
<pre><code># Context for furiosa (1234 bytes, updated 2026-02-11T10:00:00Z)

## Thrum Quick Reference
...

# Current Work
- Implementing JWT token refresh</code></pre>
<p>Raw (<code>--raw</code>, shows file boundaries):</p>
<pre><code>&lt;!-- preamble: .thrum/context/furiosa_preamble.md --&gt;
## Thrum Quick Reference
...
&lt;!-- end preamble --&gt;

# Current Work
- Implementing JWT token refresh</code></pre>
<hr>
<h3>thrum context clear</h3>
<p>Remove the context file for the current agent.</p>
<pre><code class="language-bash hljs">thrum context clear [flags]</code></pre>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><code>--agent</code></td>
<td>Override agent name (defaults to current identity)</td>
<td></td>
</tr>
</tbody></table>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash hljs"><span class="hljs-comment"># Clear context for current agent</span>
thrum context clear

<span class="hljs-comment"># Clear context for a different agent</span>
thrum context clear --agent furiosa</code></pre>
<p>Note: Idempotent - running clear when no context exists is a no-op.</p>
<hr>
<h3>thrum context sync</h3>
<p>Copy the context file to the a-sync branch for sharing across worktrees and machines.</p>
<pre><code class="language-bash hljs">thrum context <span class="hljs-built_in">sync</span> [flags]</code></pre>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><code>--agent</code></td>
<td>Override agent name (defaults to current identity)</td>
<td></td>
</tr>
</tbody></table>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash hljs"><span class="hljs-comment"># Sync context for current agent</span>
thrum context <span class="hljs-built_in">sync</span>

<span class="hljs-comment"># Sync context for a different agent</span>
thrum context <span class="hljs-built_in">sync</span> --agent furiosa</code></pre>
<p><strong>What it does:</strong></p>
<ol>
<li>Copies <code>.thrum/context/{agent}.md</code> to the sync worktree at <code>.git/thrum-sync/a-sync/context/{agent}.md</code></li>
<li>Commits the change with message <code>&quot;context: update {agent}&quot;</code></li>
<li>Pushes to the remote a-sync branch</li>
</ol>
<p><strong>Notes:</strong></p>
<ul>
<li>No-op when no remote is configured (local-only mode)</li>
<li>Respects the <code>--local</code> daemon flag</li>
<li>Manual only - context is never synced automatically</li>
</ul>
<hr>
<h3>thrum context preamble</h3>
<p>Show or manage the preamble for the current agent.</p>
<pre><code class="language-bash hljs">thrum context preamble [flags]</code></pre>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><code>--agent</code></td>
<td>Override agent name (defaults to current identity)</td>
<td></td>
</tr>
<tr>
<td><code>--init</code></td>
<td>Create or reset to default preamble</td>
<td></td>
</tr>
<tr>
<td><code>--file</code></td>
<td>Set preamble from file</td>
<td></td>
</tr>
</tbody></table>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash hljs"><span class="hljs-comment"># Show current preamble</span>
thrum context preamble

<span class="hljs-comment"># Create/reset to default preamble</span>
thrum context preamble --init

<span class="hljs-comment"># Set preamble from a custom file</span>
thrum context preamble --file my-preamble.md

<span class="hljs-comment"># Show preamble for a different agent</span>
thrum context preamble --agent furiosa</code></pre>
<hr>
<h3>thrum context update</h3>
<p>Install or update the <code>/update-context</code> skill for Claude Code agents.</p>
<pre><code class="language-bash hljs">thrum context update</code></pre>
<p><strong>What it does:</strong></p>
<p>Detects the <code>/update-context</code> skill in these locations (in priority order):</p>
<ol>
<li><strong>Project-level</strong>: <code>.claude/commands/update-context.md</code> (relative to repo root)</li>
<li><strong>Global</strong>: <code>~/.claude/commands/update-context.md</code></li>
</ol>
<p>If the skill is found, prints its location and status. If not found, provides installation instructions.</p>
<hr>
<h2>The /update-context Skill</h2>
<p>The <code>/update-context</code> skill is a Claude Code command that provides a guided workflow for updating agent context. It prompts for continuation context, formats it as markdown, and saves it via <code>thrum context save</code>.</p>
<p><strong>Installation:</strong></p>
<ol>
<li>Create <code>.claude/commands/update-context.md</code> in your repo or globally at <code>~/.claude/commands/update-context.md</code></li>
<li>Restart Claude Code</li>
<li>Use <code>/update-context</code> from the chat to invoke the skill</li>
</ol>
<p><strong>Workflow:</strong></p>
<ol>
<li>Skill prompts: &quot;What context should I preserve for the next session?&quot;</li>
<li>You provide notes, decisions, TODOs, or findings</li>
<li>Skill formats your input as markdown and saves it via <code>thrum context save --file /tmp/context.md</code></li>
</ol>
<p><strong>Example:</strong></p>
<pre><code>User: /update-context
Agent: What context should I preserve for the next session?
User: We&#39;re refactoring the auth module. Decided to use JWT with
      refresh tokens. Need to add rate limiting tests.
Agent: [Saves formatted context]
      ✓ Context saved (248 bytes)</code></pre>
<p>The skill reduces the friction of updating context and ensures consistent formatting.</p>
<hr>
<h2>Use Cases and Patterns</h2>
<h3>Single-Agent Session Continuity</h3>
<pre><code class="language-bash hljs"><span class="hljs-comment"># At the end of a work session</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;# Next Steps
- Finish JWT implementation
- Add rate limiting tests
- Review security considerations&quot;</span> | thrum context save

<span class="hljs-comment"># Next session</span>
thrum context show</code></pre>
<h3>Multi-Agent Handoff</h3>
<pre><code class="language-bash hljs"><span class="hljs-comment"># Agent A saves context before handing off</span>
thrum context save --file handoff-notes.md
thrum context <span class="hljs-built_in">sync</span>  <span class="hljs-comment"># Share across worktrees</span>

<span class="hljs-comment"># Agent B (in another worktree) pulls and reads</span>
git fetch origin
thrum context show --agent furiosa</code></pre>
<h3>Context Updates at Decision Points</h3>
<p>Save context when you make a significant decision, discover something important, or reach a natural breakpoint:</p>
<pre><code class="language-bash hljs"><span class="hljs-comment"># After architectural decision</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;# Decision: Using JWT with refresh tokens
- Token expiry: 15 min (access), 7 days (refresh)
- Storage: Redis for refresh tokens
- Rate limit: 100 req/min per IP&quot;</span> | thrum context save</code></pre>
<h3>Integration with thrum status</h3>
<p>The <code>thrum status</code> command shows context file size and age when context exists:</p>
<pre><code class="language-bash hljs">$ thrum status
Agent:    furiosa (@implementer)
Module:   auth
Session:  ses_01HXF2A9... (active 2h15m)
Intent:   Implementing JWT refresh
Context:  1.2 KB (updated 5m ago)    <span class="hljs-comment"># ← Context indicator</span>
Inbox:    3 unread (12 total)</code></pre>
<hr>
<h2>RPC API</h2>
<p>Context operations are available via the daemon&#39;s RPC API:</p>
<h3>context.save</h3>
<p><strong>Request:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;context.save&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;base64-encoded-content&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Context saved for furiosa (248 bytes)&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<hr>
<h3>context.show</h3>
<p><strong>Request:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;context.show&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;include_preamble&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p>The <code>include_preamble</code> field is optional and defaults to <code>true</code> when omitted.</p>
<p><strong>Response:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;preamble&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;base64-encoded-preamble&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;base64-encoded-content&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;has_context&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;has_preamble&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;preamble_size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">256</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1234</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;updated_at&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2026-02-11T10:00:00Z&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<hr>
<h3>context.preamble.show</h3>
<p><strong>Request:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;context.preamble.show&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;base64-encoded-preamble&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;has_preamble&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<hr>
<h3>context.preamble.save</h3>
<p><strong>Request:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;context.preamble.save&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;base64-encoded-content&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Preamble saved for furiosa (256 bytes)&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<hr>
<h3>context.clear</h3>
<p><strong>Request:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;context.clear&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<p><strong>Response:</strong></p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;agent_name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;furiosa&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Context cleared for furiosa&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre>
<hr>
<h2>Implementation Notes</h2>
<h3>Locking Strategy</h3>
<p>Context RPC handlers follow the daemon&#39;s standard locking patterns:</p>
<ul>
<li><code>context.save</code> and <code>context.clear</code> acquire a write lock (<code>Lock()</code>)</li>
<li><code>context.show</code> acquires a read lock (<code>RLock()</code>)</li>
</ul>
<p>This ensures thread-safe access when multiple clients interact with context files.</p>
<h3>File Format</h3>
<p>Context files are plain markdown (<code>.md</code>). No special format or structure is enforced - agents are free to use any markdown convention that suits their workflow.</p>
<p><strong>Common patterns:</strong></p>
<ul>
<li>Heading-based sections (<code># Next Steps</code>, <code># Decisions</code>, <code># Questions</code>)</li>
<li>Bulleted lists for TODOs</li>
<li>Code blocks for snippets or commands</li>
<li>Fenced blocks for structured data (JSON, YAML)</li>
</ul>
<h3>Sync Workflow (Manual Only)</h3>
<p>Context sync is manual-only to avoid noise and respect agent autonomy:</p>
<ul>
<li>The daemon never auto-syncs context files</li>
<li>Agents must explicitly run <code>thrum context sync</code> to share</li>
<li>Sync respects local-only mode (no-op when <code>--local</code> is set on the daemon)</li>
</ul>
<p><strong>Rationale:</strong> Context is volatile and session-specific. Auto-syncing would create unnecessary churn. Manual sync gives agents control over when and what to share.</p>
<hr>
<h2>Best Practices</h2>
<h3>Keep Context Concise</h3>
<p>Context files should be high-signal summaries, not exhaustive logs. Prefer bullet points over paragraphs.</p>
<p><strong>Good:</strong></p>
<pre><code class="language-markdown hljs"><span class="hljs-section"># Next Steps</span>

<span class="hljs-bullet">-</span> Finish JWT implementation (see src/auth/jwt.go)
<span class="hljs-bullet">-</span> Add rate limiting (decided on 100 req/min per IP)
<span class="hljs-bullet">-</span> Review security: check token expiry edge cases</code></pre>
<p><strong>Bad:</strong></p>
<pre><code class="language-markdown hljs"><span class="hljs-section"># What I Did Today</span>

I started by looking at the auth module and then I realized that we need JWT so
I implemented a basic version but it&#x27;s not complete yet and I still need to add
rate limiting which I discussed with the team and we decided on 100 requests per
minute...</code></pre>
<h3>Update Context at Decision Points</h3>
<p>Save context when you make a significant decision, discover something important, or reach a natural breakpoint.</p>
<p><strong>When to update:</strong></p>
<ul>
<li>After choosing between architectural alternatives</li>
<li>When discovering a bug or anti-pattern</li>
<li>Before switching to a different task</li>
<li>At the end of a work session</li>
</ul>
<h3>Use the /update-context Skill</h3>
<p>The skill provides a consistent, low-friction workflow for updating context. Install it and use it regularly.</p>
<h3>Sync Selectively</h3>
<p>Only sync context that is useful to other agents or future sessions on different machines. Local notes and WIP context can stay local.</p>
<hr>
<h2>See Also</h2>
<ul>
<li><a href="identity.html">Identity System</a> - Agent identity and registration</li>
<li><a href="cli.html">CLI Reference</a> - All CLI commands</li>
<li><a href="rpc-api.html">RPC API Reference</a> - Complete RPC method documentation</li>
<li><a href="agent-coordination.html">Agent Coordination</a> - Multi-agent workflows</li>
</ul>

    </div>
    <p style="margin-top:2rem"><a href="../docs.html#context.html">&larr; View in documentation</a></p>
  </main>
  <script>
    // Redirect browsers to the SPA for full navigation experience.
    // Crawlers (which don't execute JS) will index the static content above.
    if (window.location.search.indexOf('nospa') === -1) {
      window.location.replace('../docs.html#context.html');
    }
  </script>
</body>
</html>