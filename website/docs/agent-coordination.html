<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent Coordination — Thrum</title>
<meta name="description" content="Multi-agent workflows, Beads integration, session templates, and coordination patterns for AI agent teams">
<link rel="canonical" href="https://leonletto.github.io/thrum/docs.html#agent-coordination.html">
<style>
body{font-family:system-ui,sans-serif;max-width:48rem;margin:2rem auto;padding:0 1.5rem;line-height:1.6;color:#222}
pre{background:#f5f5f5;padding:1rem;overflow-x:auto;border-radius:4px}
code{font-family:ui-monospace,monospace;font-size:0.9em}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #ddd;padding:0.4rem 0.6rem;text-align:left}
th{background:#f5f5f5}
nav{margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid #ddd;line-height:1.8}
h2{margin-top:2rem}
a{color:#0366d6}
</style>
</head>
<body>
<nav>
<strong><a href="../docs.html">Thrum Docs</a></strong> &rsaquo; Guides &rsaquo; Agent Coordination
<hr>
<strong>Overview</strong>: <a href="philosophy.html">Philosophy</a><br>
<strong>Getting Started</strong>: <a href="quickstart.html">Quickstart Guide</a><br>
  <strong>Recommended Tools</strong>: <a href="guides/recommended-tools.html">Recommended Tools</a> | <a href="guides/beads-setup.html">Beads Setup Guide</a> | <a href="guides/beads-ui-setup.html">Beads UI Setup Guide</a> | <a href="guides/playwright-cli-setup.html">Playwright CLI Setup Guide</a><br>
<strong>Web UI</strong>: <a href="web-ui.html">Web UI</a><br>
<strong>Messaging</strong>: <a href="subscriptions.html">Subscriptions & Notifications</a><br>
<strong>Identity</strong>: <a href="identity.html">Agent Identity & Registration</a><br>
<strong>Guides</strong>: <strong>Agent Coordination</strong> | <a href="agent-configs.html">Agent Configurations</a> | <a href="multi-agent.html">Multi-Agent Support</a> | <a href="claude-code-plugin.html">Claude Code Plugin</a> | <a href="configuration.html">Configuration</a> | <a href="workflow-templates.html">Workflow Templates</a> | <a href="beads-and-thrum.html">Beads and Thrum</a> | <a href="codex-plugin.html">Codex Plugin</a> | <a href="claude-agent-integration.html">Claude Code Agent Integration</a> | <a href="messaging.html">Messaging</a> | <a href="tailscale-sync.html">Tailscale Sync</a> | <a href="tailscale-security.html">Tailscale Sync Security</a> | <a href="overview.html">Technical Overview</a><br>
<strong>API Reference</strong>: <a href="event-streaming.html">Event Streaming</a> | <a href="inbox-query-methods.html">Inbox Query Methods</a> | <a href="api/authentication.html">Authentication</a> | <a href="api/events.html">Event Reference</a> | <a href="rpc-api.html">RPC API</a> | <a href="api/websocket.html">WebSocket API</a><br>
<strong>Daemon</strong>: <a href="daemon.html">Daemon Architecture</a><br>
<strong>Sync</strong>: <a href="sync.html">Sync Protocol</a><br>
<strong>Development</strong>: <a href="development.html">Development Guide</a> | <a href="security-cicd.html">Security & CI/CD</a><br>
<strong>Architecture</strong>: <a href="architecture.html">Architecture</a><br>
<strong>Context</strong>: <a href="context.html">Agent Context Management</a><br>
<strong>Reference</strong>: <a href="cli.html">CLI Reference</a> | <a href="mcp-server.html">MCP Server</a><br>
<strong>uncategorized</strong>: <a href="role-templates.html">Role-Based Preamble Templates</a><br>
</nav>
<main>
<h2>Agent Coordination</h2>
<p>Thrum helps you coordinate multiple AI agents across sessions, worktrees, and
machines. This guide covers practical coordination patterns, integration with
the Beads issue tracker, and session workflow templates.</p>
<blockquote>
<p>For the philosophy behind this approach — why you direct the work instead of
handing it off — see <a href="philosophy.html">Why Thrum Exists</a>.</p>
</blockquote>
<h2>Coordination Methods</h2>
<p>Thrum supports two integration methods for agent coordination:</p>
<h3>MCP Server (Recommended)</h3>
<p>Native tool integration with async message notifications. Best for Claude Code
agents. See <a href="/docs/mcp-server.html">MCP Server</a> for configuration and the
complete tools reference.</p>
<h3>CLI (Fallback)</h3>
<p>Shell commands for basic messaging. Works everywhere.</p>
<pre><code>thrum send &quot;Starting work on task X&quot; --to @coord_main
thrum inbox --unread
thrum reply &lt;msg-id&gt; &quot;Here&#39;s my update&quot;</code></pre>
<blockquote>
<p><strong>Note:</strong> Use agent names (e.g., <code>@coord_main</code>), not role names (e.g.,
<code>@coordinator</code>). Sending to a role fans out to ALL agents with that role.
Run <code>thrum team</code> to see agent names.</p>
</blockquote>
<h2>Common Workflows</h2>
<h3>Planner-Implementer Coordination</h3>
<p>The most common pattern: a planner agent assigns work and an implementer
executes it.</p>
<p><strong>Planner:</strong></p>
<pre><code># Register as planner
thrum quickstart --name planner1 --role planner --module website \
  --intent &quot;Coordinating website development&quot;

# Assign task via message (use agent name, not role)
thrum send &quot;Please implement build script (task thrum-235d.3). \
  Design spec in dev-docs/plans/. Check beads for details.&quot; \
  --to @impl1

# Check for updates
thrum inbox</code></pre>
<p><strong>Implementer:</strong></p>
<pre><code># Register
thrum quickstart --name impl1 --role implementer --module website \
  --intent &quot;Implementing website features&quot;

# Check inbox for assignments
thrum inbox --unread

# Acknowledge and work
thrum reply &lt;msg-id&gt; &quot;Claimed task. Starting implementation.&quot;

# Send completion update (use agent name from thrum team)
thrum send &quot;Build script complete. Tests passing. Ready for review.&quot; \
  --to @planner1</code></pre>
<h3>Peer Collaboration</h3>
<p>Agents working on related areas coordinate to avoid conflicts.</p>
<pre><code># Agent A: Announce work area
thrum send &quot;Starting work on auth module&quot; --to @everyone

# Agent B: Check file ownership before editing
thrum who-has src/auth/login.ts
# Output: @agent_a is editing src/auth/login.ts

# Agent B: Coordinate via message
thrum send &quot;Need to edit login.ts for validation. ETA?&quot; --to @agent_a</code></pre>
<h3>Code Review</h3>
<p>Request and respond to code reviews via messaging.</p>
<p><strong>Implementer:</strong></p>
<pre><code>thrum send &quot;Build script complete (commit abc123). Please review:
- Markdown processing
- Search index generation
- Error handling

Tests passing. Beads task: thrum-235d.3&quot; --to @reviewer</code></pre>
<p><strong>Reviewer:</strong></p>
<pre><code># Check inbox
thrum inbox --unread

# Review the code, then respond
thrum reply &lt;msg-id&gt; &quot;Reviewed. Found 2 issues:
1. Missing error handling in parseMarkdown()
2. Search index doesn&#39;t handle compound terms

See beads: thrum-abc (bug filed). Otherwise looks good.&quot;</code></pre>
<h3>Multi-Worktree Coordination</h3>
<p>Agents in different git worktrees share the same daemon and message store.</p>
<p><strong>Agent in main worktree:</strong></p>
<pre><code>cd /path/to/repo
export THRUM_NAME=main_agent
thrum quickstart --name main_agent --role coordinator --module main \
  --intent &quot;Main branch coordination&quot;

thrum send &quot;Feature branch ready for integration testing&quot; --to @feature_agent</code></pre>
<p><strong>Agent in feature worktree:</strong></p>
<pre><code>cd ~/.workspaces/repo/feature
thrum setup --main-repo /path/to/repo
export THRUM_NAME=feature_agent
thrum quickstart --name feature_agent --role implementer --module feature \
  --intent &quot;Feature implementation&quot;

# Check inbox (sees messages from main_agent)
thrum inbox</code></pre>
<h2>Message-Listener Pattern</h2>
<p>For async message handling, spawn a background sub-agent that listens for
incoming messages and notifies the main agent when they arrive.</p>
<h3>How It Works</h3>
<ol>
<li>The main agent spawns a message-listener as a background task</li>
<li>The listener uses <code>thrum wait</code> (blocks until message arrives or timeout)</li>
<li>When a message arrives, the listener returns immediately with the message
content</li>
<li>The main agent processes the message and re-arms the listener</li>
</ol>
<p><strong>Recommended approach:</strong> Use <code>thrum wait</code> which blocks until a message arrives
or times out. This is more efficient than polling loops with sleep intervals.
Use <code>--after -30s</code> to include messages sent up to 30 seconds ago (<code>--after</code> negative value = &quot;N ago&quot;). Omit <code>--after</code> to receive only messages that arrive after the wait starts.</p>
<h3>Return Format</h3>
<p>When messages are received:</p>
<pre><code>MESSAGES_RECEIVED
---
FROM: [sender]
CONTENT: [message content]
TIMESTAMP: [timestamp]
---</code></pre>
<p>When timeout occurs with no messages:</p>
<pre><code>NO_MESSAGES_TIMEOUT</code></pre>
<h3>Context Management</h3>
<ul>
<li>Re-arm the listener after processing messages (the listener exits after
returning)</li>
<li>After 5 consecutive timeouts with no pending work, send status to the
coordinator and stop the listener</li>
<li>The listener is read-only; it never sends messages</li>
</ul>
<h2>Beads Integration</h2>
<p>When both Thrum and <a href="https://github.com/leonletto/thrum">Beads</a> are available,
use them together for full coordination:</p>
<table>
<thead>
<tr>
<th>Concern</th>
<th>Tool</th>
<th>Why</th>
</tr>
</thead>
<tbody><tr>
<td>Real-time communication</td>
<td>Thrum</td>
<td>Messages, status updates, review requests</td>
</tr>
<tr>
<td>Task management</td>
<td>Beads</td>
<td>Issues, dependencies, work discovery</td>
</tr>
<tr>
<td>Progress tracking</td>
<td>Beads</td>
<td>Status fields, close with reason</td>
</tr>
<tr>
<td>Notifications</td>
<td>Thrum</td>
<td>Alert team to progress or blockers</td>
</tr>
</tbody></table>
<h3>Unified Workflow</h3>
<pre><code># 1. Register in Thrum
thrum quickstart --name impl_auth --role implementer --module auth \
  --intent &quot;Implementing auth system&quot;

# 2. Find work in Beads
bd ready

# 3. Claim in Beads
bd update bd-123 --status in_progress

# 4. Announce via Thrum (use agent name, not role)
thrum send &quot;Starting bd-123: JWT authentication&quot; --to @coord_main

# 5. Work on implementation...

# 6. Discover issues -&gt; file in Beads
bd create --title=&quot;Found validation bug&quot; --type=bug --priority=1

# 7. Update coordinator via Thrum
thrum send &quot;Progress: JWT working, found validation bug (filed bd-456)&quot; \
  --to @coord_main

# 8. Complete in Beads
bd close bd-123 --reason=&quot;JWT auth complete with tests&quot;

# 9. Announce via Thrum
thrum send &quot;Completed bd-123. Ready for review.&quot; \
  --to @reviewer1

# 10. Sync both
bd sync
thrum sync force</code></pre>
<h3>Mapping Convention</h3>
<table>
<thead>
<tr>
<th>Concept</th>
<th>Beads</th>
<th>Thrum</th>
</tr>
</thead>
<tbody><tr>
<td>Task ID</td>
<td><code>bd-123</code></td>
<td>Include in message: &quot;Working on bd-123&quot;</td>
</tr>
<tr>
<td>Status</td>
<td><code>bd update --status</code></td>
<td>Send message with update</td>
</tr>
<tr>
<td>Assignment</td>
<td><code>bd update --assignee</code></td>
<td>Send message to specific agent</td>
</tr>
<tr>
<td>Completion</td>
<td><code>bd close</code></td>
<td>Send completion message</td>
</tr>
<tr>
<td>Discovery</td>
<td><code>bd create</code></td>
<td>Notify via message</td>
</tr>
</tbody></table>
<h2>Session Workflow Template</h2>
<p>Use this template for every agent session:</p>
<pre><code># === START OF SESSION ===

# 1. Register and start session
thrum quickstart --name &lt;name&gt; --role &lt;role&gt; --module &lt;module&gt; \
  --intent &quot;&lt;description&gt;&quot;

# 2. Check inbox for any urgent messages
thrum inbox --unread

# 3. Find work (Beads)
bd ready

# 4. Claim task (Beads)
bd update &lt;id&gt; --status in_progress

# 5. Announce start (Thrum) — use agent name from `thrum team`
thrum send &quot;Starting work on &lt;id&gt;: &lt;description&gt;&quot; --to @&lt;coordinator-name&gt;

# === DURING SESSION ===

# 6. Send periodic status updates
thrum send &quot;Progress: &lt;status&gt;&quot; --to @&lt;coordinator-name&gt;

# 7. Handle incoming messages
thrum inbox --unread

# 8. Coordinate on blockers
thrum send &quot;Blocked: &lt;description&gt;&quot; --to @&lt;coordinator-name&gt;

# === END OF SESSION ===

# 9. Complete work (Beads)
bd close &lt;id&gt; --reason &quot;Complete&quot;
bd sync

# 10. Announce completion (Thrum) — use agent name from `thrum team`
thrum send &quot;Completed &lt;id&gt;. Tests passing. Ready for review.&quot; \
  --to @&lt;reviewer-name&gt;

# 11. End session
thrum session end</code></pre>
<h2>Best Practices</h2>
<h3>Do</h3>
<ul>
<li><strong>Register at session start</strong> -- always use <code>thrum quickstart</code></li>
<li><strong>Use MCP server when available</strong> -- better than CLI polling</li>
<li><strong>Send status updates</strong> -- keep the team informed</li>
<li><strong>Use @mentions</strong> -- reference agents by name</li>
<li><strong>Include context</strong> -- Beads IDs, file paths, commit hashes</li>
<li><strong>End sessions cleanly</strong> -- run <code>thrum session end</code> when done</li>
<li><strong>Set clear intents</strong> -- describe what you&#39;re working on</li>
<li><strong>Broadcast milestones</strong> -- share important progress with the team</li>
</ul>
<h3>Don&#39;t</h3>
<ul>
<li><strong>Don&#39;t use Thrum for task management</strong> -- use Beads for that</li>
<li><strong>Don&#39;t spam messages</strong> -- batch updates when possible</li>
<li><strong>Don&#39;t forget to re-arm the listener</strong> -- after processing messages</li>
<li><strong>Don&#39;t ignore critical messages</strong> -- stop work and respond</li>
<li><strong>Don&#39;t skip registration</strong> -- the system won&#39;t route messages correctly</li>
<li><strong>Don&#39;t leave sessions open</strong> -- end them when done to avoid stale status</li>
<li><strong>Don&#39;t use vague intents</strong> -- be specific about current work</li>
</ul>
<h2>Troubleshooting</h2>
<h3>Not receiving messages</h3>
<p><strong>Diagnosis:</strong></p>
<pre><code># Check registration
thrum status

# Check daemon
thrum daemon status

# Check inbox manually
thrum inbox</code></pre>
<p><strong>Solutions:</strong></p>
<ol>
<li><strong>Not registered</strong> -- run <code>thrum quickstart</code></li>
<li><strong>Daemon not running</strong> -- run <code>thrum daemon start</code></li>
<li><strong>Wrong agent name</strong> -- check <code>THRUM_NAME</code> env var</li>
<li><strong>Sync issues</strong> -- run <code>thrum sync force</code> to pull latest messages</li>
</ol>
<h3>Messages not syncing</h3>
<p><strong>Diagnosis:</strong></p>
<pre><code># Check sync status
thrum sync status

# Check git remote
git remote -v</code></pre>
<p><strong>Solutions:</strong></p>
<ol>
<li><strong>No remote</strong> -- add a git remote</li>
<li><strong>Not committed</strong> -- daemon auto-commits after 60s, or run <code>thrum sync force</code></li>
<li><strong>Not pushed</strong> -- run <code>thrum sync force</code> to push</li>
<li><strong>Branch diverged</strong> -- pull and retry</li>
</ol>
<h3>Multiple agents with same name</h3>
<p><strong>Diagnosis:</strong></p>
<pre><code>thrum agent list</code></pre>
<p><strong>Solutions:</strong></p>
<ol>
<li><strong>Use unique names</strong> -- each agent needs a unique name</li>
<li><strong>Delete duplicates</strong> -- <code>thrum agent delete &lt;name&gt;</code></li>
<li><strong>Use THRUM_NAME</strong> -- set different names per worktree</li>
</ol>
<h3>Context recovery after compaction</h3>
<p>After conversation compaction, agents can recover context:</p>
<pre><code># Check inbox for recent messages
thrum inbox --unread

# Check what others are working on
thrum agent list --context

# Check Beads for task state
bd ready
bd list --status=in_progress</code></pre>
<h2>See Also</h2>
<ul>
<li><a href="workflow-templates.html">Workflow Templates</a> -- three-phase agent development
workflows (plan, prepare, implement)</li>
<li><a href="multi-agent.html">Multi-Agent Support</a> -- groups, runtime presets, and team
coordination</li>
<li><a href="tailscale-sync.html">Tailscale Sync</a> -- cross-machine sync via Tailscale</li>
<li><a href="cli.html">CLI Reference</a> -- complete command documentation</li>
<li><a href="mcp-server.html">MCP Server</a> -- MCP tools and message-listener details</li>
<li><a href="messaging.html">Messaging System</a> -- message structure and scopes</li>
<li><a href="quickstart.html">Quickstart Guide</a> -- getting started in 5 minutes</li>
<li><a href="identity.html">Identity System</a> -- agent names and registration</li>
</ul>
<pre><code></code></pre>

</main>
<script>if(location.search.indexOf('nospa')===-1){location.replace('../docs.html#agent-coordination.html')}</script>
</body>
</html>