<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Coordination — Thrum</title>
  <meta name="description" content="Multi-agent workflows, Beads integration, session templates, and coordination patterns for AI agent teams">
  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="Agent Coordination — Thrum">
  <meta property="og:description" content="Multi-agent workflows, Beads integration, session templates, and coordination patterns for AI agent teams">
  <meta property="og:url" content="https://leonletto.github.io/thrum/docs/agent-coordination.html">
  <meta property="og:site_name" content="Thrum">
  <meta property="og:image" content="https://leonletto.github.io/thrum/img/social-card.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Agent Coordination — Thrum">
  <meta name="twitter:description" content="Multi-agent workflows, Beads integration, session templates, and coordination patterns for AI agent teams">
  <meta name="twitter:image" content="https://leonletto.github.io/thrum/img/social-card.png">
  <!-- Canonical: SPA is the primary URL -->
  <link rel="canonical" href="https://leonletto.github.io/thrum/docs.html#agent-coordination.html">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>&#x26A1;</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/theme.css">
  <link rel="stylesheet" href="../css/docs.css">
  <script>
    (function(){var t=localStorage.getItem('thrum-theme');if(t){document.documentElement.setAttribute('data-theme',t)}else if(window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches){document.documentElement.setAttribute('data-theme','light')}else{document.documentElement.setAttribute('data-theme','dark')}})();
  </script>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <nav class="header-nav">
        <a href="../index.html" class="logo">
          <span class="logo-glyph">&gt;_</span>
          <span class="logo-text">thrum</span>
        </a>
        <div class="nav-links">
          <a href="../index.html" class="nav-link">Home</a>
          <a href="../docs.html" class="nav-link nav-link-active">Docs</a>
          <a href="../about.html" class="nav-link">About</a>
          <a href="https://github.com/leonletto/thrum" class="nav-link nav-link-external" target="_blank" rel="noopener">GitHub</a>
        </div>
      </nav>
    </div>
  </header>
  <main class="docs-content" style="max-width:48rem;margin:2rem auto;padding:0 1.5rem">
    <div class="docs-content-inner">
<h2>Agent Coordination</h2>
<p>Thrum helps you coordinate multiple AI agents across sessions, worktrees, and<br>machines. This guide covers practical coordination patterns, integration with<br>the Beads issue tracker, and session workflow templates.</p>
<blockquote>
<p>For the philosophy behind this approach — why you direct the work instead of<br>handing it off — see <a href="philosophy.html">Why Thrum Exists</a>.</p>
</blockquote>
<h2>Coordination Methods</h2>
<p>Thrum supports two integration methods for agent coordination:</p>
<h3>MCP Server (Recommended)</h3>
<p>Native tool integration with async message notifications. Best for Claude Code<br>agents.</p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;thrum&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stdio&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;thrum&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;mcp&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;serve&quot;</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
```text

MCP tools<span class="hljs-punctuation">:</span> `send_message`<span class="hljs-punctuation">,</span> `check_messages`<span class="hljs-punctuation">,</span> `wait_for_message`<span class="hljs-punctuation">,</span> `list_agents`<span class="hljs-punctuation">,</span>
`broadcast_message`.

### CLI (Fallback)

Shell commands for basic messaging. Works everywhere.

```bash
thrum send <span class="hljs-string">&quot;Starting work on task X&quot;</span> --to @coordinator
thrum inbox --unread
thrum reply &lt;msg-id&gt; <span class="hljs-string">&quot;Here&#x27;s my update&quot;</span>
```text

## Common Workflows

### Planner-Implementer Coordination

The most common pattern<span class="hljs-punctuation">:</span> a planner agent assigns work and an implementer
executes it.

**Planner<span class="hljs-punctuation">:</span>**

```bash
# Register as planner
thrum quickstart --name planner1 --role planner --module website \
  --intent <span class="hljs-string">&quot;Coordinating website development&quot;</span>

# Assign task via message
thrum send <span class="hljs-string">&quot;Please implement build script (task thrum-235d.3). \
  Design spec in docs/plans/. Check beads for details.&quot;</span> \
  --to @implementer

# Check for updates
thrum inbox
```text

**Implementer<span class="hljs-punctuation">:</span>**

```bash
# Register
thrum quickstart --name impl1 --role implementer --module website \
  --intent <span class="hljs-string">&quot;Implementing website features&quot;</span>

# Check inbox for assignments
thrum inbox --unread

# Acknowledge and work
thrum reply &lt;msg-id&gt; <span class="hljs-string">&quot;Claimed task. Starting implementation.&quot;</span>

# Send completion update
thrum send <span class="hljs-string">&quot;Build script complete. Tests passing. Ready for review.&quot;</span> \
  --to @planner
```text

### Peer Collaboration

Agents working on related areas coordinate to avoid conflicts.

```bash
# Agent A<span class="hljs-punctuation">:</span> Announce work area
thrum send <span class="hljs-string">&quot;Starting work on auth module&quot;</span> --to @everyone

# Agent B<span class="hljs-punctuation">:</span> Check file ownership before editing
thrum who-has src/auth/login.ts
# Output<span class="hljs-punctuation">:</span> @agent_a is editing src/auth/login.ts

# Agent B<span class="hljs-punctuation">:</span> Coordinate via message
thrum send <span class="hljs-string">&quot;Need to edit login.ts for validation. ETA?&quot;</span> --to @agent_a
```text

### Code Review

Request and respond to code reviews via messaging.

**Implementer<span class="hljs-punctuation">:</span>**

```bash
thrum send <span class="hljs-string">&quot;Build script complete (commit abc123). Please review:
- Markdown processing
- Search index generation
- Error handling

Tests passing. Beads task: thrum-235d.3&quot;</span> --to @reviewer
```text

**Reviewer<span class="hljs-punctuation">:</span>**

```bash
# Check inbox
thrum inbox --unread

# Review the code<span class="hljs-punctuation">,</span> then respond
thrum reply &lt;msg-id&gt; <span class="hljs-string">&quot;Reviewed. Found 2 issues:
1. Missing error handling in parseMarkdown()
2. Search index doesn&#x27;t handle compound terms

See beads: thrum-abc (bug filed). Otherwise looks good.&quot;</span>
```text

### Multi-Worktree Coordination

Agents in different git worktrees share the same daemon and message store.

**Agent in main worktree<span class="hljs-punctuation">:</span>**

```bash
cd /path/to/repo
export THRUM_NAME=main_agent
thrum quickstart --name main_agent --role coordinator --module main \
  --intent <span class="hljs-string">&quot;Main branch coordination&quot;</span>

thrum send <span class="hljs-string">&quot;Feature branch ready for integration testing&quot;</span> --to @feature_agent
```text

**Agent in feature worktree<span class="hljs-punctuation">:</span>**

```bash
cd ~/.workspaces/repo/feature
thrum setup --main-repo /path/to/repo
export THRUM_NAME=feature_agent
thrum quickstart --name feature_agent --role implementer --module feature \
  --intent <span class="hljs-string">&quot;Feature implementation&quot;</span>

# Check inbox (sees messages from main_agent)
thrum inbox
```text

## Message-Listener Pattern

For async message handling<span class="hljs-punctuation">,</span> spawn a background sub-agent that listens for
incoming messages and notifies the main agent when they arrive.

### How It Works

<span class="hljs-number">1.</span> The main agent spawns a message-listener as a background task
<span class="hljs-number">2.</span> The listener uses `thrum wait` (blocks until message arrives or timeout)
<span class="hljs-number">3.</span> When a message arrives<span class="hljs-punctuation">,</span> the listener returns immediately with the message
   content
<span class="hljs-number">4.</span> The main agent processes the message and re-arms the listener

**Recommended approach<span class="hljs-punctuation">:</span>** Use `thrum wait` which blocks until a message arrives
or times out. This is more efficient than polling loops with sleep intervals.
Use `--after <span class="hljs-number">-30</span>s` to skip old messages<span class="hljs-punctuation">,</span> returning only recent/new ones.

### Return Format

When messages are received<span class="hljs-punctuation">:</span>

```text
MESSAGES_RECEIVED
---
FROM<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>sender<span class="hljs-punctuation">]</span>
CONTENT<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>message content<span class="hljs-punctuation">]</span>
TIMESTAMP<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>timestamp<span class="hljs-punctuation">]</span>
---
```text

When timeout occurs with no messages<span class="hljs-punctuation">:</span>

```text
NO_MESSAGES_TIMEOUT
```go

### Context Management

- Re-arm the listener after processing messages (the listener exits after
  returning)
- After <span class="hljs-number">5</span> consecutive timeouts with no pending work<span class="hljs-punctuation">,</span> send status to the
  coordinator and stop the listener
- The listener is read-only; it never sends messages

## Beads Integration

When both Thrum and <span class="hljs-punctuation">[</span>Beads<span class="hljs-punctuation">]</span>(https<span class="hljs-punctuation">:</span><span class="hljs-comment">//github.com/leonletto/thrum) are available,</span>
use them together for full coordination<span class="hljs-punctuation">:</span>

| Concern                 | Tool  | Why                                       |
| ----------------------- | ----- | ----------------------------------------- |
| Real-time communication | Thrum | Messages<span class="hljs-punctuation">,</span> status updates<span class="hljs-punctuation">,</span> review requests |
| Task management         | Beads | Issues<span class="hljs-punctuation">,</span> dependencies<span class="hljs-punctuation">,</span> work discovery      |
| Progress tracking       | Beads | Status fields<span class="hljs-punctuation">,</span> close with reason          |
| Notifications           | Thrum | Alert team to progress or blockers        |

### Unified Workflow

```bash
# <span class="hljs-number">1.</span> Register in Thrum
thrum quickstart --name impl_auth --role implementer --module auth \
  --intent <span class="hljs-string">&quot;Implementing auth system&quot;</span>

# <span class="hljs-number">2.</span> Find work in Beads
bd ready

# <span class="hljs-number">3.</span> Claim in Beads
bd update bd<span class="hljs-number">-123</span> --status in_progress

# <span class="hljs-number">4.</span> Announce via Thrum
thrum send <span class="hljs-string">&quot;Starting bd-123: JWT authentication&quot;</span> --to @coordinator

# <span class="hljs-number">5.</span> Work on implementation...

# <span class="hljs-number">6.</span> Discover issues -&gt; file in Beads
bd create --title=<span class="hljs-string">&quot;Found validation bug&quot;</span> --type=bug --priority=<span class="hljs-number">1</span>

# <span class="hljs-number">7.</span> Update coordinator via Thrum
thrum send <span class="hljs-string">&quot;Progress: JWT working, found validation bug (filed bd-456)&quot;</span> \
  --to @coordinator

# <span class="hljs-number">8.</span> Complete in Beads
bd close bd<span class="hljs-number">-123</span> --reason=<span class="hljs-string">&quot;JWT auth complete with tests&quot;</span>

# <span class="hljs-number">9.</span> Announce via Thrum
thrum send <span class="hljs-string">&quot;Completed bd-123. Ready for review.&quot;</span> \
  --to @reviewer

# <span class="hljs-number">10.</span> Sync both
bd sync
thrum sync force
```text

### Mapping Convention

| Concept    | Beads                  | Thrum                                   |
| ---------- | ---------------------- | --------------------------------------- |
| Task ID    | `bd<span class="hljs-number">-123</span>`               | Include in message<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Working on bd-123&quot;</span> |
| Status     | `bd update --status`   | Send message with update                |
| Assignment | `bd update --assignee` | Send message to specific agent          |
| Completion | `bd close`             | Send completion message                 |
| Discovery  | `bd create`            | Notify via message                      |

## Session Workflow Template

Use this template for every agent session<span class="hljs-punctuation">:</span>

```bash
# === START OF SESSION ===

# <span class="hljs-number">1.</span> Register and start session
thrum quickstart --name &lt;name&gt; --role &lt;role&gt; --module &lt;module&gt; \
  --intent <span class="hljs-string">&quot;&lt;description&gt;&quot;</span>

# <span class="hljs-number">2.</span> Check inbox for any urgent messages
thrum inbox --unread

# <span class="hljs-number">3.</span> Find work (Beads)
bd ready

# <span class="hljs-number">4.</span> Claim task (Beads)
bd update &lt;id&gt; --status in_progress

# <span class="hljs-number">5.</span> Announce start (Thrum)
thrum send <span class="hljs-string">&quot;Starting work on &lt;id&gt;: &lt;description&gt;&quot;</span> --to @coordinator

# === DURING SESSION ===

# <span class="hljs-number">6.</span> Send periodic status updates
thrum send <span class="hljs-string">&quot;Progress: &lt;status&gt;&quot;</span> --to @coordinator

# <span class="hljs-number">7.</span> Handle incoming messages
thrum inbox --unread

# <span class="hljs-number">8.</span> Coordinate on blockers
thrum send <span class="hljs-string">&quot;Blocked: &lt;description&gt;&quot;</span> --to @coordinator

# === END OF SESSION ===

# <span class="hljs-number">9.</span> Complete work (Beads)
bd close &lt;id&gt; --reason <span class="hljs-string">&quot;Complete&quot;</span>
bd sync

# <span class="hljs-number">10.</span> Announce completion (Thrum)
thrum send <span class="hljs-string">&quot;Completed &lt;id&gt;. Tests passing. Ready for review.&quot;</span> \
  --to @reviewer

# <span class="hljs-number">11.</span> End session
thrum session end
```text

## Best Practices

### Do

- **Register at session start** -- always use `thrum quickstart`
- **Use MCP server when available** -- better than CLI polling
- **Send status updates** -- keep the team informed
- **Use @mentions** -- reference agents by name
- **Include context** -- Beads IDs<span class="hljs-punctuation">,</span> file paths<span class="hljs-punctuation">,</span> commit hashes
- **End sessions cleanly** -- run `thrum session end` when done
- **Set clear intents** -- describe what you&#x27;re working on
- **Broadcast milestones** -- share important progress with the team

### Don&#x27;t

- **Don&#x27;t use Thrum for task management** -- use Beads for that
- **Don&#x27;t spam messages** -- batch updates when possible
- **Don&#x27;t forget to re-arm the listener** -- after processing messages
- **Don&#x27;t ignore critical messages** -- stop work and respond
- **Don&#x27;t skip registration** -- the system won&#x27;t route messages correctly
- **Don&#x27;t leave sessions open** -- end them when done to avoid stale status
- **Don&#x27;t use vague intents** -- be specific about current work

## Troubleshooting

### Not receiving messages

**Diagnosis<span class="hljs-punctuation">:</span>**

```bash
# Check registration
thrum status

# Check daemon
thrum daemon status

# Check inbox manually
thrum inbox
```text

**Solutions<span class="hljs-punctuation">:</span>**

<span class="hljs-number">1.</span> **Not registered** -- run `thrum quickstart`
<span class="hljs-number">2.</span> **Daemon not running** -- run `thrum daemon start`
<span class="hljs-number">3.</span> **Wrong agent name** -- check `THRUM_NAME` env var
<span class="hljs-number">4.</span> **Sync issues** -- run `thrum sync force` to pull latest messages

### Messages not syncing

**Diagnosis<span class="hljs-punctuation">:</span>**

```bash
# Check sync status
thrum sync status

# Check git remote
git remote -v
```text

**Solutions<span class="hljs-punctuation">:</span>**

<span class="hljs-number">1.</span> **No remote** -- add a git remote
<span class="hljs-number">2.</span> **Not committed** -- daemon auto-commits after <span class="hljs-number">60</span>s<span class="hljs-punctuation">,</span> or run `thrum sync force`
<span class="hljs-number">3.</span> **Not pushed** -- run `thrum sync force` to push
<span class="hljs-number">4.</span> **Branch diverged** -- pull and retry

### Multiple agents with same name

**Diagnosis<span class="hljs-punctuation">:</span>**

```bash
thrum agent list
```text

**Solutions<span class="hljs-punctuation">:</span>**

<span class="hljs-number">1.</span> **Use unique names** -- each agent needs a unique name
<span class="hljs-number">2.</span> **Delete duplicates** -- `thrum agent delete &lt;name&gt;`
<span class="hljs-number">3.</span> **Use THRUM_NAME** -- set different names per worktree

### Context recovery after compaction

After conversation compaction<span class="hljs-punctuation">,</span> agents can recover context<span class="hljs-punctuation">:</span>

```bash
# Check inbox for recent messages
thrum inbox --unread

# Check what others are working on
thrum agent list --context

# Check Beads for task state
bd ready
bd list --status=in_progress
```text

## See Also

- <span class="hljs-punctuation">[</span>Workflow Templates<span class="hljs-punctuation">]</span>(workflow-templates.md) -- three-phase agent development
  workflows (plan<span class="hljs-punctuation">,</span> prepare<span class="hljs-punctuation">,</span> implement)
- <span class="hljs-punctuation">[</span>Multi-Agent Support<span class="hljs-punctuation">]</span>(multi-agent.md) -- groups<span class="hljs-punctuation">,</span> runtime presets<span class="hljs-punctuation">,</span> and team
  coordination
- <span class="hljs-punctuation">[</span>Tailscale Sync<span class="hljs-punctuation">]</span>(tailscale-sync.md) -- cross-machine sync via Tailscale
- <span class="hljs-punctuation">[</span>CLI Reference<span class="hljs-punctuation">]</span>(cli.md) -- complete command documentation
- <span class="hljs-punctuation">[</span>MCP Server<span class="hljs-punctuation">]</span>(mcp-server.md) -- MCP tools and message-listener details
- <span class="hljs-punctuation">[</span>Messaging System<span class="hljs-punctuation">]</span>(messaging.md) -- message structure and scopes
- <span class="hljs-punctuation">[</span>Quickstart Guide<span class="hljs-punctuation">]</span>(quickstart.md) -- getting started in <span class="hljs-number">5</span> minutes
- <span class="hljs-punctuation">[</span>Identity System<span class="hljs-punctuation">]</span>(identity.md) -- agent names and registration</code></pre>

    </div>
    <p style="margin-top:2rem"><a href="../docs.html#agent-coordination.html">&larr; View in documentation</a></p>
  </main>
  <script>
    // Redirect browsers to the SPA for full navigation experience.
    // Crawlers (which don't execute JS) will index the static content above.
    if (window.location.search.indexOf('nospa') === -1) {
      window.location.replace('../docs.html#agent-coordination.html');
    }
  </script>
</body>
</html>